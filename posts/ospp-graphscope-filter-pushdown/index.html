<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><title>GraphScope过滤下推 - OneStep</title><meta name=Description content="用尽全力，活成一个普通人"><meta property="og:title" content="GraphScope过滤下推"><meta property="og:description" content="简介 GraphScope交互式查询引擎过滤条件下推 这个项目来自中科院软件所主办的开源之夏 活动，由GraphScope 社区提供。 我觉得开源之夏"><meta property="og:type" content="article"><meta property="og:url" content="https://waruto.top/posts/ospp-graphscope-filter-pushdown/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-09-23T16:53:04+08:00"><meta property="article:modified_time" content="2022-09-23T16:53:04+08:00"><meta property="og:site_name" content="My cool site"><meta name=twitter:card content="summary"><meta name=twitter:title content="GraphScope过滤下推"><meta name=twitter:description content="简介 GraphScope交互式查询引擎过滤条件下推 这个项目来自中科院软件所主办的开源之夏 活动，由GraphScope 社区提供。 我觉得开源之夏"><meta name=application-name content="OneStep"><meta name=apple-mobile-web-app-title content="OneStep"><meta name=theme-color content="#ffffff"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://waruto.top/posts/ospp-graphscope-filter-pushdown/><link rel=prev href=https://waruto.top/posts/risingwave-intern-interview/><link rel=next href=https://waruto.top/posts/zoro-cost-async-trait/><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/normalize.css@8.0.1/normalize.min.css><link rel=stylesheet href=/css/style.min.css><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"GraphScope过滤下推","inLanguage":"zh-CN","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/waruto.top\/posts\/ospp-graphscope-filter-pushdown\/"},"genre":"posts","wordcount":3630,"url":"https:\/\/waruto.top\/posts\/ospp-graphscope-filter-pushdown\/","datePublished":"2022-09-23T16:53:04+08:00","dateModified":"2022-09-23T16:53:04+08:00","publisher":{"@type":"Organization","name":""},"author":{"@type":"Person","name":"waruto210"},"description":""}</script></head><body data-header-desktop=fixed data-header-mobile=auto><script type=text/javascript>(window.localStorage&&localStorage.getItem("theme")?localStorage.getItem("theme")==="dark":"auto"==="auto"?window.matchMedia("(prefers-color-scheme: dark)").matches:"auto"==="dark")&&document.body.setAttribute("theme","dark")</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title=OneStep><img class="lazyload logo" src=/svg/loading.min.svg data-src=/images/logo.jpeg data-srcset="/images/logo.jpeg, /images/logo.jpeg 1.5x, /images/logo.jpeg 2x" data-sizes=auto alt=/images/logo.jpeg title=/images/logo.jpeg width=610 height=610>OneStep</a></div><div class=menu><div class=menu-inner><a class=menu-item href=/>首页 </a><a class=menu-item href=/posts/>文章 </a><a class=menu-item href=/tags/>标签 </a><a class=menu-item href=/categories/>分类 </a><a class=menu-item href=/friendlinks>友链 </a><a class=menu-item href=/about>关于 </a><span class="menu-item delimiter"></span><span class="menu-item search" id=search-desktop>
<input type=text placeholder=搜索文章标题或内容... id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=搜索><i class="fas fa-search fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=清空><i class="fas fa-times-circle fa-fw" aria-hidden=true></i></a>
<span class="search-button search-loading" id=search-loading-desktop><i class="fas fa-spinner fa-fw fa-spin" aria-hidden=true></i></span>
</span><a href=javascript:void(0); class="menu-item theme-switch" title=切换主题><i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title=OneStep><img class="lazyload logo" src=/svg/loading.min.svg data-src=/images/logo.jpeg data-srcset="/images/logo.jpeg, /images/logo.jpeg 1.5x, /images/logo.jpeg 2x" data-sizes=auto alt=/images/logo.jpeg title=/images/logo.jpeg width=610 height=610>OneStep</a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><div class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder=搜索文章标题或内容... id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=搜索><i class="fas fa-search fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=清空><i class="fas fa-times-circle fa-fw" aria-hidden=true></i></a>
<span class="search-button search-loading" id=search-loading-mobile><i class="fas fa-spinner fa-fw fa-spin" aria-hidden=true></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>取消</a></div><a class=menu-item href=/ title>首页</a><a class=menu-item href=/posts/ title>文章</a><a class=menu-item href=/tags/ title>标签</a><a class=menu-item href=/categories/ title>分类</a><a class=menu-item href=/friendlinks title>友链</a><a class=menu-item href=/about title>关于</a><a href=javascript:void(0); class="menu-item theme-switch" title=切换主题>
<i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=main><div class=container><div class=toc id=toc-auto><h2 class=toc-title>目录</h2><div class=toc-content id=toc-content-auto></div></div><article class="page single"><h1 class="single-title animate__animated animate__flipInX">GraphScope过滤下推</h1><div class=post-meta><div class=post-meta-line><span class=post-author><a href=https://github.com/waruto210 title=Author target=_blank rel="noopener noreffer author" class=author><i class="fas fa-user-circle fa-fw" aria-hidden=true></i>waruto210</a></span></div><div class=post-meta-line><i class="far fa-calendar-alt fa-fw" aria-hidden=true></i>&nbsp;<time datetime=2022-09-23>2022-09-23</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden=true></i>&nbsp;约 3630 字&nbsp;
<i class="far fa-clock fa-fw" aria-hidden=true></i>&nbsp;预计阅读 8 分钟&nbsp;</div></div><div class="details toc" id=toc-static data-kept=true><div class="details-summary toc-title"><span>目录</span>
<span><i class="details-icon fas fa-angle-right" aria-hidden=true></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#简介>简介</a></li><li><a href=#过滤下推>过滤下推</a><ul><li><a href=#行过滤>行过滤</a></li><li><a href=#列过滤>列过滤</a></li></ul></li><li><a href=#经验总结>经验总结</a></li></ul></nav></div></div><div class=content id=content><h2 id=简介>简介</h2><p><a href=https://github.com/alibaba/GraphScope/issues/1530 target=_blank rel="noopener noreffer"><em>GraphScope交互式查询引擎过滤条件下推</em></a>
这个项目来自中科院软件所主办的<a href=https://summer-ospp.ac.cn target=_blank rel="noopener noreffer">开源之夏</a>
活动，由<a href=https://github.com/alibaba/GraphScope target=_blank rel="noopener noreffer">GraphScope</a>
社区提供。</p><p>我觉得开源之夏是一个非常好的平台，开源社区的项目、Idea能够获得更多的展示机会；在校学生也能够在此获取到参与开源的机会，打开开源世界的大门。</p><p>说回GraphScope，它是阿里巴巴达摩院智能计算实验室研发并开源的一站式图计算平台。在GraphScope的交互式查询引擎中，对于带有过滤条件的查询，计算层会从存储层中读取数据后进行过滤。目前GraphScope采用的是存算不分离的shared-nothing架构，计算和存储位于一个进程内，这种方式没有性能问题。但GraphScope准备演进到存算分离架构，存储层将通过网络向计算层传输数据，如果在存储层不做过滤，传输开销将非常巨大。为了降低存储层与计算层的数据传输开销，需要将计算层数据源处的过滤下推到存储层。</p><p>为了能够方便的支持多种图查询语言，GraphScope交互式查询引擎抽象出了一套统一的、简洁的、语言无关的中间层GAIA-IR（下面简称IR），也即是交互式查询引擎的计算层。而存储层，则有基于vineyard的v6d存储，以及基于RocksDB的groot存储，存储层通过查询接口向IR返回Vertex/Edge（统称Entity）。根据GraphScope的演进计划，本次过滤下推实现在groot存储上。</p><h2 id=过滤下推>过滤下推</h2><p>GraphScope目前支持的查询语言为Gremlin，以如下Gremlin语句为例子，来讲解过滤下推的作用和逻辑：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>g.V().has(&#34;name&#34;,&#34;gremlin&#34;).
</span></span><span class=line><span class=cl>  values(&#34;age&#34;)
</span></span></code></pre></td></tr></table></div></div><p>其作用就是查询所有name为“gremlin”的节点的age。将其转化为类似的SQL语句，如下：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>select</span><span class=w> </span><span class=n>age</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=k>g</span><span class=p>.</span><span class=n>v</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=n>name</span><span class=o>=</span><span class=s2>&#34;gremlin&#34;</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>在关系型数据库中，数据是以行为单位的，每一行包括多个列的信息。行过滤就是基于某种条件（上面的<code>name="gremlin"</code>）选中/放弃整行数据；列过滤则是选中/放弃某些列（上面的<code>age</code>）进行输出。那么，我们可以很直接地对应到图数据上，行就是图数据中的实体：Entity；列就是这些Entity上的一些属性（Property）：name，age等。因此，行过滤能减少输出的Entity的数量；列过滤能减少输出的每个Entity的大小。</p><p>GraphScope的交互式查询引擎目前仅有行过滤，在IR开始计算前，对存储层返回的数据进行一次行过滤，但没有列过滤。</p><h3 id=行过滤>行过滤</h3><p>现有的行过滤逻辑位于数据源位置，那么只需要将其“挪动”到存储层即可。因此，如何“挪动”就成了关键。</p><p>目前行过滤相关数据结构如下，<code>SingleItem</code>表示Entity需要有某个Property；<code>Predicate</code>表示Entity的某个Property和某个值满足一种逻辑运算，如<code>age > 18</code>；其余的则是组合条件，可以表示更复杂的查询。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-rust data-lang=rust><span class=line><span class=cl><span class=k>pub</span><span class=w> </span><span class=k>enum</span> <span class=nc>Predicates</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>Init</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>SingleItem</span><span class=p>(</span><span class=n>Operand</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>Predicate</span><span class=p>(</span><span class=n>Predicate</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>Not</span><span class=p>(</span><span class=nb>Box</span><span class=o>&lt;</span><span class=n>Predicates</span><span class=o>&gt;</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>And</span><span class=p>((</span><span class=nb>Box</span><span class=o>&lt;</span><span class=n>Predicates</span><span class=o>&gt;</span><span class=p>,</span><span class=w> </span><span class=nb>Box</span><span class=o>&lt;</span><span class=n>Predicates</span><span class=o>&gt;</span><span class=p>)),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>Or</span><span class=p>((</span><span class=nb>Box</span><span class=o>&lt;</span><span class=n>Predicates</span><span class=o>&gt;</span><span class=p>,</span><span class=w> </span><span class=nb>Box</span><span class=o>&lt;</span><span class=n>Predicates</span><span class=o>&gt;</span><span class=p>)),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>pub</span><span class=w> </span><span class=k>enum</span> <span class=nc>Operand</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>Const</span><span class=p>(</span><span class=n>Object</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>Var</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=n>tag</span>: <span class=nb>Option</span><span class=o>&lt;</span><span class=n>NameOrId</span><span class=o>&gt;</span><span class=p>,</span><span class=w> </span><span class=n>prop_key</span>: <span class=nb>Option</span><span class=o>&lt;</span><span class=n>PropKey</span><span class=o>&gt;</span><span class=w> </span><span class=p>},</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>Vars</span><span class=p>(</span><span class=nb>Vec</span><span class=o>&lt;</span><span class=n>Operand</span><span class=o>&gt;</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>VarMap</span><span class=p>(</span><span class=nb>Vec</span><span class=o>&lt;</span><span class=n>Operand</span><span class=o>&gt;</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>pub</span><span class=w> </span><span class=k>struct</span> <span class=nc>Predicate</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>pub</span><span class=p>(</span><span class=k>crate</span><span class=p>)</span><span class=w> </span><span class=n>left</span>: <span class=nc>Operand</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>pub</span><span class=p>(</span><span class=k>crate</span><span class=p>)</span><span class=w> </span><span class=n>cmp</span>: <span class=nc>common_pb</span>::<span class=n>Logical</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>pub</span><span class=p>(</span><span class=k>crate</span><span class=p>)</span><span class=w> </span><span class=n>right</span>: <span class=nc>Operand</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>对于上面的Gremlin语句，其<code>name=gremlin</code>的过滤条件， 会被IR转换为如下结构（假设name这个property的内部id为2）：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-rust data-lang=rust><span class=line><span class=cl><span class=n>Predicates</span><span class=p>(</span><span class=n>Predicate</span><span class=p>(</span><span class=n>Predicate</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=n>left</span>: <span class=nc>Var</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=n>tag</span>: <span class=nb>None</span><span class=p>,</span><span class=w> </span><span class=n>prop_key</span>: <span class=nb>Some</span><span class=p>(</span><span class=n>Key</span><span class=p>(</span><span class=n>Id</span><span class=p>(</span><span class=mi>2</span><span class=p>)))</span><span class=w> </span><span class=p>},</span><span class=w> </span><span class=n>cmp</span>: <span class=nb>Eq</span><span class=p>,</span><span class=w> </span><span class=n>right</span>: <span class=nc>Const</span><span class=p>(</span><span class=nb>String</span><span class=p>(</span><span class=s>&#34;gremlin&#34;</span><span class=p>))</span><span class=w> </span><span class=p>}))</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>这套数据结构在IR中不仅用于简单的过滤，还用于更加high level的图运算，里面有一些冗余结构，例如<code>Operand</code>里的<code>Vars</code>与<code>VarMap</code>在过滤中都不会被用到。因此，不适合把这套数据结构直接传递到存储层。所以，我们设计了一种更为简洁的<code>Condition</code>。</p><p><code>Condition</code>的定义如下。<code>PredCondition::HasProp</code>对应上方的<code>SingleItem</code>；<code>CmpCondition</code>对应上方的<code>Predicate</code>；另外，此处的<code>Operand</code>也进行了简化。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-rust data-lang=rust><span class=line><span class=cl><span class=k>pub</span><span class=w> </span><span class=k>enum</span> <span class=nc>Condition</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>And</span><span class=p>(</span><span class=n>AndCondition</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>Or</span><span class=p>(</span><span class=n>OrCondition</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>Not</span><span class=p>(</span><span class=n>NotCondition</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>Pred</span><span class=p>(</span><span class=n>PredCondition</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>pub</span><span class=w> </span><span class=k>enum</span> <span class=nc>PredCondition</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>HasProp</span><span class=p>(</span><span class=n>PropId</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>Cmp</span><span class=p>(</span><span class=n>CmpCondition</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>pub</span><span class=w> </span><span class=k>struct</span> <span class=nc>CmpCondition</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>left</span>: <span class=nc>Operand</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>op</span>: <span class=nc>CmpOperator</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>right</span>: <span class=nc>Operand</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>pub</span><span class=w> </span><span class=k>enum</span> <span class=nc>Operand</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>Const</span><span class=p>(</span><span class=n>Property</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>PropId</span><span class=p>(</span><span class=n>PropId</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>Label</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>Id</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>上面的<code>name=gremlin</code>过滤条件可以对应到如下<code>Condition</code>，可见表达式简介了很多。并且，两者的结构十分相似，后续IR层要支持更多查询逻辑，那么只需要添加新的<code>CmpOperator</code>。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-rust data-lang=rust><span class=line><span class=cl><span class=n>Pred</span><span class=p>(</span><span class=n>Cmp</span><span class=p>(</span><span class=n>CmpCondition</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=n>left</span>: <span class=nc>PropId</span><span class=p>(</span><span class=mi>2</span><span class=p>),</span><span class=w> </span><span class=n>op</span>: <span class=nc>Equal</span><span class=p>,</span><span class=w> </span><span class=n>right</span>: <span class=nc>Const</span><span class=p>(</span><span class=nb>String</span><span class=p>(</span><span class=s>&#34;gremlin&#34;</span><span class=p>))</span><span class=w> </span><span class=p>}))</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>然后，为<code>Condition</code>实现如下的<code>ElemFilter</code> trait，用于过滤Vertex/Edge。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-rust data-lang=rust><span class=line><span class=cl><span class=k>pub</span><span class=w> </span><span class=k>trait</span><span class=w> </span><span class=n>ElemFilter</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>fn</span> <span class=nf>filter_vertex</span><span class=o>&lt;</span><span class=n>V</span>: <span class=nc>Vertex</span><span class=o>&gt;</span><span class=p>(</span><span class=o>&amp;</span><span class=bp>self</span><span class=p>,</span><span class=w> </span><span class=n>vertex</span>: <span class=kp>&amp;</span><span class=nc>V</span><span class=p>)</span><span class=w> </span>-&gt; <span class=nc>GraphResult</span><span class=o>&lt;</span><span class=kt>bool</span><span class=o>&gt;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>fn</span> <span class=nf>filter_edge</span><span class=o>&lt;</span><span class=n>E</span>: <span class=nc>Edge</span><span class=o>&gt;</span><span class=p>(</span><span class=o>&amp;</span><span class=bp>self</span><span class=p>,</span><span class=w> </span><span class=n>edge</span>: <span class=kp>&amp;</span><span class=nc>E</span><span class=p>)</span><span class=w> </span>-&gt; <span class=nc>GraphResult</span><span class=o>&lt;</span><span class=kt>bool</span><span class=o>&gt;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>最后如下，groot对底层存储返回的Iterator应用该condition filter。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-rust data-lang=rust><span class=line><span class=cl><span class=k>if</span><span class=w> </span><span class=kd>let</span><span class=w> </span><span class=nb>Some</span><span class=p>(</span><span class=n>condition</span><span class=p>)</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>condition</span><span class=p>.</span><span class=n>cloned</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>iter</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nb>Box</span>::<span class=n>new</span><span class=p>(</span><span class=n>iter</span><span class=p>.</span><span class=n>filter</span><span class=p>(</span><span class=k>move</span><span class=w> </span><span class=o>|</span><span class=n>v</span><span class=o>|</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>v</span><span class=p>.</span><span class=n>is_ok</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=n>condition</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>.</span><span class=n>filter_vertex</span><span class=p>(</span><span class=n>v</span><span class=p>.</span><span class=n>as_ref</span><span class=p>().</span><span class=n>unwrap</span><span class=p>())</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>.</span><span class=n>unwrap_or</span><span class=p>(</span><span class=kc>false</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=p>}))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h3 id=列过滤>列过滤</h3><p>目前的groot，并不支持任何列过滤，会直接返回所有Property，IR在计算时取用需要的Property。</p><p>而在上面的查询中，根据<code>values("age")</code>，我们知道，其实只需要传输节点的age属性即可。对于一个复杂的图，其中的Entity可能会有10个以上的属性，那么在存算分离+列过滤缺失的情况下，对于该查询，要传输10倍以上的额外数据，overhead过大了，甚至可能导致系统的性能低到不可用。</p><p>存算分离后，查询结果的发送逻辑大致会如下：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-rust data-lang=rust><span class=line><span class=cl><span class=k>for</span><span class=w> </span><span class=n>entity</span><span class=w> </span><span class=k>in</span><span class=w> </span><span class=n>query_result</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=kd>let</span><span class=w> </span><span class=n>props</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>entity</span><span class=p>.</span><span class=n>get_properties</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>send</span><span class=p>(</span><span class=n>props</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>最初的想法是在Vertex/Edge外面再套一层，并控制其输出的Property，那么就能控制最终被传输的prop，达到列过滤目的。对于<code>values("age")</code>的列过滤，如下图所示：</p><p><img class=lazyload src=/svg/loading.min.svg data-src=/ospp-graphscope-filter-pushdown/column_filter1.png data-srcset="/ospp-graphscope-filter-pushdown/column_filter1.png, /ospp-graphscope-filter-pushdown/column_filter1.png 1.5x, /ospp-graphscope-filter-pushdown/column_filter1.png 2x" data-sizes=auto alt=/ospp-graphscope-filter-pushdown/column_filter1.png title=column_filter width=337 height=408></p><p>但这样主要有两点问题：</p><ul><li>需要对现有接口返回的Vertex/Edge类型进行修改，造成的连锁改动会比较多；</li><li>groot的Vertex/Edge的Property以bytes格式存储，在调用get_properties时，返回一个lazily decode的Iterator，如果在其外部进行列过滤，需要先解码全部Property然后过滤，造成了额外开销。</li><li>此外，多一层包裹会导致Vertex/Edge的底层实现丧失了直接暴露bytes数据的能力，后续实现存算分离时，也可能直接传输过滤后的bytes数据，省去解码开销。</li></ul><p>所以，最终选择将需要的property信息嵌入到groot Vertex/Edge的具体实现中，为其添加一个<code>columns</code>成员；并且修改<code>CommonIterDecoder</code>，添加<code>Spec</code>与<code>Empty</code>两种解码器，<code>Spec</code>仅解码<code>columns</code>中指定的列，<code>Empty</code>则不返回任何Property。</p><p>当对其调用<code>get_property(prop_id)</code>时，首先检查prop_id是否在<code>columns</code>内，然后决定是否要解码某个Property；调用<code>get_properties</code>时，会根据<code>columns</code>决定使用<code>All</code>、<code>Spec</code>或者<code>Empty</code>三种CommonIterDecoder之一。对于<code>values("age")</code>的列过滤，如下图所示：</p><p><img class=lazyload src=/svg/loading.min.svg data-src=/ospp-graphscope-filter-pushdown/column_filter2.png data-srcset="/ospp-graphscope-filter-pushdown/column_filter2.png, /ospp-graphscope-filter-pushdown/column_filter2.png 1.5x, /ospp-graphscope-filter-pushdown/column_filter2.png 2x" data-sizes=auto alt=/ospp-graphscope-filter-pushdown/column_filter2.png title=/ospp-graphscope-filter-pushdown/column_filter2.png width=321 height=327></p><p>相关数据结构如下：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-rust data-lang=rust><span class=line><span class=cl><span class=k>pub</span><span class=w> </span><span class=k>struct</span> <span class=nc>RocksVertexImpl</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>vertex_id</span>: <span class=nc>VertexId</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>label_id</span>: <span class=nc>LabelId</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>decoder</span>: <span class=nb>Option</span><span class=o>&lt;</span><span class=n>Decoder</span><span class=o>&gt;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>raw_bytes</span>: <span class=nc>RawBytes</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>columns</span>: <span class=nb>Option</span><span class=o>&lt;</span><span class=n>HashSet</span><span class=o>&lt;</span><span class=n>PropId</span><span class=o>&gt;&gt;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>impl</span><span class=w> </span><span class=n>RocksVertexImpl</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>pub</span><span class=w> </span><span class=k>fn</span> <span class=nf>set_columns</span><span class=p>(</span><span class=o>&amp;</span><span class=k>mut</span><span class=w> </span><span class=bp>self</span><span class=p>,</span><span class=w> </span><span class=n>columns</span>: <span class=nb>Option</span><span class=o>&lt;</span><span class=n>HashSet</span><span class=o>&lt;</span><span class=n>PropId</span><span class=o>&gt;&gt;</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=bp>self</span><span class=p>.</span><span class=n>columns</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>columns</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>pub</span><span class=w> </span><span class=k>struct</span> <span class=nc>PropertiesIter</span><span class=o>&lt;&#39;</span><span class=na>a</span><span class=o>&gt;</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>decode_iter</span>: <span class=nc>CommonIterDecoder</span><span class=o>&lt;&#39;</span><span class=na>a</span><span class=o>&gt;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>impl</span><span class=o>&lt;&#39;</span><span class=na>a</span><span class=o>&gt;</span><span class=w> </span><span class=n>PropertiesIter</span><span class=o>&lt;&#39;</span><span class=na>a</span><span class=o>&gt;</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>pub</span><span class=w> </span><span class=k>fn</span> <span class=nf>all_columns</span><span class=p>(</span><span class=n>decode_iter</span>: <span class=nc>IterDecoder</span><span class=o>&lt;&#39;</span><span class=na>a</span><span class=o>&gt;</span><span class=p>)</span><span class=w> </span>-&gt; <span class=nc>Self</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>PropertiesIter</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=n>decode_iter</span>: <span class=nc>CommonIterDecoder</span>::<span class=n>All</span><span class=p>(</span><span class=n>decode_iter</span><span class=p>)</span><span class=w> </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>pub</span><span class=w> </span><span class=k>fn</span> <span class=nf>spec_columns</span><span class=p>(</span><span class=n>decode_iter</span>: <span class=nc>SpecIterDecoder</span><span class=o>&lt;&#39;</span><span class=na>a</span><span class=o>&gt;</span><span class=p>)</span><span class=w> </span>-&gt; <span class=nc>Self</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>PropertiesIter</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=n>decode_iter</span>: <span class=nc>CommonIterDecoder</span>::<span class=n>Spec</span><span class=p>(</span><span class=n>decode_iter</span><span class=p>)</span><span class=w> </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>pub</span><span class=w> </span><span class=k>fn</span> <span class=nf>empty</span><span class=p>()</span><span class=w> </span>-&gt; <span class=nc>Self</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>PropertiesIter</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=n>decode_iter</span>: <span class=nc>CommonIterDecoder</span>::<span class=n>Empty</span><span class=w> </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>如下代码，groot对完成了行过滤的查询结果设置<code>columns</code>，实现列过滤。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-rust data-lang=rust><span class=line><span class=cl><span class=kd>let</span><span class=w> </span><span class=n>columns</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=bp>Self</span>::<span class=n>parse_columns</span><span class=p>(</span><span class=n>property_ids</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nb>Ok</span><span class=p>(</span><span class=nb>Box</span>::<span class=n>new</span><span class=p>(</span><span class=n>iter</span><span class=p>.</span><span class=n>map</span><span class=p>(</span><span class=k>move</span><span class=w> </span><span class=o>|</span><span class=n>v</span><span class=o>|</span><span class=w> </span><span class=k>match</span><span class=w> </span><span class=n>v</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nb>Ok</span><span class=p>(</span><span class=k>mut</span><span class=w> </span><span class=n>v</span><span class=p>)</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>v</span><span class=p>.</span><span class=n>set_columns</span><span class=p>(</span><span class=n>columns</span><span class=p>.</span><span class=n>clone</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nb>Ok</span><span class=p>(</span><span class=n>v</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nb>Err</span><span class=p>(</span><span class=n>e</span><span class=p>)</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=nb>Err</span><span class=p>(</span><span class=n>e</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>})))</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h2 id=经验总结>经验总结</h2><p>完成这个项目，从中我也获得了一些经验感悟。</p><ul><li>首先，如果参与的是一个很大的项目，不要总想着把代码细节都搞清楚再动手，GraphScope的交互式查询引擎就有18万行代码，还同时包含Java/Python/Cpp/Rust这四种语言，如果耗费大量时间纠结代码细节，将得不偿失。例如，某函数叫<code>parse_property</code>，从名字就可以知道其作用，而对于其实现，暂时不用关心。应该先大致了解自己工作涉及到的模块，然后在进行项目的过程中，对模块关系，项目代码得到更加清晰、准确的理解。</li><li>在动手进行代码编写前，应该仔细思考并设计。在我的实现过程中，Condition就被重构了一次。第一次，由于对IR层的Predicates考虑不够，导致行过滤接入后，某些case无法转换成Condition，并且如果要在已有Condition上修复这些问题，代码将非常ugly。这又引出下一点。</li><li>我认为，在代码中开始出现因为fix bug/加feature而产生的ugly code时，应该尽快着手重构，防止问题代码越堆越多，最后天怒人怨，下大力气重写。</li><li>Rust是一门好语言，我学习Rust快两年半了，也进行过一段使用Rust进行开发的实习。它有着很强的抽象能力，同时又提供了c/cpp级别的性能，还有完善的依赖管理机制，最重要的是：保障安全（虽然经常因此跟编译器作斗争）。在完成GraphScope项目的过程中，只要代码通过编译，我就只需要检查是否出现逻辑错误，而无需担心内存/并发 Bug，这是写c/cpp，乃至golang/java都从未有过的体验。</li></ul></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>更新于 2022-09-23</span></div></div><div class=post-info-line><div class=post-info-md><span><a class=link-to-markdown href=/posts/ospp-graphscope-filter-pushdown/index.md target=_blank>阅读原始文档</a></span></div><div class=post-info-share><span><a href=javascript:void(0); title="分享到 Twitter" data-sharer=twitter data-url=https://waruto.top/posts/ospp-graphscope-filter-pushdown/ data-title=GraphScope过滤下推 data-via=Jason210314><i class="fab fa-twitter fa-fw" aria-hidden=true></i></a></span></div></div></div><div class=post-info-more><section class=post-tags></section><section><span><a href=javascript:void(0); onclick=window.history.back()>返回</a></span>&nbsp;|&nbsp;<span><a href=/>主页</a></span></section></div><div class=post-nav><a href=/posts/risingwave-intern-interview/ class=prev rel=prev title="Risingwave Labs 实习面试"><i class="fas fa-angle-left fa-fw" aria-hidden=true></i>Risingwave Labs 实习面试</a>
<a href=/posts/zoro-cost-async-trait/ class=next rel=next title="用 GAT + TAIT 实现零成本Async Trait">用 GAT + TAIT 实现零成本Async Trait<i class="fas fa-angle-right fa-fw" aria-hidden=true></i></a></div></div><div id=comments><div id=disqus_thread class=comment></div><noscript>Please enable JavaScript to view the comments powered by <a href=https://disqus.com/?ref_noscript>Disqus</a>.</noscript></div></article></div></main><footer class=footer><div class=footer-container><div class=footer-line>由 <a href=https://gohugo.io/ target=_blank rel="noopener noreffer" title="Hugo 0.105.0">Hugo</a> 强力驱动 | 主题 - <a href=https://github.com/dillonzq/LoveIt target=_blank rel="noopener noreffer" title="LoveIt 0.2.10"><i class="far fa-kiss-wink-heart fa-fw" aria-hidden=true></i> LoveIt</a></div><div class=footer-line itemscope itemtype=http://schema.org/CreativeWork><i class="far fa-copyright fa-fw" aria-hidden=true></i><span itemprop=copyrightYear>2019 - 2022</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=https://github.com/waruto210 target=_blank>waruto210</a></span>&nbsp;|&nbsp;<span class=license><a rel="license external nofollow noopener noreffer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title=回到顶部><i class="fas fa-arrow-up fa-fw" aria-hidden=true></i>
</a><a href=# id=view-comments class=fixed-button title=查看评论><i class="fas fa-comment fa-fw" aria-hidden=true></i></a></div><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/contrib/copy-tex.min.css><script type=text/javascript src=https://waruto.disqus.com/embed.js defer></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/autocomplete.js@0.38.1/dist/autocomplete.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lunr@2.3.9/lunr.min.js></script><script type=text/javascript src=/lib/lunr/lunr.stemmer.support.min.js></script><script type=text/javascript src=/lib/lunr/lunr.zh.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lazysizes@5.3.1/lazysizes.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/clipboard@2.0.11/dist/clipboard.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/sharer.js@0.5.1/sharer.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/contrib/auto-render.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/contrib/copy-tex.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/contrib/mhchem.min.js></script><script type=text/javascript>window.config={code:{copyTitle:"复制到剪贴板",maxShownLines:10},comment:{},math:{delimiters:[{display:!0,left:"$$",right:"$$"},{display:!0,left:"\\[",right:"\\]"},{display:!0,left:"\\begin{equation}",right:"\\end{equation}"},{display:!0,left:"\\begin{equation*}",right:"\\end{equation*}"},{display:!0,left:"\\begin{align}",right:"\\end{align}"},{display:!0,left:"\\begin{align*}",right:"\\end{align*}"},{display:!0,left:"\\begin{alignat}",right:"\\end{alignat}"},{display:!0,left:"\\begin{alignat*}",right:"\\end{alignat*}"},{display:!0,left:"\\begin{gather}",right:"\\end{gather}"},{display:!0,left:"\\begin{CD}",right:"\\end{CD}"},{display:!1,left:"$",right:"$"},{display:!1,left:"\\(",right:"\\)"}],strict:!1},search:{highlightTag:"em",lunrIndexURL:"/index.json",lunrLanguageCode:"zh",lunrSegmentitURL:"/lib/lunr/lunr.segmentit.js",maxResultLength:10,noResultsFound:"没有找到结果",snippetLength:50,type:"lunr"}}</script><script type=text/javascript src=/js/theme.min.js></script><script type=text/javascript>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","UA-164518488-1",{anonymize_ip:!0})</script><script type=text/javascript src="https://www.googletagmanager.com/gtag/js?id=UA-164518488-1" async></script></body></html>