<!doctype html><html lang=zh-cn>
<head>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<meta name=robots content="noodp">
<meta http-equiv=x-ua-compatible content="IE=edge, chrome=1">
<title>CS:APP Bomb lab - OneStep</title><meta name=Description content="用尽全力，活成一个普通人"><meta property="og:title" content="CS:APP Bomb lab">
<meta property="og:description" content="实验步骤 准备工作 使用tar -vxf将炸弹压缩包解压,cd 进入,可以从 bomb.c 中看出实验的用意以及程序的大致 逻辑,bomb 为可执行程序,使用 gdb 调试该">
<meta property="og:type" content="article">
<meta property="og:url" content="https://wmc1999.top/posts/csapp-bomb-lab/"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2018-12-01T17:20:21+00:00">
<meta property="article:modified_time" content="2018-12-01T17:20:21+00:00">
<meta name=twitter:card content="summary">
<meta name=twitter:title content="CS:APP Bomb lab">
<meta name=twitter:description content="实验步骤 准备工作 使用tar -vxf将炸弹压缩包解压,cd 进入,可以从 bomb.c 中看出实验的用意以及程序的大致 逻辑,bomb 为可执行程序,使用 gdb 调试该">
<meta name=application-name content="OneStep">
<meta name=apple-mobile-web-app-title content="OneStep"><meta name=theme-color content="#ffffff"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico>
<link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png>
<link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://wmc1999.top/posts/csapp-bomb-lab/><link rel=prev href=https://wmc1999.top/posts/ds-bm/><link rel=next href=https://wmc1999.top/posts/csapp-attack-lab/><link rel=stylesheet href=/lib/normalize/normalize.min.css><link rel=stylesheet href=/css/style.min.css><link rel=stylesheet href=/lib/fontawesome-free/all.min.css><link rel=stylesheet href=/lib/animate/animate.min.css><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"CS:APP Bomb lab","inLanguage":"zh-CN","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/wmc1999.top\/posts\/csapp-bomb-lab\/"},"genre":"posts","keywords":"CS:APP, 汇编, 二进制炸弹","wordcount":2912,"url":"https:\/\/wmc1999.top\/posts\/csapp-bomb-lab\/","datePublished":"2018-12-01T17:20:21+00:00","dateModified":"2018-12-01T17:20:21+00:00","publisher":{"@type":"Organization","name":"waruto210"},"author":{"@type":"Person","name":"waruto210"},"description":""}</script></head>
<body header-desktop=fixed header-mobile=auto><script type=text/javascript>(window.localStorage&&localStorage.getItem('theme')?localStorage.getItem('theme')==='dark':'auto'==='auto'?window.matchMedia('(prefers-color-scheme: dark)').matches:'auto'==='dark')&&document.body.setAttribute('theme','dark')</script>
<div id=mask></div><div class=wrapper><header class=desktop id=header-desktop>
<div class=header-wrapper>
<div class=header-title>
<a href=/ title=OneStep><img class="lazyload logo" src=/svg/loading.min.svg data-src=/images/logo.jpeg data-srcset="/images/logo.jpeg, /images/logo.jpeg 1.5x, /images/logo.jpeg 2x" data-sizes=auto alt=/images/logo.jpeg title=/images/logo.jpeg>OneStep</a>
</div>
<div class=menu>
<div class=menu-inner><a class=menu-item href=/> 首页 </a><a class=menu-item href=/posts/> 文章 </a><a class=menu-item href=/tags/> 标签 </a><a class=menu-item href=/categories/> 分类 </a><a class=menu-item href=/friendlinks> 友链 </a><a class=menu-item href=/about> 关于 </a><span class="menu-item delimiter"></span><span class="menu-item search" id=search-desktop>
<input type=text placeholder=搜索文章标题或内容... id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=搜索>
<i class="fas fa-search fa-fw"></i>
</a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=清空>
<i class="fas fa-times-circle fa-fw"></i>
</a>
<span class="search-button search-loading" id=search-loading-desktop>
<i class="fas fa-spinner fa-fw fa-spin"></i>
</span>
</span><a href=javascript:void(0); class="menu-item theme-switch" title=切换主题>
<i class="fas fa-adjust fa-fw"></i>
</a>
</div>
</div>
</div>
</header><header class=mobile id=header-mobile>
<div class=header-container>
<div class=header-wrapper>
<div class=header-title>
<a href=/ title=OneStep><img class="lazyload logo" src=/svg/loading.min.svg data-src=/images/logo.jpeg data-srcset="/images/logo.jpeg, /images/logo.jpeg 1.5x, /images/logo.jpeg 2x" data-sizes=auto alt=/images/logo.jpeg title=/images/logo.jpeg>OneStep</a>
</div>
<div class=menu-toggle id=menu-toggle-mobile>
<span></span><span></span><span></span>
</div>
</div>
<div class=menu id=menu-mobile><div class=search-wrapper>
<div class="search mobile" id=search-mobile>
<input type=text placeholder=搜索文章标题或内容... id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=搜索>
<i class="fas fa-search fa-fw"></i>
</a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=清空>
<i class="fas fa-times-circle fa-fw"></i>
</a>
<span class="search-button search-loading" id=search-loading-mobile>
<i class="fas fa-spinner fa-fw fa-spin"></i>
</span>
</div>
<a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>
取消
</a>
</div><a class=menu-item href=/ title>首页</a><a class=menu-item href=/posts/ title>文章</a><a class=menu-item href=/tags/ title>标签</a><a class=menu-item href=/categories/ title>分类</a><a class=menu-item href=/friendlinks title>友链</a><a class=menu-item href=/about title>关于</a><a href=javascript:void(0); class="menu-item theme-switch" title=切换主题>
<i class="fas fa-adjust fa-fw"></i>
</a></div>
</div>
</header>
<div class="search-dropdown desktop">
<div id=search-dropdown-desktop></div>
</div>
<div class="search-dropdown mobile">
<div id=search-dropdown-mobile></div>
</div>
<main class=main>
<div class=container><div class=toc id=toc-auto>
<h2 class=toc-title>目录</h2>
<div class=toc-content id=toc-content-auto></div>
</div><article class="page single"><h1 class="single-title animated flipInX">CS:APP Bomb lab</h1><div class=post-meta>
<div class=post-meta-line><span class=post-author><a href=https://github.com/waruto210 title=Author target=_blank rel="noopener noreffer author" class=author><i class="fas fa-user-circle fa-fw"></i>waruto210</a></span>&nbsp;<span class=post-category>收录于 <a href=/categories/csapp/><i class="far fa-folder fa-fw"></i>CS:APP</a></span></div>
<div class=post-meta-line><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime=2018-12-01>2018-12-01</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;约 2912 字&nbsp;
<i class="far fa-clock fa-fw"></i>&nbsp;预计阅读 6 分钟&nbsp;</div>
</div><div class="details toc" id=toc-static kept=true>
<div class="details-summary toc-title">
<span>目录</span>
<span><i class="details-icon fas fa-angle-right"></i></span>
</div>
<div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents>
<ul>
<li><a href=#准备工作>准备工作</a></li>
<li><a href=#phase_1>phase_1</a></li>
<li><a href=#phase_2>phase_2</a></li>
<li><a href=#phase_3>phase_3</a></li>
<li><a href=#phase_4>phase_4</a></li>
<li><a href=#phase_5>phase_5</a></li>
<li><a href=#phase_6>phase_6</a></li>
<li><a href=#secret_phase>secret_phase</a></li>
<li><a href=#运行截图>运行截图</a></li>
</ul>
</nav></div>
</div><div class=content id=content><h1 id=实验步骤>实验步骤</h1>
<h2 id=准备工作>准备工作</h2>
<p>使用<code>tar -vxf</code>将炸弹压缩包解压,cd 进入,可以从 bomb.c 中看出实验的用意以及程序的大致
逻辑,bomb 为可执行程序,使用 gdb 调试该程序.</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=o>(</span>gdb<span class=o>)</span> b read_line
Breakpoint <span class=m>1</span> at 0x40155c
<span class=o>(</span>gdb<span class=o>)</span> b explode_bomb
Breakpoint <span class=m>2</span> at 0x4014e4
</code></pre></td></tr></table>
</div>
</div><p>给 read_line 函数打上断点,以便每次输入运行一关.给 explode_bomb 打上断点,以便在炸弹爆炸
前可以处理.</p>
<h2 id=phase_1>phase_1</h2>
<p>获得 phase_1 汇编代码</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=o>(</span>gdb<span class=o>)</span> disas phase_1
Dump of assembler code <span class=k>for</span> <span class=k>function</span> phase_1:
   0x0000000000400e80 &lt;+0&gt;:	sub    <span class=nv>$0</span>x8,%rsp
   0x0000000000400e84 &lt;+4&gt;:	mov    <span class=nv>$0</span>x4024a0,%esi
   0x0000000000400e89 &lt;+9&gt;:	callq  0x40127e &lt;strings_not_equal&gt;
   0x0000000000400e8e &lt;+14&gt;:	<span class=nb>test</span>   %eax,%eax
   0x0000000000400e90 &lt;+16&gt;:	je     0x400e97 &lt;phase_1+23&gt;
   0x0000000000400e92 &lt;+18&gt;:	callq  0x4014e4 &lt;explode_bomb&gt;
   0x0000000000400e97 &lt;+23&gt;:	add    <span class=nv>$0</span>x8,%rsp
   0x0000000000400e9b &lt;+27&gt;:	retq
End of assembler dump.
</code></pre></td></tr></table>
</div>
</div><p>可见,此题是将我们输入的字符串与地址 0x4024a0 处字符串比较,不等则爆炸.查看该字符串.</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=o>(</span>gdb<span class=o>)</span> x/s 0x4024a0
0x4024a0 &lt;__dso_handle+344&gt;:	 <span class=s2>&#34;We have to stand with our North Korean allies.&#34;</span>
</code></pre></td></tr></table>
</div>
</div><p>那么答案是 We have to stand with our North Korean allies.</p>
<h2 id=phase_2>phase_2</h2>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=o>(</span>gdb<span class=o>)</span> disas phase_2
Dump of assembler code <span class=k>for</span> <span class=k>function</span> phase_2:
   0x0000000000400e9c &lt;+0&gt;:	push   %rbp
   0x0000000000400e9d &lt;+1&gt;:	push   %rbx
   0x0000000000400e9e &lt;+2&gt;:	sub    <span class=nv>$0</span>x28,%rsp
   0x0000000000400ea2 &lt;+6&gt;:	mov    %rsp,%rsi
   0x0000000000400ea5 &lt;+9&gt;:	callq  0x40151a &lt;read_six_numbers&gt;
   0x0000000000400eaa &lt;+14&gt;:	cmpl   <span class=nv>$0</span>x1,<span class=o>(</span>%rsp<span class=o>)</span>
   0x0000000000400eae &lt;+18&gt;:	je     0x400ed0 &lt;phase_2+52&gt;
   0x0000000000400eb0 &lt;+20&gt;:	callq  0x4014e4 &lt;explode_bomb&gt;
   0x0000000000400eb5 &lt;+25&gt;:	jmp    0x400ed0 &lt;phase_2+52&gt;
   0x0000000000400eb7 &lt;+27&gt;:	mov    -0x4<span class=o>(</span>%rbx<span class=o>)</span>,%eax
   0x0000000000400eba &lt;+30&gt;:	add    %eax,%eax
   0x0000000000400ebc &lt;+32&gt;:	cmp    %eax,<span class=o>(</span>%rbx<span class=o>)</span>
   0x0000000000400ebe &lt;+34&gt;:	je     0x400ec5 &lt;phase_2+41&gt;
   0x0000000000400ec0 &lt;+36&gt;:	callq  0x4014e4 &lt;explode_bomb&gt;
   0x0000000000400ec5 &lt;+41&gt;:	add    <span class=nv>$0</span>x4,%rbx
   0x0000000000400ec9 &lt;+45&gt;:	cmp    %rbp,%rbx
   0x0000000000400ecc &lt;+48&gt;:	jne    0x400eb7 &lt;phase_2+27&gt;
   0x0000000000400ece &lt;+50&gt;:	jmp    0x400edc &lt;phase_2+64&gt;
   0x0000000000400ed0 &lt;+52&gt;:	lea    0x4<span class=o>(</span>%rsp<span class=o>)</span>,%rbx
   0x0000000000400ed5 &lt;+57&gt;:	lea    0x18<span class=o>(</span>%rsp<span class=o>)</span>,%rbp
   0x0000000000400eda &lt;+62&gt;:	jmp    0x400eb7 &lt;phase_2+27&gt;
   0x0000000000400edc &lt;+64&gt;:	add    <span class=nv>$0</span>x28,%rsp
---Type &lt;<span class=k>return</span>&gt; to <span class=k>continue</span>, or q &lt;<span class=k>return</span>&gt; to quit---
   0x0000000000400ee0 &lt;+68&gt;:	pop    %rbx
   0x0000000000400ee1 &lt;+69&gt;:	pop    %rbp
   0x0000000000400ee2 &lt;+70&gt;:	retq
End of assembler dump.
</code></pre></td></tr></table>
</div>
</div><p>+3 处发现在栈中开辟了 0x28 的内存区域.然后将%rsp 的值传给%rsi 作为
参数传给函数 read_six_numbers,可以看出应该使用开辟的空闲内存做
数组,记数组为 r,读取六个数字.将(%rsp)和 0x1 比较,如果不等,就会爆
炸,(％rsp)为数组首元,故 r[0]＝１;跳转到+52,将 r[1]地址赋给%rbx,
将 r<a href=%e5%ae%9e%e9%99%85%e4%b8%8d%e5%ad%98%e5%9c%a8 rel>6</a>地址赋给%rbp,跳到+27,将%eax 设为%rbx 指向的前一个
数,此时为 r[0],比较 r[1]和 2*r[0]是否相等,不等则爆炸.跳转到+41,％
rbx+4,比较%rbx 和%rbp,不等跳转到+27,重复,等则跳转到+64 结束,成功
.可以看出，这是一个循环比较.等价于下面的 c 语 a 言</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=o>*</span><span class=n>b</span> <span class=o>=</span> <span class=o>&amp;</span><span class=n>r</span><span class=p>[</span><span class=mi>1</span><span class=p>];</span> <span class=n>b</span> <span class=o>!=</span> <span class=o>&amp;</span><span class=n>r</span><span class=p>[</span><span class=mi>6</span><span class=p>];</span> <span class=n>b</span><span class=o>++</span><span class=p>)</span>
<span class=p>{</span>
    <span class=k>if</span><span class=p>(</span><span class=o>*</span><span class=n>b</span> <span class=o>!=</span> <span class=mi>2</span> <span class=o>*</span> <span class=p>(</span><span class=o>*</span><span class=p>(</span><span class=n>b</span> <span class=o>-</span> <span class=mi>1</span><span class=p>)))</span>
        <span class=n>call</span> <span class=n>explode_bomb</span><span class=p>;</span>
</code></pre></td></tr></table>
</div>
</div><p>故答案应该为 1 2 4 8 16 32.</p>
<h2 id=phase_3>phase_3</h2>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-bash data-lang=bash>   0x0000000000400ef1 &lt;+14&gt;:	mov    <span class=nv>$0</span>x4027cd,%esi
   0x0000000000400ef6 &lt;+19&gt;:	mov    <span class=nv>$0</span>x0,%eax
   0x0000000000400efb &lt;+24&gt;:	callq  0x400ba0 &lt;__isoc99_sscanf@plt&gt;
   0x0000000000400f00 &lt;+29&gt;:	cmp    <span class=nv>$0</span>x1,%eax
</code></pre></td></tr></table>
</div>
</div><p>查看 0x4027cd,</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=o>(</span>gdb<span class=o>)</span> x/s 0x4027cd
0x4027cd:	 <span class=s2>&#34;%d %d&#34;</span>
</code></pre></td></tr></table>
</div>
</div><p>可知,应该是读入了两个整数.</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-bash data-lang=bash>   0x0000000000400f15 &lt;+50&gt;:	jmpq   *0x402500<span class=o>(</span>,%rax,8<span class=o>)</span>
   0x0000000000400f1c &lt;+57&gt;:	mov    <span class=nv>$0</span>x0,%eax
   0x0000000000400f21 &lt;+62&gt;:	jmp    0x400f28 &lt;phase_3+69&gt;
   0x0000000000400f23 &lt;+64&gt;:	mov    <span class=nv>$0</span>x19c,%eax
   0x0000000000400f28 &lt;+69&gt;:	sub    <span class=nv>$0</span>xcd,%eax
   0x0000000000400f2d &lt;+74&gt;:	jmp    0x400f34 &lt;phase_3+81&gt;
   0x0000000000400f2f &lt;+76&gt;:	mov    <span class=nv>$0</span>x0,%eax
   0x0000000000400f34 &lt;+81&gt;:	add    <span class=nv>$0</span>x29b,%eax
   0x0000000000400f39 &lt;+86&gt;:	jmp    0x400f40 &lt;phase_3+93&gt;
   0x0000000000400f3b &lt;+88&gt;:	mov    <span class=nv>$0</span>x0,%eax
---Type &lt;<span class=k>return</span>&gt; to <span class=k>continue</span>, or q &lt;<span class=k>return</span>&gt; to quit---
   0x0000000000400f40 &lt;+93&gt;:	sub    <span class=nv>$0</span>x36f,%eax
   0x0000000000400f45 &lt;+98&gt;:	jmp    0x400f4c &lt;phase_3+105&gt;
   0x0000000000400f47 &lt;+100&gt;:	mov    <span class=nv>$0</span>x0,%eax
   0x0000000000400f4c &lt;+105&gt;:	add    <span class=nv>$0</span>x36f,%eax
   0x0000000000400f51 &lt;+110&gt;:	jmp    0x400f58 &lt;phase_3+117&gt;
   0x0000000000400f53 &lt;+112&gt;:	mov    <span class=nv>$0</span>x0,%eax
   0x0000000000400f58 &lt;+117&gt;:	sub    <span class=nv>$0</span>x36f,%eax
   0x0000000000400f5d &lt;+122&gt;:	jmp    0x400f64 &lt;phase_3+129&gt;
   0x0000000000400f5f &lt;+124&gt;:	mov    <span class=nv>$0</span>x0,%eax
   0x0000000000400f64 &lt;+129&gt;:	add    <span class=nv>$0</span>x36f,%eax
   0x0000000000400f69 &lt;+134&gt;:	jmp    0x400f70 &lt;phase_3+141&gt;
   0x0000000000400f6b &lt;+136&gt;:	mov    <span class=nv>$0</span>x0,%eax
   0x0000000000400f70 &lt;+141&gt;:	sub    <span class=nv>$0</span>x36f,%eax
   0x0000000000400f75 &lt;+146&gt;:	jmp    0x400f81 &lt;phase_3+158&gt;
   0x0000000000400f77 &lt;+148&gt;:	callq  0x4014e4 &lt;explode_bomb&gt;
   0x0000000000400f7c &lt;+153&gt;:	mov    <span class=nv>$0</span>x0,%eax
   0x0000000000400f81 &lt;+158&gt;:	cmpl   <span class=nv>$0</span>x5,0xc<span class=o>(</span>%rsp<span class=o>)</span>
   0x0000000000400f86 &lt;+163&gt;:	jg     0x400f8e &lt;phase_3+171&gt;
   0x0000000000400f88 &lt;+165&gt;:	cmp    0x8<span class=o>(</span>%rsp<span class=o>)</span>,%eax
   0x0000000000400f8c &lt;+169&gt;:	je     0x400f93 &lt;phase_3+176&gt;
   0x0000000000400f8e &lt;+171&gt;:	callq  0x4014e4 &lt;explode_bomb&gt;
</code></pre></td></tr></table>
</div>
</div><p>由这段汇编代码可知,这是一段 switch 语句,使用输入的第一个值作为 key,
经过对应跳转位置的操作后应与第二个数相等.</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=o>(</span>gdb<span class=o>)</span> p/x *（0x402500 + 32）
<span class=nv>$1</span> <span class=o>=</span> 0x400f47
</code></pre></td></tr></table>
</div>
</div><p>那么第一个数为 0 时,跳转到 0x400f23 处,那么第二个数应该为此处的 0x0,
故一组答案为 4 0;</p>
<h2 id=phase_4>phase_4</h2>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=o>(</span>gdb<span class=o>)</span> disas phase_4
Dump of assembler code <span class=k>for</span> <span class=k>function</span> phase_4:
   0x0000000000400fd0 &lt;+0&gt;:	sub    <span class=nv>$0</span>x18,%rsp
   0x0000000000400fd4 &lt;+4&gt;:	lea    0xc<span class=o>(</span>%rsp<span class=o>)</span>,%rcx
   0x0000000000400fd9 &lt;+9&gt;:	lea    0x8<span class=o>(</span>%rsp<span class=o>)</span>,%rdx
   0x0000000000400fde &lt;+14&gt;:	mov    <span class=nv>$0</span>x4027cd,%esi
   0x0000000000400fe3 &lt;+19&gt;:	mov    <span class=nv>$0</span>x0,%eax
   0x0000000000400fe8 &lt;+24&gt;:	callq  0x400ba0 &lt;__isoc99_sscanf@plt&gt;
   0x0000000000400fed &lt;+29&gt;:	cmp    <span class=nv>$0</span>x2,%eax
   0x0000000000400ff0 &lt;+32&gt;:	jne    0x400ffe &lt;phase_4+46&gt;
   0x0000000000400ff2 &lt;+34&gt;:	mov    0xc<span class=o>(</span>%rsp<span class=o>)</span>,%eax
   0x0000000000400ff6 &lt;+38&gt;:	sub    <span class=nv>$0</span>x2,%eax
   0x0000000000400ff9 &lt;+41&gt;:	cmp    <span class=nv>$0</span>x2,%eax
   0x0000000000400ffc &lt;+44&gt;:	jbe    0x401003 &lt;phase_4+51&gt;
   0x0000000000400ffe &lt;+46&gt;:	callq  0x4014e4 &lt;explode_bomb&gt;
   0x0000000000401003 &lt;+51&gt;:	mov    0xc<span class=o>(</span>%rsp<span class=o>)</span>,%esi
   0x0000000000401007 &lt;+55&gt;:	mov    <span class=nv>$0</span>x9,%edi
   0x000000000040100c &lt;+60&gt;:	callq  0x400f98 &lt;func4&gt;
   0x0000000000401011 &lt;+65&gt;:	cmp    0x8<span class=o>(</span>%rsp<span class=o>)</span>,%eax
   0x0000000000401015 &lt;+69&gt;:	je     0x40101c &lt;phase_4+76&gt;
   0x0000000000401017 &lt;+71&gt;:	callq  0x4014e4 &lt;explode_bomb&gt;
   0x000000000040101c &lt;+76&gt;:	add    <span class=nv>$0</span>x18,%rsp
   0x0000000000401020 &lt;+80&gt;:	retq
End of assembler dump.
</code></pre></td></tr></table>
</div>
</div><p>由代码易知,phase_4 读入了两个数,第二个数在 2-4 之间,然后将第二个数作为
func4 的第二个参数,func4 第一个参数为 9,输入的第一个数必须和 func4 返回值相等.</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=o>(</span>gdb<span class=o>)</span> disas func4
Dump of assembler code <span class=k>for</span> <span class=k>function</span> func4:
   0x0000000000400f98 &lt;+0&gt;:	push   %r12
   0x0000000000400f9a &lt;+2&gt;:	push   %rbp
   0x0000000000400f9b &lt;+3&gt;:	push   %rbx
   0x0000000000400f9c &lt;+4&gt;:	mov    %edi,%ebx
   0x0000000000400f9e &lt;+6&gt;:	<span class=nb>test</span>   %edi,%edi
   0x0000000000400fa0 &lt;+8&gt;:	jle    0x400fc6 &lt;func4+46&gt;
   0x0000000000400fa2 &lt;+10&gt;:	mov    %esi,%ebp
   0x0000000000400fa4 &lt;+12&gt;:	mov    %esi,%eax
   0x0000000000400fa6 &lt;+14&gt;:	cmp    <span class=nv>$0</span>x1,%edi
   0x0000000000400fa9 &lt;+17&gt;:	je     0x400fcb &lt;func4+51&gt;
   0x0000000000400fab &lt;+19&gt;:	lea    -0x1<span class=o>(</span>%rdi<span class=o>)</span>,%edi
   0x0000000000400fae &lt;+22&gt;:	callq  0x400f98 &lt;func4&gt;
   0x0000000000400fb3 &lt;+27&gt;:	lea    <span class=o>(</span>%rax,%rbp,1<span class=o>)</span>,%r12d
   0x0000000000400fb7 &lt;+31&gt;:	lea    -0x2<span class=o>(</span>%rbx<span class=o>)</span>,%edi
   0x0000000000400fba &lt;+34&gt;:	mov    %ebp,%esi
   0x0000000000400fbc &lt;+36&gt;:	callq  0x400f98 &lt;func4&gt;
   0x0000000000400fc1 &lt;+41&gt;:	add    %r12d,%eax
   0x0000000000400fc4 &lt;+44&gt;:	jmp    0x400fcb &lt;func4+51&gt;
   0x0000000000400fc6 &lt;+46&gt;:	mov    <span class=nv>$0</span>x0,%eax
   0x0000000000400fcb &lt;+51&gt;:	pop    %rbx
   0x0000000000400fcc &lt;+52&gt;:	pop    %rbp
   0x0000000000400fcd &lt;+53&gt;:	pop    %r12
   0x0000000000400fcf &lt;+55&gt;:	retq
End of assembler dump.
</code></pre></td></tr></table>
</div>
</div><p>此函数等价于下面的 c 代码</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp>
<span class=kt>int</span> <span class=nf>func4</span><span class=p>(</span><span class=kt>int</span> <span class=n>a</span><span class=p>,</span> <span class=kt>int</span> <span class=n>b</span><span class=p>)</span>
<span class=p>{</span>
    <span class=k>if</span><span class=p>(</span><span class=n>a</span> <span class=o>&lt;=</span> <span class=mi>0</span><span class=p>)</span>
        <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
    <span class=k>if</span><span class=p>(</span><span class=n>a</span> <span class=o>==</span> <span class=mi>1</span><span class=p>)</span>
        <span class=k>return</span> <span class=n>b</span><span class=p>;</span>
    <span class=k>return</span> <span class=n>b</span> <span class=o>+</span> <span class=n>func4</span><span class=p>(</span><span class=n>a</span> <span class=o>-</span> <span class=mi>1</span><span class=p>,</span> <span class=n>b</span><span class=p>)</span> <span class=o>+</span> <span class=n>func4</span><span class=p>(</span><span class=n>n</span> <span class=o>-</span> <span class=mi>2</span><span class=p>,</span> <span class=n>b</span><span class=p>);</span>
<span class=p>}</span>

</code></pre></td></tr></table>
</div>
</div><p>穷举 2-4 的值即可得到答案,取答案为 176 2</p>
<h2 id=phase_5>phase_5</h2>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=o>(</span>gdb<span class=o>)</span> disas phase_5
Dump of assembler code <span class=k>for</span> <span class=k>function</span> phase_5:
   0x0000000000401021 &lt;+0&gt;:	push   %rbx
   0x0000000000401022 &lt;+1&gt;:	mov    %rdi,%rbx
   0x0000000000401025 &lt;+4&gt;:	callq  0x401261 &lt;string_length&gt;
   0x000000000040102a &lt;+9&gt;:	cmp    <span class=nv>$0</span>x6,%eax
   0x000000000040102d &lt;+12&gt;:	je     0x401034 &lt;phase_5+19&gt;
   0x000000000040102f &lt;+14&gt;:	callq  0x4014e4 &lt;explode_bomb&gt;
   0x0000000000401034 &lt;+19&gt;:	mov    <span class=nv>$0</span>x0,%eax
   0x0000000000401039 &lt;+24&gt;:	mov    <span class=nv>$0</span>x0,%edx
   0x000000000040103e &lt;+29&gt;:	movzbl <span class=o>(</span>%rbx,%rax,1<span class=o>)</span>,%ecx
   0x0000000000401042 &lt;+33&gt;:	and    <span class=nv>$0</span>xf,%ecx
   0x0000000000401045 &lt;+36&gt;:	add    0x402540<span class=o>(</span>,%rcx,4<span class=o>)</span>,%edx
   0x000000000040104c &lt;+43&gt;:	add    <span class=nv>$0</span>x1,%rax
   0x0000000000401050 &lt;+47&gt;:	cmp    <span class=nv>$0</span>x6,%rax
   0x0000000000401054 &lt;+51&gt;:	jne    0x40103e &lt;phase_5+29&gt;
   0x0000000000401056 &lt;+53&gt;:	cmp    <span class=nv>$0</span>x27,%edx
   0x0000000000401059 &lt;+56&gt;:	je     0x401060 &lt;phase_5+63&gt;
   0x000000000040105b &lt;+58&gt;:	callq  0x4014e4 &lt;explode_bomb&gt;
   0x0000000000401060 &lt;+63&gt;:	pop    %rbx
   0x0000000000401061 &lt;+64&gt;:	retq
End of assembler dump.
</code></pre></td></tr></table>
</div>
</div><p>由汇编代码可知,需要输入一个长度为 6 的字符串.令该字符串为 input,+36 处出现的
数组为 array,则该汇编等价于下面代码.</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=mi>6</span><span class=p>;</span> <span class=n>i</span><span class=o>++</span><span class=p>)</span>
    <span class=n>sum</span> <span class=o>+=</span> <span class=n>array</span><span class=p>[</span> <span class=n>input</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>&amp;</span> <span class=mh>0xf</span> <span class=p>];</span>
</code></pre></td></tr></table>
</div>
</div><p>意为遍历输入字符串,取该字符串低 4 位作为 array 下标,取出 array 值相加.
查看 array 的值</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=o>(</span>gdb<span class=o>)</span> p/x *0x402540@16
<span class=nv>$2</span> <span class=o>=</span> <span class=o>{</span>0x2, 0xa, 0x6, 0x1, 0xc, 0x10, 0x9, 0x3, 0x4, 0x7, 0xe, 0x5, 0xb, 0x8,
  0xf, 0xd<span class=o>}</span>
</code></pre></td></tr></table>
</div>
</div><p>题目要求 sum = 0x27,故从 array 中选出 6 个和为 0x27 的数,通过这 6 个数的下标找出对应字符.
答案应为 01347L;</p>
<h2 id=phase_6>phase_6</h2>
<p>因为课程未对后续两关作要求,故不做特别详细的解答.</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span><span class=lnt>74
</span><span class=lnt>75
</span><span class=lnt>76
</span><span class=lnt>77
</span><span class=lnt>78
</span><span class=lnt>79
</span><span class=lnt>80
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=o>(</span>gdb<span class=o>)</span> disas phase_6
Dump of assembler code <span class=k>for</span> <span class=k>function</span> phase_6:
   0x0000000000401062 &lt;+0&gt;:	push   %r13
   0x0000000000401064 &lt;+2&gt;:	push   %r12
   0x0000000000401066 &lt;+4&gt;:	push   %rbp
   0x0000000000401067 &lt;+5&gt;:	push   %rbx
   0x0000000000401068 &lt;+6&gt;:	sub    <span class=nv>$0</span>x58,%rsp
   0x000000000040106c &lt;+10&gt;:	lea    0x30<span class=o>(</span>%rsp<span class=o>)</span>,%rsi
   0x0000000000401071 &lt;+15&gt;:	callq  0x40151a &lt;read_six_numbers&gt;
   0x0000000000401076 &lt;+20&gt;:	lea    0x30<span class=o>(</span>%rsp<span class=o>)</span>,%r13
   0x000000000040107b &lt;+25&gt;:	mov    <span class=nv>$0</span>x0,%r12d
   0x0000000000401081 &lt;+31&gt;:	mov    %r13,%rbp
   0x0000000000401084 &lt;+34&gt;:	mov    0x0<span class=o>(</span>%r13<span class=o>)</span>,%eax
   0x0000000000401088 &lt;+38&gt;:	sub    <span class=nv>$0</span>x1,%eax
   0x000000000040108b &lt;+41&gt;:	cmp    <span class=nv>$0</span>x5,%eax
   0x000000000040108e &lt;+44&gt;:	jbe    0x401095 &lt;phase_6+51&gt;
   0x0000000000401090 &lt;+46&gt;:	callq  0x4014e4 &lt;explode_bomb&gt;
   0x0000000000401095 &lt;+51&gt;:	add    <span class=nv>$0</span>x1,%r12d
   0x0000000000401099 &lt;+55&gt;:	cmp    <span class=nv>$0</span>x6,%r12d
   0x000000000040109d &lt;+59&gt;:	jne    0x4010a6 &lt;phase_6+68&gt;
   0x000000000040109f &lt;+61&gt;:	mov    <span class=nv>$0</span>x0,%esi
   0x00000000004010a4 &lt;+66&gt;:	jmp    0x4010e8 &lt;phase_6+134&gt;
   0x00000000004010a6 &lt;+68&gt;:	mov    %r12d,%ebx
   0x00000000004010a9 &lt;+71&gt;:	movslq %ebx,%rax
---Type &lt;<span class=k>return</span>&gt; to <span class=k>continue</span>, or q &lt;<span class=k>return</span>&gt; to quit---
   0x00000000004010ac &lt;+74&gt;:	mov    0x30<span class=o>(</span>%rsp,%rax,4<span class=o>)</span>,%eax
   0x00000000004010b0 &lt;+78&gt;:	cmp    %eax,0x0<span class=o>(</span>%rbp<span class=o>)</span>
   0x00000000004010b3 &lt;+81&gt;:	jne    0x4010ba &lt;phase_6+88&gt;
   0x00000000004010b5 &lt;+83&gt;:	callq  0x4014e4 &lt;explode_bomb&gt;
   0x00000000004010ba &lt;+88&gt;:	add    <span class=nv>$0</span>x1,%ebx
   0x00000000004010bd &lt;+91&gt;:	cmp    <span class=nv>$0</span>x5,%ebx
   0x00000000004010c0 &lt;+94&gt;:	jle    0x4010a9 &lt;phase_6+71&gt;
   0x00000000004010c2 &lt;+96&gt;:	add    <span class=nv>$0</span>x4,%r13
   0x00000000004010c6 &lt;+100&gt;:	jmp    0x401081 &lt;phase_6+31&gt;
   0x00000000004010c8 &lt;+102&gt;:	mov    0x8<span class=o>(</span>%rdx<span class=o>)</span>,%rdx
   0x00000000004010cc &lt;+106&gt;:	add    <span class=nv>$0</span>x1,%eax
   0x00000000004010cf &lt;+109&gt;:	cmp    %ecx,%eax
   0x00000000004010d1 &lt;+111&gt;:	jne    0x4010c8 &lt;phase_6+102&gt;
   0x00000000004010d3 &lt;+113&gt;:	jmp    0x4010da &lt;phase_6+120&gt;
   0x00000000004010d5 &lt;+115&gt;:	mov    <span class=nv>$0</span>x603410,%edx
   0x00000000004010da &lt;+120&gt;:	mov    %rdx,<span class=o>(</span>%rsp,%rsi,2<span class=o>)</span>
   0x00000000004010de &lt;+124&gt;:	add    <span class=nv>$0</span>x4,%rsi
   0x00000000004010e2 &lt;+128&gt;:	cmp    <span class=nv>$0</span>x18,%rsi
   0x00000000004010e6 &lt;+132&gt;:	je     0x4010fd &lt;phase_6+155&gt;
   0x00000000004010e8 &lt;+134&gt;:	mov    0x30<span class=o>(</span>%rsp,%rsi,1<span class=o>)</span>,%ecx
   0x00000000004010ec &lt;+138&gt;:	cmp    <span class=nv>$0</span>x1,%ecx
   0x00000000004010ef &lt;+141&gt;:	jle    0x4010d5 &lt;phase_6+115&gt;
   0x00000000004010f1 &lt;+143&gt;:	mov    <span class=nv>$0</span>x1,%eax
---Type &lt;<span class=k>return</span>&gt; to <span class=k>continue</span>, or q &lt;<span class=k>return</span>&gt; to quit---
   0x00000000004010f6 &lt;+148&gt;:	mov    <span class=nv>$0</span>x603410,%edx
   0x00000000004010fb &lt;+153&gt;:	jmp    0x4010c8 &lt;phase_6+102&gt;
   0x00000000004010fd &lt;+155&gt;:	mov    <span class=o>(</span>%rsp<span class=o>)</span>,%rbx
   0x0000000000401101 &lt;+159&gt;:	lea    0x8<span class=o>(</span>%rsp<span class=o>)</span>,%rax
   0x0000000000401106 &lt;+164&gt;:	lea    0x30<span class=o>(</span>%rsp<span class=o>)</span>,%rsi
   0x000000000040110b &lt;+169&gt;:	mov    %rbx,%rcx
   0x000000000040110e &lt;+172&gt;:	mov    <span class=o>(</span>%rax<span class=o>)</span>,%rdx
   0x0000000000401111 &lt;+175&gt;:	mov    %rdx,0x8<span class=o>(</span>%rcx<span class=o>)</span>
   0x0000000000401115 &lt;+179&gt;:	add    <span class=nv>$0</span>x8,%rax
   0x0000000000401119 &lt;+183&gt;:	cmp    %rsi,%rax
   0x000000000040111c &lt;+186&gt;:	je     0x401123 &lt;phase_6+193&gt;
   0x000000000040111e &lt;+188&gt;:	mov    %rdx,%rcx
   0x0000000000401121 &lt;+191&gt;:	jmp    0x40110e &lt;phase_6+172&gt;
   0x0000000000401123 &lt;+193&gt;:	movq   <span class=nv>$0</span>x0,0x8<span class=o>(</span>%rdx<span class=o>)</span>
   0x000000000040112b &lt;+201&gt;:	mov    <span class=nv>$0</span>x5,%ebp
   0x0000000000401130 &lt;+206&gt;:	mov    0x8<span class=o>(</span>%rbx<span class=o>)</span>,%rax
   0x0000000000401134 &lt;+210&gt;:	mov    <span class=o>(</span>%rax<span class=o>)</span>,%eax
   0x0000000000401136 &lt;+212&gt;:	cmp    %eax,<span class=o>(</span>%rbx<span class=o>)</span>
   0x0000000000401138 &lt;+214&gt;:	jge    0x40113f &lt;phase_6+221&gt;
   0x000000000040113a &lt;+216&gt;:	callq  0x4014e4 &lt;explode_bomb&gt;
   0x000000000040113f &lt;+221&gt;:	mov    0x8<span class=o>(</span>%rbx<span class=o>)</span>,%rbx
   0x0000000000401143 &lt;+225&gt;:	sub    <span class=nv>$0</span>x1,%ebp
   0x0000000000401146 &lt;+228&gt;:	jne    0x401130 &lt;phase_6+206&gt;
---Type &lt;<span class=k>return</span>&gt; to <span class=k>continue</span>, or q &lt;<span class=k>return</span>&gt; to quit---
   0x0000000000401148 &lt;+230&gt;:	add    <span class=nv>$0</span>x58,%rsp
   0x000000000040114c &lt;+234&gt;:	pop    %rbx
   0x000000000040114d &lt;+235&gt;:	pop    %rbp
   0x000000000040114e &lt;+236&gt;:	pop    %r12
   0x0000000000401150 &lt;+238&gt;:	pop    %r13
   0x0000000000401152 &lt;+240&gt;:	retq
End of assembler dump.
</code></pre></td></tr></table>
</div>
</div><p>汇编代码很长.其意为输入 6 个互不相等的数,介于 1-6.按这 6 个数的值从位于地址 0x603410 的链表中选出对应位置的
节点指针,组成一个数组.按选出的顺序将这六个节点组成新的链表,然后检查这个链表是否为降序.
查看链表的值.</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=o>(</span>gdb<span class=o>)</span> p/x *<span class=o>(</span>0x603410<span class=o>)</span>
<span class=nv>$3</span> <span class=o>=</span> 0x1cf
<span class=o>(</span>gdb<span class=o>)</span> p/x *<span class=o>(</span>0x603410 + 8<span class=o>)</span>
<span class=nv>$4</span> <span class=o>=</span> 0x603420
<span class=o>(</span>gdb<span class=o>)</span> p/x *<span class=o>(</span>0x603420<span class=o>)</span>
<span class=nv>$5</span> <span class=o>=</span> 0x188
<span class=o>(</span>gdb<span class=o>)</span> p/x *<span class=o>(</span>0x603420 + 8<span class=o>)</span>
<span class=nv>$6</span> <span class=o>=</span> 0x603430
<span class=o>(</span>gdb<span class=o>)</span> p/x *<span class=o>(</span>0x603430<span class=o>)</span>
<span class=nv>$7</span> <span class=o>=</span> 0x1d1
<span class=o>(</span>gdb<span class=o>)</span> p/x *<span class=o>(</span>0x603430 + 8<span class=o>)</span>
<span class=nv>$8</span> <span class=o>=</span> 0x603440
<span class=o>(</span>gdb<span class=o>)</span> p/x *<span class=o>(</span>0x603440<span class=o>)</span>
<span class=nv>$9</span> <span class=o>=</span> 0x174
<span class=o>(</span>gdb<span class=o>)</span> p/x *<span class=o>(</span>0x603440 + 8<span class=o>)</span>
<span class=nv>$10</span> <span class=o>=</span> 0x603450
<span class=o>(</span>gdb<span class=o>)</span> p/x *<span class=o>(</span>0x603450<span class=o>)</span>
<span class=nv>$11</span> <span class=o>=</span> 0x220
<span class=o>(</span>gdb<span class=o>)</span> p/x *<span class=o>(</span>0x603450 + 8<span class=o>)</span>
<span class=nv>$12</span> <span class=o>=</span> 0x603460
<span class=o>(</span>gdb<span class=o>)</span> p/x *<span class=o>(</span>0x603460 + 8<span class=o>)</span>
<span class=nv>$13</span> <span class=o>=</span> 0x0
</code></pre></td></tr></table>
</div>
</div><p>故答案应为 6 5 3 1 2 4;</p>
<h2 id=secret_phase>secret_phase</h2>
<p>正常通过前 6 关是无法触发 secret_phase 的,查看汇编发现,在 phase_4 答案之后输入 DrEvil 即可进入 secret_phase.</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=o>(</span>gdb<span class=o>)</span> disas secret_phase
Dump of assembler code <span class=k>for</span> <span class=k>function</span> secret_phase:
   0x0000000000401191 &lt;+0&gt;:	push   %rbx
   0x0000000000401192 &lt;+1&gt;:	callq  0x40155c &lt;read_line&gt;
   0x0000000000401197 &lt;+6&gt;:	mov    <span class=nv>$0</span>xa,%edx
   0x000000000040119c &lt;+11&gt;:	mov    <span class=nv>$0</span>x0,%esi
   0x00000000004011a1 &lt;+16&gt;:	mov    %rax,%rdi
   0x00000000004011a4 &lt;+19&gt;:	callq  0x400b80 &lt;strtol@plt&gt;
   0x00000000004011a9 &lt;+24&gt;:	mov    %rax,%rbx
   0x00000000004011ac &lt;+27&gt;:	lea    -0x1<span class=o>(</span>%rax<span class=o>)</span>,%eax
   0x00000000004011af &lt;+30&gt;:	cmp    <span class=nv>$0</span>x3e8,%eax
   0x00000000004011b4 &lt;+35&gt;:	jbe    0x4011bb &lt;secret_phase+42&gt;
   0x00000000004011b6 &lt;+37&gt;:	callq  0x4014e4 &lt;explode_bomb&gt;
   0x00000000004011bb &lt;+42&gt;:	mov    %ebx,%esi
   0x00000000004011bd &lt;+44&gt;:	mov    <span class=nv>$0</span>x603230,%edi
   0x00000000004011c2 &lt;+49&gt;:	callq  0x401153 &lt;fun7&gt;
   0x00000000004011c7 &lt;+54&gt;:	cmp    <span class=nv>$0</span>x4,%eax
   0x00000000004011ca &lt;+57&gt;:	je     0x4011d1 &lt;secret_phase+64&gt;
   0x00000000004011cc &lt;+59&gt;:	callq  0x4014e4 &lt;explode_bomb&gt;
   0x00000000004011d1 &lt;+64&gt;:	mov    <span class=nv>$0</span>x4024d0,%edi
   0x00000000004011d6 &lt;+69&gt;:	callq  0x400ac0 &lt;puts@plt&gt;
   0x00000000004011db &lt;+74&gt;:	callq  0x401682 &lt;phase_defused&gt;
   0x00000000004011e0 &lt;+79&gt;:	pop    %rbx
   0x00000000004011e1 &lt;+80&gt;:	retq
---Type &lt;<span class=k>return</span>&gt; to <span class=k>continue</span>, or q &lt;<span class=k>return</span>&gt; to quit---
End of assembler dump.
</code></pre></td></tr></table>
</div>
</div><div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=o>(</span>gdb<span class=o>)</span> disas fun7
Dump of assembler code <span class=k>for</span> <span class=k>function</span> fun7:
   0x0000000000401153 &lt;+0&gt;:	sub    <span class=nv>$0</span>x8,%rsp
   0x0000000000401157 &lt;+4&gt;:	<span class=nb>test</span>   %rdi,%rdi
   0x000000000040115a &lt;+7&gt;:	je     0x401187 &lt;fun7+52&gt;
   0x000000000040115c &lt;+9&gt;:	mov    <span class=o>(</span>%rdi<span class=o>)</span>,%edx
   0x000000000040115e &lt;+11&gt;:	cmp    %esi,%edx
   0x0000000000401160 &lt;+13&gt;:	jle    0x40116f &lt;fun7+28&gt;
   0x0000000000401162 &lt;+15&gt;:	mov    0x8<span class=o>(</span>%rdi<span class=o>)</span>,%rdi
   0x0000000000401166 &lt;+19&gt;:	callq  0x401153 &lt;fun7&gt;
   0x000000000040116b &lt;+24&gt;:	add    %eax,%eax
   0x000000000040116d &lt;+26&gt;:	jmp    0x40118c &lt;fun7+57&gt;
   0x000000000040116f &lt;+28&gt;:	mov    <span class=nv>$0</span>x0,%eax
   0x0000000000401174 &lt;+33&gt;:	cmp    %esi,%edx
   0x0000000000401176 &lt;+35&gt;:	je     0x40118c &lt;fun7+57&gt;
   0x0000000000401178 &lt;+37&gt;:	mov    0x10<span class=o>(</span>%rdi<span class=o>)</span>,%rdi
   0x000000000040117c &lt;+41&gt;:	callq  0x401153 &lt;fun7&gt;
   0x0000000000401181 &lt;+46&gt;:	lea    0x1<span class=o>(</span>%rax,%rax,1<span class=o>)</span>,%eax
   0x0000000000401185 &lt;+50&gt;:	jmp    0x40118c &lt;fun7+57&gt;
   0x0000000000401187 &lt;+52&gt;:	mov    <span class=nv>$0</span>xffffffff,%eax
   0x000000000040118c &lt;+57&gt;:	add    <span class=nv>$0</span>x8,%rsp
   0x0000000000401190 &lt;+61&gt;:	retq
End of assembler dump.
</code></pre></td></tr></table>
</div>
</div><p>此题题意为在一个题目中构建好的平衡二叉树中从根节点开始查找一个输入的数.
由节点向左为 0,由节点向右为 1,查找路径序的 0-1 列从右向左构成一个二进制数,该
二进制数的十进制值必须等于题目中提供的数,其为 4,那么所需查找路径序列为 100,
根据二叉树结构,应该查找 7,故答案为 7.</p>
<h2 id=运行截图>运行截图</h2>
<p><img class=lazyload src=/svg/loading.min.svg data-src=CSAPP-Bomb-lab/ret1.png data-srcset="/CSAPP-Bomb-lab/ret1.png, CSAPP-Bomb-lab/ret1.png 1.5x, /CSAPP-Bomb-lab/ret1.png 2x" data-sizes=auto alt=/CSAPP-Bomb-lab/ret1.png title=结果></p>
</div><div class=post-footer id=post-footer>
<div class=post-info>
<div class=post-info-line>
<div class=post-info-mod>
<span>更新于 2018-12-01</span>
</div>
<div class=post-info-license></div>
</div>
<div class=post-info-line>
<div class=post-info-md><span>
<a class=link-to-markdown href=/posts/csapp-bomb-lab/index.md target=_blank>阅读原始文档</a>
</span></div>
<div class=post-info-share>
<span><a href=javascript:void(0); title="分享到 Twitter" data-sharer=twitter data-url=https://wmc1999.top/posts/csapp-bomb-lab/ data-title="CS:APP Bomb lab" data-via=Jason210314 data-hashtags=CS:APP,汇编,二进制炸弹><i class="fab fa-twitter fa-fw"></i></a></span>
</div>
</div>
</div>
<div class=post-info-more>
<section class=post-tags><i class="fas fa-tags fa-fw"></i>&nbsp;<a href=/tags/csapp/>CS:APP</a>,&nbsp;<a href=/tags/%E6%B1%87%E7%BC%96/>汇编</a>,&nbsp;<a href=/tags/%E4%BA%8C%E8%BF%9B%E5%88%B6%E7%82%B8%E5%BC%B9/>二进制炸弹</a></section>
<section>
<span><a href=javascript:void(0); onclick=window.history.back()>返回</a></span>&nbsp;|&nbsp;<span><a href=/>主页</a></span>
</section>
</div>
<div class=post-nav><a href=/posts/ds-bm/ class=prev rel=prev title=数据结构:BM算法><i class="fas fa-angle-left fa-fw"></i>数据结构:BM算法</a>
<a href=/posts/csapp-attack-lab/ class=next rel=next title="CS:APP Attack lab">CS:APP Attack lab<i class="fas fa-angle-right fa-fw"></i></a></div>
</div>
<div id=comments><div id=disqus_thread class=comment></div><noscript>
Please enable JavaScript to view the comments powered by <a href=https://disqus.com/?ref_noscript>Disqus</a>.
</noscript></div></article></div>
</main><footer class=footer>
<div class=footer-container><div class=footer-line>由 <a href=https://gohugo.io/ target=_blank rel="noopener noreffer" title="Hugo 0.92.1">Hugo</a> 强力驱动 | 主题 - <a href=https://github.com/dillonzq/LoveIt target=_blank rel="noopener noreffer" title="LoveIt 0.2.10"><i class="far fa-kiss-wink-heart fa-fw"></i> LoveIt</a>
</div><div class=footer-line><i class="far fa-copyright fa-fw"></i><span itemprop=copyrightYear>2019 - 2022</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=https://github.com/waruto210 target=_blank>waruto210</a></span>&nbsp;|&nbsp;<span class=license><a rel="license external nofollow noopener noreffer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div>
</div>
</footer></div>
<div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title=回到顶部>
<i class="fas fa-arrow-up fa-fw"></i>
</a><a href=# id=view-comments class=fixed-button title=查看评论>
<i class="fas fa-comment fa-fw"></i>
</a>
</div><link rel=stylesheet href=/lib/katex/katex.min.css><link rel=stylesheet href=/lib/katex/copy-tex.min.css><script type=text/javascript src=https://wmc1999.disqus.com/embed.js defer></script><script type=text/javascript src=/lib/smooth-scroll/smooth-scroll.min.js></script><script type=text/javascript src=/lib/autocomplete/autocomplete.min.js></script><script type=text/javascript src=/lib/lunr/lunr.min.js></script><script type=text/javascript src=/lib/lunr/lunr.stemmer.support.min.js></script><script type=text/javascript src=/lib/lunr/lunr.zh.min.js></script><script type=text/javascript src=/lib/lazysizes/lazysizes.min.js></script><script type=text/javascript src=/lib/clipboard/clipboard.min.js></script><script type=text/javascript src=/lib/sharer/sharer.min.js></script><script type=text/javascript src=/lib/katex/katex.min.js></script><script type=text/javascript src=/lib/katex/auto-render.min.js></script><script type=text/javascript src=/lib/katex/copy-tex.min.js></script><script type=text/javascript src=/lib/katex/mhchem.min.js></script><script type=text/javascript>window.config={code:{copyTitle:"复制到剪贴板",maxShownLines:10},comment:{},math:{delimiters:[{display:!0,left:"$$",right:"$$"},{display:!0,left:"\\[",right:"\\]"},{display:!1,left:"$",right:"$"},{display:!1,left:"\\(",right:"\\)"}],strict:!1},search:{highlightTag:"em",lunrIndexURL:"/index.json",lunrLanguageCode:"zh",lunrSegmentitURL:"/lib/lunr/lunr.segmentit.js",maxResultLength:10,noResultsFound:"没有找到结果",snippetLength:50,type:"lunr"}}</script><script type=text/javascript src=/js/theme.min.js></script><script type=text/javascript>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','UA-164518488-1',{anonymize_ip:!0})</script><script type=text/javascript src="https://www.googletagmanager.com/gtag/js?id=UA-164518488-1" async></script></body>
</html>