<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><title>Rust生命周期与变形 - OneStep</title><meta name=Description content="用尽全力，活成一个普通人"><meta property="og:title" content="Rust生命周期与变形"><meta property="og:description" content="最近对 rust 的生命周期有一些疑惑，在找资料学习的过程中自然就了解到由 rust 生命周期导出的 rust subtype、variance 的概念，对这一块儿的学习也"><meta property="og:type" content="article"><meta property="og:url" content="https://waruto.top/posts/rust-lifetime-variance/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2021-04-29T10:16:32+00:00"><meta property="article:modified_time" content="2021-04-29T10:16:32+00:00"><meta property="og:site_name" content="My cool site"><meta name=twitter:card content="summary"><meta name=twitter:title content="Rust生命周期与变形"><meta name=twitter:description content="最近对 rust 的生命周期有一些疑惑，在找资料学习的过程中自然就了解到由 rust 生命周期导出的 rust subtype、variance 的概念，对这一块儿的学习也"><meta name=application-name content="OneStep"><meta name=apple-mobile-web-app-title content="OneStep"><meta name=theme-color content="#ffffff"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://waruto.top/posts/rust-lifetime-variance/><link rel=prev href=https://waruto.top/posts/6-s081-lab10-mmap/><link rel=next href=https://waruto.top/posts/mit-6.830-lab1/><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/normalize.css@8.0.1/normalize.min.css><link rel=stylesheet href=/css/style.min.css><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"Rust生命周期与变形","inLanguage":"zh-CN","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/waruto.top\/posts\/rust-lifetime-variance\/"},"genre":"posts","keywords":"rust, variance, subtype","wordcount":3173,"url":"https:\/\/waruto.top\/posts\/rust-lifetime-variance\/","datePublished":"2021-04-29T10:16:32+00:00","dateModified":"2021-04-29T10:16:32+00:00","publisher":{"@type":"Organization","name":""},"author":{"@type":"Person","name":"waruto210"},"description":""}</script></head><body data-header-desktop=fixed data-header-mobile=auto><script type=text/javascript>(window.localStorage&&localStorage.getItem("theme")?localStorage.getItem("theme")==="dark":"auto"==="auto"?window.matchMedia("(prefers-color-scheme: dark)").matches:"auto"==="dark")&&document.body.setAttribute("theme","dark")</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title=OneStep><img class="lazyload logo" src=/svg/loading.min.svg data-src=/images/logo.jpeg data-srcset="/images/logo.jpeg, /images/logo.jpeg 1.5x, /images/logo.jpeg 2x" data-sizes=auto alt=/images/logo.jpeg title=/images/logo.jpeg width=610 height=610>OneStep</a></div><div class=menu><div class=menu-inner><a class=menu-item href=/>首页 </a><a class=menu-item href=/posts/>文章 </a><a class=menu-item href=/tags/>标签 </a><a class=menu-item href=/categories/>分类 </a><a class=menu-item href=/friendlinks>友链 </a><a class=menu-item href=/about>关于 </a><span class="menu-item delimiter"></span><span class="menu-item search" id=search-desktop>
<input type=text placeholder=搜索文章标题或内容... id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=搜索><i class="fas fa-search fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=清空><i class="fas fa-times-circle fa-fw" aria-hidden=true></i></a>
<span class="search-button search-loading" id=search-loading-desktop><i class="fas fa-spinner fa-fw fa-spin" aria-hidden=true></i></span>
</span><a href=javascript:void(0); class="menu-item theme-switch" title=切换主题><i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title=OneStep><img class="lazyload logo" src=/svg/loading.min.svg data-src=/images/logo.jpeg data-srcset="/images/logo.jpeg, /images/logo.jpeg 1.5x, /images/logo.jpeg 2x" data-sizes=auto alt=/images/logo.jpeg title=/images/logo.jpeg width=610 height=610>OneStep</a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><div class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder=搜索文章标题或内容... id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=搜索><i class="fas fa-search fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=清空><i class="fas fa-times-circle fa-fw" aria-hidden=true></i></a>
<span class="search-button search-loading" id=search-loading-mobile><i class="fas fa-spinner fa-fw fa-spin" aria-hidden=true></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>取消</a></div><a class=menu-item href=/ title>首页</a><a class=menu-item href=/posts/ title>文章</a><a class=menu-item href=/tags/ title>标签</a><a class=menu-item href=/categories/ title>分类</a><a class=menu-item href=/friendlinks title>友链</a><a class=menu-item href=/about title>关于</a><a href=javascript:void(0); class="menu-item theme-switch" title=切换主题>
<i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=main><div class=container><div class=toc id=toc-auto><h2 class=toc-title>目录</h2><div class=toc-content id=toc-content-auto></div></div><article class="page single"><h1 class="single-title animate__animated animate__flipInX">Rust生命周期与变形</h1><div class=post-meta><div class=post-meta-line><span class=post-author><a href=https://github.com/waruto210 title=Author target=_blank rel="noopener noreffer author" class=author><i class="fas fa-user-circle fa-fw" aria-hidden=true></i>waruto210</a>
</span>&nbsp;<span class=post-category>收录于 <a href=/categories/rust/><i class="far fa-folder fa-fw" aria-hidden=true></i>rust</a></span></div><div class=post-meta-line><i class="far fa-calendar-alt fa-fw" aria-hidden=true></i>&nbsp;<time datetime=2021-04-29>2021-04-29</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden=true></i>&nbsp;约 3173 字&nbsp;
<i class="far fa-clock fa-fw" aria-hidden=true></i>&nbsp;预计阅读 7 分钟&nbsp;</div></div><div class="details toc" id=toc-static data-kept=true><div class="details-summary toc-title"><span>目录</span>
<span><i class="details-icon fas fa-angle-right" aria-hidden=true></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#子类型与变形>子类型与变形</a></li><li><a href=#变形与类型安全>变形与类型安全</a></li><li><a href=#rust-生命周期>Rust 生命周期</a></li><li><a href=#资料援引>资料援引</a></li></ul></nav></div></div><div class=content id=content><p>最近对 rust 的生命周期有一些疑惑，在找资料学习的过程中自然就了解到由 rust 生命周期导出的 rust subtype、variance 的概念，对这一块儿的学习也解答了我一些对其他语言的问题,同时我也被认识的大佬赶鸭子上架,在 BUPT Rust Meetup 做了分享,<a href=https://github.com/waruto210/waruto210.github.io/blob/hexo/source/_posts/rust-lifetime-variance/variance_rust.key target=_blank rel="noopener noreffer">keynote 讲稿在此</a>
。</p><h2 id=子类型与变形>子类型与变形</h2><p>子类型是程序语言类型系统中的一个概念，Wikipedia 对其有如下解释：</p><blockquote><p>If S is a subtype of T, the subtyping relation is often written S &lt;: T, to mean that any term of type S can be safely used in a context where a term of type T is expected.</p></blockquote><p>许多语言的类型系统都支持子类型，最直接、最熟悉的应当就是面向对象中继承关系形成的子类型。例如<code>Cat</code>类继承了<code>Animal</code>类，那么<code>Cat</code>是<code>Animal</code>的子类型（<code>Cat &lt;: Animal</code>），直觉上很容易想到，任何需要<code>Animal</code>的表达式，我们都可以用<code>Cat</code>去替换，这也是里氏替换原则(Liskov substitution principle)：</p><blockquote><p>Let $q(x)$ be a property provable about $x$ of type T. Then $q(y)$ should be true for objects $y$ of type $S$ where $S$ is a subtype of T.</p></blockquote><p>继承关系很直接导出了两个具体类型的之间的子类型关系，可由类型构造器产生的一些更复杂的类型之间的子类型关系如何确定呢？</p><p><code>F(T)</code>为类型构造器，<code>S &lt;: T</code>， 那么<code>F(S)</code>和<code>F(T)</code>的有没有子类型关系呢?如果有，谁是谁的子类型呢？复杂类型之间的子类型关系取决于类型构造器，相对于原始类型，可能是保持、反转或者无关。</p><ul><li>如果是是保持，即<code>F(S) &lt;: F(T)</code>，则称之为协变(<code>covariant</code>)</li><li>如果是反转，即<code>F(T) &lt;: F(S)</code>，则称之为逆变(<code>contravariant</code>)</li><li>如果是无关，则称之为不变/抗变(<code>invariant</code>)</li></ul><p><code>covariant</code>、<code>contravariant</code>的概念来自于范畴论(<code>Category Theory</code>)中的函子(<code>Functor</code>)。</p><h2 id=变形与类型安全>变形与类型安全</h2><p>在下面的 Java 代码中，<code>Cat[]</code>赋值给<code>Animal[]</code>类型的变量可以通过编译，但是<code>ArrayList&lt;Cat></code>赋值给<code>ArrayList&lt;Animal></code>类型的变量则无法通过编译。说明 Java 在编译时对数组采用了协变，而对泛型容器采用了抗变。但是在运行时，对数组元素进行错误的赋值，会抛出运行时错误，这实际是一种对于编译期数组协变的补救，数组采用协变本身是一种很差劲的设计。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>static</span> <span class=kd>class</span> <span class=nc>Animal</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>  <span class=kd>private</span> <span class=kt>int</span> <span class=n>name</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>static</span> <span class=kd>class</span> <span class=nc>Cat</span> <span class=kd>extends</span> <span class=n>Animal</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>  <span class=kd>public</span> <span class=nf>Cat</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kd>public</span> <span class=kt>void</span> <span class=nf>meow</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;meow&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>static</span> <span class=kd>class</span> <span class=nc>Dog</span> <span class=kd>extends</span> <span class=n>Animal</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>  <span class=kd>public</span> <span class=nf>Dog</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kd>public</span> <span class=kt>void</span> <span class=nf>bark</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;bark&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=o>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>Exception</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>  <span class=c1>// covariant, ok
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=n>Animal</span><span class=o>[]</span> <span class=n>animals</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Animal</span><span class=o>[</span><span class=n>10</span><span class=o>];</span>
</span></span><span class=line><span class=cl>  <span class=n>animals</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Cat</span><span class=o>[</span><span class=n>10</span><span class=o>];</span>
</span></span><span class=line><span class=cl>  <span class=c1>// runtime error
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=n>animals</span><span class=o>[</span><span class=n>0</span><span class=o>]</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Dog</span><span class=o>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>// invariant, compile error
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=n>List</span><span class=o>&lt;</span><span class=n>Animal</span><span class=o>&gt;</span> <span class=n>listAnimals</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ArrayList</span><span class=o>&lt;</span><span class=n>Animal</span><span class=o>&gt;();</span>
</span></span><span class=line><span class=cl>  <span class=n>listAnimals</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ArrayList</span><span class=o>&lt;</span><span class=n>Cat</span><span class=o>&gt;();</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div><p>由此可见，对于支持子类型的语言，变形的设计是非常重要，其会影响程序的类型安全。</p><p>那么，什么时候采用协变，什么时候采用逆变，又在什么时候采用抗变呢？</p><p>想一下这样一个程序，一个函数，接受一个笼子参数，笼子里面装着动物，不管传递的笼子参数中装着什么动物，都将笼子中的动物替换成一只狗，这样做的话，当调用完函数后，外部程序继续将笼子中的动物当作原动物来对待，类型安全就完蛋了。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>static</span> <span class=kd>class</span> <span class=nc>Cage</span><span class=o>&lt;</span><span class=n>T</span> <span class=kd>extends</span> <span class=n>Animal</span><span class=o>&gt;</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>  <span class=kd>public</span> <span class=n>T</span> <span class=n>inner</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kd>public</span> <span class=nf>Cage</span><span class=o>(</span><span class=n>T</span> <span class=n>a</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=o>.</span><span class=na>inner</span> <span class=o>=</span> <span class=n>a</span><span class=o>;</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>static</span> <span class=kt>void</span> <span class=nf>evil_feed</span><span class=o>(</span><span class=n>Cage</span><span class=o>&lt;</span><span class=n>Animal</span><span class=o>&gt;</span> <span class=n>cage</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>  <span class=n>cage</span><span class=o>.</span><span class=na>inner</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Dog</span><span class=o>();</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=o>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>Exception</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>  <span class=n>Cage</span><span class=o>&lt;</span><span class=n>Cat</span><span class=o>&gt;</span> <span class=n>cage</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Cage</span><span class=o>&lt;</span><span class=n>Cat</span><span class=o>&gt;(</span><span class=k>new</span> <span class=n>Cat</span><span class=o>());</span>
</span></span><span class=line><span class=cl>  <span class=n>evil_feed</span><span class=o>(</span><span class=n>cage</span><span class=o>);</span>
</span></span><span class=line><span class=cl>  <span class=n>cage</span><span class=o>.</span><span class=na>inner</span><span class=o>.</span><span class=na>meow</span><span class=o>();</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div><p>上面的这段 Java 代码当然是无法编译成功的，因为 Java 不对泛型容器使用协变。但是不能使用协变的依据是什么呢？是<strong>读写</strong>操作。</p><p>如果一个容器<strong>只读</strong>，那么我们可以使用协变，将一个<code>Cage&lt;Cat></code>当作<code>Cage&lt;Animal></code>读取，任何时候都不会出错；如果类型<strong>只写</strong>，那么函数中的操作只能对容器内容进行写入或者什么都不做，此时我们可以考虑逆变，即<code>Cage&lt;Animal></code>是<code>Cage&lt;Dog></code>的子类型，对于任何需要<code>Cage&lt;Dog></code>的函数，我们都可以传入<code>Cage&lt;Animal></code>，函数只会向其中写入一只<code>Dog</code>，而不关心原来是什么，并且程序也永远也不会去读<code>Cage</code>里的东西，程序语言中，逆变基本不出现；如果类型可读可写，那么只能是抗变，要求类型严格一致来保证类型安全。</p><p>类型构造器导致逆变的情况非常少，主要出现在以函数作为类型构造器时：</p><p>$$
F(U) \rightarrow V
$$</p><p>如上的一元函数，接受一个<code>U</code>类型的参数，返回一个<code>V</code>类型的值。如果有<code>U &lt;: T</code>，那么任何需要$F(U) \rightarrow V$的地方，可以使用$F(T) \rightarrow V$代替，这很直观，因为<code>U</code>是<code>T</code>的子类型，所以一个能处理 T 类型的函数必然能处理 U 类型，例如一个能计算<code>Animal</code>年龄的函数一定也能计算<code>Cat</code>的年龄，所以有：</p><p>$$
U &lt;: T \Rightarrow F(T) \rightarrow V &lt;: F(U) \rightarrow V
$$</p><p>即我们可以用一个作用域较大的函数代替一个作用域较小的函数，因为我们可以在使用时安全地收缩它的作用域至和后者一样，即只使用<code>Animal</code>中属于<code>Cat</code>的那一部分。</p><h2 id=rust-生命周期>Rust 生命周期</h2><p>Rust 没有类型继承，但是 Rust 有 lifetime 啊，所以 Rust 的子类型必定是指 lifetime 之间的关系。</p><p>在 Rust 中，<code>'a:'b</code>意思是<code>'a</code> <strong>outlives</strong> <code>'b</code>，即<code>'a</code>表示的生命周期大于等于<code>'b</code>，也代表着<code>'a &lt;: 'b</code>。乍一看有点反直觉，但也很好理解。<code>'a:'b</code>代表<code>'a</code>至少和<code>'b</code>一样长，即<code>'a</code>比<code>'b</code>更加特化，就像<code>Cat</code>至少是种<code>Animal</code>，<code>Cat</code>更加特化。<code>'static</code>关键字代表静态生命周期，在程序的整个生命周期中持续存在，所以<code>'static</code>是任意生命周期<code>'a</code>的子类型。</p><p>我们经常会感叹于 Rust 编译器的智能，能准确推断出程序中某个引用的生命周期不够长、不匹配。这同时也是子类型和变形的功劳。根据上文讨论的结论，Rust 生命周期的子类型有如下变形规则：</p><table><thead><tr><th></th><th></th><th>&lsquo;a</th><th>T</th><th>U</th></tr></thead><tbody><tr><td>*</td><td><code>&'a T</code></td><td>covariant</td><td>covariant</td><td></td></tr><tr><td>*</td><td><code>&'a mut T</code></td><td>covariant</td><td>invariant</td><td></td></tr><tr><td>*</td><td><code>Box&lt;T></code></td><td></td><td>covariant</td><td></td></tr><tr><td></td><td><code>Vec&lt;T></code></td><td></td><td>covariant</td><td></td></tr><tr><td>*</td><td><code>UnsafeCell&lt;T></code></td><td></td><td>invariant</td><td></td></tr><tr><td></td><td><code>Cell&lt;T></code></td><td></td><td>invariant</td><td></td></tr><tr><td>*</td><td><code>fn(T) -> U</code></td><td></td><td><strong>contra</strong>variant</td><td>covariant</td></tr><tr><td></td><td><code>*const T</code></td><td></td><td>covariant</td><td></td></tr><tr><td></td><td><code>*mut T</code></td><td></td><td>invariant</td><td></td></tr></tbody></table><p>我们看如下这个例子：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-rust data-lang=rust><span class=line><span class=cl><span class=k>fn</span> <span class=nf>evil_feeder</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span><span class=p>(</span><span class=n>input</span>: <span class=kp>&amp;</span><span class=nc>mut</span><span class=w> </span><span class=n>T</span><span class=p>,</span><span class=w> </span><span class=n>val</span>: <span class=nc>T</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=o>*</span><span class=n>input</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>val</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>fn</span> <span class=nf>main</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=k>mut</span><span class=w> </span><span class=n>mr_snuggles</span>: <span class=kp>&amp;</span><span class=o>&#39;</span><span class=nb>static</span> <span class=kt>str</span> <span class=o>=</span><span class=w> </span><span class=s>&#34;meow! :3&#34;</span><span class=p>;</span><span class=w> </span><span class=c1>// mr. snuggles forever!!
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>    </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=kd>let</span><span class=w> </span><span class=n>spike</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nb>String</span>::<span class=n>from</span><span class=p>(</span><span class=s>&#34;bark! &gt;:V&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=kd>let</span><span class=w> </span><span class=n>spike_str</span>: <span class=kp>&amp;</span><span class=kt>str</span> <span class=o>=</span><span class=w> </span><span class=o>&amp;</span><span class=n>spike</span><span class=p>;</span><span class=w> </span><span class=c1>// Only lives for the block
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>        </span><span class=n>evil_feeder</span><span class=p>(</span><span class=o>&amp;</span><span class=k>mut</span><span class=w> </span><span class=n>mr_snuggles</span><span class=p>,</span><span class=w> </span><span class=n>spike_str</span><span class=p>);</span><span class=w> </span><span class=c1>// EVIL!
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=fm>println!</span><span class=p>(</span><span class=s>&#34;{}&#34;</span><span class=p>,</span><span class=w> </span><span class=n>mr_snuggles</span><span class=p>);</span><span class=w> </span><span class=c1>// Use after free?
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>编译结果：</p><p><img class=lazyload src=/svg/loading.min.svg data-src=/rust-lifetime-variance/image-20210408013314451.png data-srcset="/rust-lifetime-variance/image-20210408013314451.png, /rust-lifetime-variance/image-20210408013314451.png 1.5x, /rust-lifetime-variance/image-20210408013314451.png 2x" data-sizes=auto alt=/rust-lifetime-variance/image-20210408013314451.png title=image-20210408013314451 width=2004 height=766></p><p>我们一眼就能看出，<code>spike_str</code>的 lifetime 太短了，不可能复制给<code>mr_snuggles</code>，那么编译器是如何推断的呢？</p><ul><li>因为<code>&mut T</code>是对 T 的 invariant，所以编译器推断 T 必须是<code>&'static str</code>；</li><li><code>spike_str</code>是一个<code>&'a str</code>，对<code>'a</code>是 covariant，要匹配 T，必须尝试通过 covariant 变形成<code>'static str</code>；</li><li>那么编译器推断出<code>&'a str:'&'static str</code>，也即<code>'a:'static</code>，这当然无法成立，导致编译错误。</li></ul><p>此外，再看一个更明显的例子:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-rust data-lang=rust><span class=line><span class=cl><span class=c1>// compile error
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>fn</span> <span class=nf>invariant</span><span class=o>&lt;&#39;</span><span class=na>a</span>: <span class=o>&#39;</span><span class=na>b</span><span class=p>,</span><span class=w> </span><span class=o>&#39;</span><span class=na>b</span><span class=p>,</span><span class=w> </span><span class=o>&#39;</span><span class=na>c</span><span class=o>&gt;</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>sub</span>: <span class=kp>&amp;</span><span class=o>&#39;</span><span class=na>c</span> <span class=nc>mut</span><span class=w> </span><span class=nb>Vec</span><span class=o>&lt;&amp;&#39;</span><span class=na>a</span><span class=w> </span><span class=nb>String</span><span class=o>&gt;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>sup</span>: <span class=kp>&amp;</span><span class=o>&#39;</span><span class=na>c</span> <span class=nc>mut</span><span class=w> </span><span class=nb>Vec</span><span class=o>&lt;&amp;&#39;</span><span class=na>b</span><span class=w> </span><span class=nb>String</span><span class=o>&gt;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>)</span><span class=w> </span>-&gt; <span class=kp>&amp;</span><span class=o>&#39;</span><span class=na>c</span> <span class=nc>mut</span><span class=w> </span><span class=nb>Vec</span><span class=o>&lt;&amp;&#39;</span><span class=na>b</span><span class=w> </span><span class=nb>String</span><span class=o>&gt;</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>sub</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// compile ok
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>fn</span> <span class=nf>covariant</span><span class=o>&lt;&#39;</span><span class=na>a</span>: <span class=o>&#39;</span><span class=na>b</span><span class=p>,</span><span class=w> </span><span class=o>&#39;</span><span class=na>b</span><span class=p>,</span><span class=w> </span><span class=o>&#39;</span><span class=na>c</span><span class=o>&gt;</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>sub</span>: <span class=kp>&amp;</span><span class=o>&#39;</span><span class=na>c</span> <span class=nb>Vec</span><span class=o>&lt;&amp;&#39;</span><span class=na>a</span><span class=w> </span><span class=nb>String</span><span class=o>&gt;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>sup</span>: <span class=kp>&amp;</span><span class=o>&#39;</span><span class=na>c</span> <span class=nb>Vec</span><span class=o>&lt;&amp;&#39;</span><span class=na>b</span><span class=w> </span><span class=nb>String</span><span class=o>&gt;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>)</span><span class=w> </span>-&gt; <span class=kp>&amp;</span><span class=o>&#39;</span><span class=na>c</span> <span class=nb>Vec</span><span class=o>&lt;&amp;&#39;</span><span class=na>b</span><span class=w> </span><span class=nb>String</span><span class=o>&gt;</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>sub</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>build 结果如下：</p><p><img class=lazyload src=/svg/loading.min.svg data-src=/rust-lifetime-variance/image-20210408014252451.png data-srcset="/rust-lifetime-variance/image-20210408014252451.png, /rust-lifetime-variance/image-20210408014252451.png 1.5x, /rust-lifetime-variance/image-20210408014252451.png 2x" data-sizes=auto alt=/rust-lifetime-variance/image-20210408014252451.png title=image-20210408014252451 width=1788 height=702></p><ul><li>在两个函数的泛型参数中，显式标注了<code>'a : 'b</code>；</li><li>由于<code>&'a T</code>对<code>'a</code> covariant，所以<code>&'a String : &'b String</code>；</li><li>由于<code>Vec&lt;T></code>对<code>T</code> covariant，所以<code>Vec&lt;&'a String> : Vec&lt;&'b String></code>；</li><li>由于<code>&'a T</code>对 T 是 covariant，所以<code>&'c Vec&lt;&'a String> : &'c Vec&lt;&'b String></code>；</li><li>所以在 covariant 函数中，当函数要求返回<code>&'c Vec&lt;&'b String></code>时，可以直接返回<code>&'c Vec&lt;&'a String></code>；</li><li>但是<code>&'c mut T</code>对 T 是 invariant，<code>&'c mut Vec&lt;&'a String></code>与``&&lsquo;c mut Vec&lt;&&lsquo;b String>`间没有子类型关系，所以在 invariant 函数中无法再这么做。</li></ul><p>最后还有一个例子，看看函数的逆变：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-rust data-lang=rust><span class=line><span class=cl><span class=k>struct</span> <span class=nc>ContraVariant</span><span class=o>&lt;</span><span class=n>Mixed</span><span class=o>&gt;</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>f</span>: <span class=nc>fn</span><span class=p>(</span><span class=n>Mixed</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>fn</span> <span class=nf>test</span><span class=o>&lt;&#39;</span><span class=na>a</span><span class=o>&gt;</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>a</span>: <span class=kp>&amp;</span><span class=nc>mut</span><span class=w> </span><span class=n>ContraVariant</span><span class=o>&lt;&amp;&#39;</span><span class=na>a</span><span class=w> </span><span class=kt>i32</span><span class=o>&gt;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>b</span>: <span class=kp>&amp;</span><span class=nc>mut</span><span class=w> </span><span class=n>ContraVariant</span><span class=o>&lt;&amp;&#39;</span><span class=nb>static</span><span class=w> </span><span class=kt>i32</span><span class=o>&gt;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>f1</span>: <span class=nc>fn</span><span class=p>(</span><span class=o>&amp;&#39;</span><span class=na>a</span><span class=w> </span><span class=kt>i32</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>f2</span>: <span class=nc>fn</span><span class=p>(</span><span class=o>&amp;&#39;</span><span class=nb>static</span><span class=w> </span><span class=kt>i32</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>a</span><span class=p>.</span><span class=n>f</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>f1</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>a</span><span class=p>.</span><span class=n>f</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>f2</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>b</span><span class=p>.</span><span class=n>f</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>f1</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>b</span><span class=p>.</span><span class=n>f</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>f2</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>fn</span> <span class=nf>main</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>build 结果如下：</p><p><img class=lazyload src=/svg/loading.min.svg data-src=/rust-lifetime-variance/image-20210428235350226.png data-srcset="/rust-lifetime-variance/image-20210428235350226.png, /rust-lifetime-variance/image-20210428235350226.png 1.5x, /rust-lifetime-variance/image-20210428235350226.png 2x" data-sizes=auto alt=/rust-lifetime-variance/image-20210428235350226.png title=image-20210428235350226 width=1528 height=920></p><p>可以看到，四个赋值语句中，只有<code>a.f = f2</code>失败了。</p><ul><li><code>fn(T)</code>对<code>T</code> <strong>contra</strong>variant，<code>&'static i32 : &'a i32</code>，所以 <code>fn(&'a i32) : fn(&'static i32)</code>；</li><li><code>a.f</code>类型为<code>fn(&'a i32)</code>，<code>f2</code>类型为<code>fn(&'static i32)</code>；</li><li><code>a.f = f2</code>，相当于把父类型变量赋值给了子类型，类型不匹配，失败了。</li></ul><h2 id=资料援引>资料援引</h2><ul><li><a href=https://doc.rust-lang.org/nomicon/subtyping.html target=_blank rel="noopener noreffer">https://doc.rust-lang.org/nomicon/subtyping.html</a></li><li><a href=https://en.wikipedia.org/wiki/Type_constructor target=_blank rel="noopener noreffer">https://en.wikipedia.org/wiki/Type_constructor</a></li><li><a href=https://en.wikipedia.org/wiki/Subtyping target=_blank rel="noopener noreffer">https://en.wikipedia.org/wiki/Subtyping</a></li><li><a href=https://en.wikipedia.org/wiki/Covariance_and_contravariance_%28computer_science%29 target=_blank rel="noopener noreffer">https://en.wikipedia.org/wiki/Covariance_and_contravariance_(computer_science)</a></li><li><a href=https://zhuanlan.zhihu.com/p/41814387 target=_blank rel="noopener noreffer">https://zhuanlan.zhihu.com/p/41814387</a></li></ul></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>更新于 2021-04-29</span></div></div><div class=post-info-line><div class=post-info-md><span><a class=link-to-markdown href=/posts/rust-lifetime-variance/index.md target=_blank>阅读原始文档</a></span></div><div class=post-info-share><span><a href=javascript:void(0); title="分享到 Twitter" data-sharer=twitter data-url=https://waruto.top/posts/rust-lifetime-variance/ data-title=Rust生命周期与变形 data-via=Jason210314 data-hashtags=rust,variance,subtype><i class="fab fa-twitter fa-fw" aria-hidden=true></i></a></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fas fa-tags fa-fw" aria-hidden=true></i>&nbsp;<a href=/tags/rust/>rust</a>,&nbsp;<a href=/tags/variance/>variance</a>,&nbsp;<a href=/tags/subtype/>subtype</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>返回</a></span>&nbsp;|&nbsp;<span><a href=/>主页</a></span></section></div><div class=post-nav><a href=/posts/6-s081-lab10-mmap/ class=prev rel=prev title="6.S081 lab10 mmap"><i class="fas fa-angle-left fa-fw" aria-hidden=true></i>6.S081 lab10 mmap</a>
<a href=/posts/mit-6.830-lab1/ class=next rel=next title="MIT 6.830 Lab1">MIT 6.830 Lab1<i class="fas fa-angle-right fa-fw" aria-hidden=true></i></a></div></div><div id=comments><div id=disqus_thread class=comment></div><noscript>Please enable JavaScript to view the comments powered by <a href=https://disqus.com/?ref_noscript>Disqus</a>.</noscript></div></article></div></main><footer class=footer><div class=footer-container><div class=footer-line>由 <a href=https://gohugo.io/ target=_blank rel="noopener noreffer" title="Hugo 0.104.2">Hugo</a> 强力驱动 | 主题 - <a href=https://github.com/dillonzq/LoveIt target=_blank rel="noopener noreffer" title="LoveIt 0.2.10"><i class="far fa-kiss-wink-heart fa-fw" aria-hidden=true></i> LoveIt</a></div><div class=footer-line itemscope itemtype=http://schema.org/CreativeWork><i class="far fa-copyright fa-fw" aria-hidden=true></i><span itemprop=copyrightYear>2019 - 2022</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=https://github.com/waruto210 target=_blank>waruto210</a></span>&nbsp;|&nbsp;<span class=license><a rel="license external nofollow noopener noreffer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title=回到顶部><i class="fas fa-arrow-up fa-fw" aria-hidden=true></i>
</a><a href=# id=view-comments class=fixed-button title=查看评论><i class="fas fa-comment fa-fw" aria-hidden=true></i></a></div><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/contrib/copy-tex.min.css><script type=text/javascript src=https://waruto.disqus.com/embed.js defer></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/autocomplete.js@0.38.1/dist/autocomplete.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lunr@2.3.9/lunr.min.js></script><script type=text/javascript src=/lib/lunr/lunr.stemmer.support.min.js></script><script type=text/javascript src=/lib/lunr/lunr.zh.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lazysizes@5.3.1/lazysizes.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/clipboard@2.0.11/dist/clipboard.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/sharer.js@0.5.1/sharer.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/contrib/auto-render.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/contrib/copy-tex.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/contrib/mhchem.min.js></script><script type=text/javascript>window.config={code:{copyTitle:"复制到剪贴板",maxShownLines:10},comment:{},math:{delimiters:[{display:!0,left:"$$",right:"$$"},{display:!0,left:"\\[",right:"\\]"},{display:!0,left:"\\begin{equation}",right:"\\end{equation}"},{display:!0,left:"\\begin{equation*}",right:"\\end{equation*}"},{display:!0,left:"\\begin{align}",right:"\\end{align}"},{display:!0,left:"\\begin{align*}",right:"\\end{align*}"},{display:!0,left:"\\begin{alignat}",right:"\\end{alignat}"},{display:!0,left:"\\begin{alignat*}",right:"\\end{alignat*}"},{display:!0,left:"\\begin{gather}",right:"\\end{gather}"},{display:!0,left:"\\begin{CD}",right:"\\end{CD}"},{display:!1,left:"$",right:"$"},{display:!1,left:"\\(",right:"\\)"}],strict:!1},search:{highlightTag:"em",lunrIndexURL:"/index.json",lunrLanguageCode:"zh",lunrSegmentitURL:"/lib/lunr/lunr.segmentit.js",maxResultLength:10,noResultsFound:"没有找到结果",snippetLength:50,type:"lunr"}}</script><script type=text/javascript src=/js/theme.min.js></script><script type=text/javascript>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","UA-164518488-1",{anonymize_ip:!0})</script><script type=text/javascript src="https://www.googletagmanager.com/gtag/js?id=UA-164518488-1" async></script></body></html>